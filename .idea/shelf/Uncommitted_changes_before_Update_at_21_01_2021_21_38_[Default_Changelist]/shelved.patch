Index: app/src/main/res/layout/fragment_control_panel.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    tools:context=\".ui.control_panel.Control_panelFragment\">\r\n\r\n    <ScrollView\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\">\r\n\r\n\r\n        <LinearLayout\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"match_parent\"\r\n            android:orientation=\"vertical\"\r\n            >\r\n\r\n            <RelativeLayout\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginLeft=\"20dp\"\r\n                android:layout_marginTop=\"20dp\"\r\n                android:layout_marginRight=\"20dp\">\r\n\r\n                <TextView\r\n                    android:id=\"@+id/textPanel_control\"\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:text=\"Panel de control  >\"\r\n\r\n                    android:textSize=\"19sp\" />\r\n\r\n                <TextView\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:layout_below=\"@+id/textPanel_control\"\r\n                    android:text=\"4 elementos\"\r\n\r\n                    android:textSize=\"14sp\" />\r\n\r\n                <!--<ImageView\r\n                    android:layout_width=\"62dp\"\r\n                    android:layout_height=\"62dp\"\r\n                    android:layout_alignParentRight=\"true\"\r\n                    android:src=\"@drawable/ic_sun\" />-->\r\n            </RelativeLayout>\r\n\r\n            <LinearLayout\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginLeft=\"20dp\"\r\n                android:layout_marginTop=\"20dp\"\r\n                android:layout_marginRight=\"20dp\"\r\n                android:layout_marginBottom=\"20dp\"\r\n                android:orientation=\"horizontal\"\r\n                android:weightSum=\"2\">\r\n\r\n                <androidx.constraintlayout.widget.ConstraintLayout\r\n                    android:id=\"@+id/btn_forum\"\r\n                    android:layout_width=\"0dp\"\r\n                    android:layout_height=\"80dp\"\r\n                    android:layout_marginRight=\"8dp\"\r\n                    android:layout_weight=\"1\"\r\n                    android:background=\"@drawable/bg_settings\"\r\n                    android:orientation=\"horizontal\">\r\n\r\n                    <ImageView\r\n                        android:id=\"@+id/icon_set\"\r\n                        android:layout_width=\"40dp\"\r\n                        android:layout_height=\"40dp\"\r\n                        android:layout_alignParentTop=\"true\"\r\n                        android:layout_alignParentBottom=\"true\"\r\n                        android:layout_marginStart=\"10dp\"\r\n                        android:src=\"@drawable/icons_foro\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toStartOf=\"@+id/textView16\"\r\n                        app:layout_constraintStart_toStartOf=\"parent\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\">\r\n\r\n                    </ImageView>\r\n\r\n                    <TextView\r\n                        android:id=\"@+id/textView16\"\r\n                        android:layout_width=\"0dp\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_centerVertical=\"true\"\r\n                        android:layout_marginEnd=\"10dp\"\r\n                        android:layout_toRightOf=\"@id/icon_set\"\r\n                        android:gravity=\"center\"\r\n                        android:text=\"Foro\"\r\n                        android:textColor=\"#202020\"\r\n                        android:textSize=\"16sp\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toEndOf=\"parent\"\r\n                        app:layout_constraintStart_toEndOf=\"@+id/icon_set\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n                </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n                <androidx.constraintlayout.widget.ConstraintLayout\r\n                    android:id=\"@+id/btn_graficas\"\r\n                    android:layout_width=\"0dp\"\r\n                    android:layout_height=\"80dp\"\r\n                    android:layout_marginRight=\"8dp\"\r\n                    android:layout_weight=\"1\"\r\n                    android:background=\"@drawable/bg_settings\"\r\n                    android:orientation=\"horizontal\">\r\n\r\n                    <ImageView\r\n                        android:id=\"@+id/icon_set1\"\r\n                        android:layout_width=\"40dp\"\r\n                        android:layout_height=\"40dp\"\r\n                        android:layout_alignParentTop=\"true\"\r\n                        android:layout_alignParentBottom=\"true\"\r\n                        android:layout_marginStart=\"10dp\"\r\n                        android:src=\"@drawable/icons_chart\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toStartOf=\"@+id/textView162\"\r\n                        app:layout_constraintStart_toStartOf=\"parent\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\">\r\n\r\n                    </ImageView>\r\n\r\n                    <TextView\r\n                        android:id=\"@+id/textView162\"\r\n                        android:layout_width=\"0dp\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_centerVertical=\"true\"\r\n                        android:layout_marginEnd=\"10dp\"\r\n                        android:layout_toRightOf=\"@id/icon_set1\"\r\n                        android:gravity=\"center\"\r\n                        android:text=\"Graficas\"\r\n                        android:textColor=\"#202020\"\r\n                        android:textSize=\"16sp\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toEndOf=\"parent\"\r\n                        app:layout_constraintStart_toEndOf=\"@+id/icon_set1\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n                </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n\r\n            </LinearLayout>\r\n\r\n            <LinearLayout\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginLeft=\"20dp\"\r\n                android:layout_marginRight=\"20dp\"\r\n                android:layout_marginBottom=\"20dp\"\r\n                android:orientation=\"horizontal\"\r\n                android:weightSum=\"2\">\r\n\r\n                <androidx.constraintlayout.widget.ConstraintLayout\r\n                    android:layout_width=\"0dp\"\r\n                    android:layout_height=\"80dp\"\r\n                    android:layout_marginRight=\"8dp\"\r\n                    android:layout_weight=\"1\"\r\n                    android:background=\"@drawable/bg_settings\"\r\n                    android:orientation=\"horizontal\">\r\n\r\n                    <ImageView\r\n                        android:id=\"@+id/icon_set2\"\r\n                        android:layout_width=\"40dp\"\r\n                        android:layout_height=\"40dp\"\r\n                        android:layout_alignParentTop=\"true\"\r\n                        android:layout_alignParentBottom=\"true\"\r\n                        android:layout_marginStart=\"10dp\"\r\n                        android:src=\"@drawable/icons_status\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toStartOf=\"@+id/textView1622\"\r\n                        app:layout_constraintStart_toStartOf=\"parent\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\">\r\n\r\n                    </ImageView>\r\n\r\n                    <TextView\r\n                        android:id=\"@+id/textView1622\"\r\n                        android:layout_width=\"0dp\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_centerVertical=\"true\"\r\n                        android:layout_marginEnd=\"10dp\"\r\n                        android:layout_toRightOf=\"@id/icon_set2\"\r\n                        android:gravity=\"center\"\r\n                        android:text=\"Estado de la mÃ¡quina\"\r\n                        android:textColor=\"#202020\"\r\n                        android:textSize=\"16sp\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toEndOf=\"parent\"\r\n                        app:layout_constraintStart_toEndOf=\"@+id/icon_set2\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n                </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n                <androidx.constraintlayout.widget.ConstraintLayout\r\n                    android:id=\"@+id/btn_guia_botanica\"\r\n                    android:layout_width=\"0dp\"\r\n                    android:layout_height=\"80dp\"\r\n                    android:layout_marginRight=\"8dp\"\r\n                    android:layout_weight=\"1\"\r\n                    android:background=\"@drawable/bg_settings\"\r\n                    android:orientation=\"horizontal\">\r\n\r\n                    <ImageView\r\n                        android:id=\"@+id/icon_set21\"\r\n                        android:layout_width=\"40dp\"\r\n                        android:layout_height=\"40dp\"\r\n                        android:layout_alignParentTop=\"true\"\r\n                        android:layout_alignParentBottom=\"true\"\r\n                        android:layout_marginStart=\"10dp\"\r\n                        android:src=\"@drawable/icons_guia_botanica\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toStartOf=\"@+id/textView1621\"\r\n                        app:layout_constraintStart_toStartOf=\"parent\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\">\r\n\r\n                    </ImageView>\r\n\r\n                    <TextView\r\n                        android:id=\"@+id/textView1621\"\r\n                        android:layout_width=\"0dp\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_centerVertical=\"true\"\r\n                        android:layout_marginEnd=\"10dp\"\r\n                        android:layout_toRightOf=\"@id/icon_set21\"\r\n                        android:gravity=\"center\"\r\n                        android:text=\"Guia botanica\"\r\n                        android:textColor=\"#202020\"\r\n                        android:textSize=\"16sp\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toEndOf=\"parent\"\r\n                        app:layout_constraintStart_toEndOf=\"@+id/icon_set21\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n                </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n\r\n            </LinearLayout>\r\n\r\n            <LinearLayout\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginLeft=\"20dp\"\r\n                android:layout_marginRight=\"20dp\"\r\n                android:layout_marginBottom=\"20dp\"\r\n                android:orientation=\"horizontal\"\r\n                android:weightSum=\"2\">\r\n\r\n\r\n                <androidx.constraintlayout.widget.ConstraintLayout\r\n                    android:id=\"@+id/btn_notificaciones\"\r\n                    android:layout_width=\"0dp\"\r\n                    android:layout_height=\"80dp\"\r\n                    android:layout_marginRight=\"8dp\"\r\n                    android:layout_weight=\"1\"\r\n                    android:background=\"@drawable/bg_settings\"\r\n                    android:orientation=\"horizontal\">\r\n\r\n                    <ImageView\r\n                        android:id=\"@+id/icon_notificacion\"\r\n                        android:layout_width=\"35dp\"\r\n                        android:layout_height=\"35dp\"\r\n                        android:layout_alignParentTop=\"true\"\r\n                        android:layout_alignParentBottom=\"true\"\r\n                        android:layout_marginStart=\"10dp\"\r\n                        android:src=\"@drawable/icons_notification\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toStartOf=\"@+id/textView_notificacion\"\r\n                        app:layout_constraintStart_toStartOf=\"parent\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\">\r\n\r\n                    </ImageView>\r\n\r\n                    <TextView\r\n                        android:id=\"@+id/textView_notificacion\"\r\n                        android:layout_width=\"0dp\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_centerVertical=\"true\"\r\n                        android:layout_marginEnd=\"10dp\"\r\n                        android:layout_toRightOf=\"@id/icon_notificacion\"\r\n                        android:gravity=\"center\"\r\n                        android:text=\"Notificaciones\"\r\n                        android:textColor=\"#202020\"\r\n                        android:textSize=\"15sp\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toEndOf=\"parent\"\r\n                        app:layout_constraintStart_toEndOf=\"@+id/icon_notificacion\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n                </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n\r\n            </LinearLayout>\r\n        </LinearLayout>\r\n    </ScrollView>\r\n\r\n\r\n</FrameLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/fragment_control_panel.xml	(revision c8202bf3ec3c20b3208068f5eda44f36cbcc1991)
+++ app/src/main/res/layout/fragment_control_panel.xml	(date 1611257120775)
@@ -154,6 +154,7 @@
                 android:weightSum="2">
 
                 <androidx.constraintlayout.widget.ConstraintLayout
+                    android:id="@+id/btn_notificaciones"
                     android:layout_width="0dp"
                     android:layout_height="80dp"
                     android:layout_marginRight="8dp"
@@ -162,34 +163,34 @@
                     android:orientation="horizontal">
 
                     <ImageView
-                        android:id="@+id/icon_set2"
-                        android:layout_width="40dp"
-                        android:layout_height="40dp"
+                        android:id="@+id/icon_notificacion"
+                        android:layout_width="35dp"
+                        android:layout_height="35dp"
                         android:layout_alignParentTop="true"
                         android:layout_alignParentBottom="true"
                         android:layout_marginStart="10dp"
-                        android:src="@drawable/icons_status"
+                        android:src="@drawable/icons_notification"
                         app:layout_constraintBottom_toBottomOf="parent"
-                        app:layout_constraintEnd_toStartOf="@+id/textView1622"
+                        app:layout_constraintEnd_toStartOf="@+id/textView_notificacion"
                         app:layout_constraintStart_toStartOf="parent"
                         app:layout_constraintTop_toTopOf="parent">
 
                     </ImageView>
 
                     <TextView
-                        android:id="@+id/textView1622"
+                        android:id="@+id/textView_notificacion"
                         android:layout_width="0dp"
                         android:layout_height="wrap_content"
                         android:layout_centerVertical="true"
                         android:layout_marginEnd="10dp"
-                        android:layout_toRightOf="@id/icon_set2"
+                        android:layout_toRightOf="@id/icon_notificacion"
                         android:gravity="center"
-                        android:text="Estado de la mÃ¡quina"
+                        android:text="Notificaciones"
                         android:textColor="#202020"
-                        android:textSize="16sp"
+                        android:textSize="15sp"
                         app:layout_constraintBottom_toBottomOf="parent"
                         app:layout_constraintEnd_toEndOf="parent"
-                        app:layout_constraintStart_toEndOf="@+id/icon_set2"
+                        app:layout_constraintStart_toEndOf="@+id/icon_notificacion"
                         app:layout_constraintTop_toTopOf="parent" />
 
                 </androidx.constraintlayout.widget.ConstraintLayout>
@@ -239,7 +240,7 @@
 
             </LinearLayout>
 
-            <LinearLayout
+            <!--<LinearLayout
                 android:layout_width="match_parent"
                 android:layout_height="wrap_content"
                 android:layout_marginLeft="20dp"
@@ -292,7 +293,7 @@
                 </androidx.constraintlayout.widget.ConstraintLayout>
 
 
-            </LinearLayout>
+            </LinearLayout>-->
         </LinearLayout>
     </ScrollView>
 
Index: app/src/main/java/com/example/infinitycrop/ui/dashboard/Planta2Fragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.infinitycrop.ui.dashboard;\n\n\nimport android.os.Bundle;\n\nimport androidx.annotation.Nullable;\nimport androidx.fragment.app.Fragment;\n\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.TextView;\n\nimport com.example.infinitycrop.MainActivity;\nimport com.example.infinitycrop.R;\nimport com.google.firebase.firestore.DocumentSnapshot;\nimport com.google.firebase.firestore.EventListener;\nimport com.google.firebase.firestore.FirebaseFirestore;\nimport com.google.firebase.firestore.FirebaseFirestoreException;\n\n/**\n * A simple {@link Fragment} subclass.\n * Use the {@link GeneralFragment#newInstance} factory method to\n * create an instance of this fragment.\n */\npublic class Planta2Fragment extends Fragment {\n\n    // TODO: Rename parameter arguments, choose names that match\n    // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER\n    private static final String ARG_PARAM1 = \"param1\";\n    private static final String ARG_PARAM2 = \"param2\";\n    private String uid;\n    private FirebaseFirestore db;\n    // TODO: Rename and change types of parameters\n    private String mParam1;\n    private String mParam2;\n\n    public Planta2Fragment() {\n        // Required empty public constructor\n    }\n\n    /**\n     * Use this factory method to create a new instance of\n     * this fragment using the provided parameters.\n     *\n     * @param param1 Parameter 1.\n     * @param param2 Parameter 2.\n     * @return A new instance of fragment GeneralFragment.\n     */\n    // TODO: Rename and change types and number of parameters\n    public static GeneralFragment newInstance(String param1, String param2) {\n        GeneralFragment fragment = new GeneralFragment();\n        Bundle args = new Bundle();\n        args.putString(ARG_PARAM1, param1);\n        args.putString(ARG_PARAM2, param2);\n        fragment.setArguments(args);\n        return fragment;\n    }\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        if (getArguments() != null) {\n            mParam1 = getArguments().getString(ARG_PARAM1);\n            mParam2 = getArguments().getString(ARG_PARAM2);\n        }\n    }\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n        // Inflate the layout for this fragment\n        View v = inflater.inflate(R.layout.fragment_planta2, container, false);\n        db = FirebaseFirestore.getInstance();\n        MainActivity myActivity = (MainActivity) getActivity();\n        final TextView medidaTemp=v.findViewById(R.id.medidaTemperaturaPlanta2);\n        /*final TextView medidaHum=v.findViewById(R.id.medidaHumedadPlanta2);*/\n        final TextView medidaHumAm=v.findViewById(R.id.medidaSalinidadPlanta2);\n        /*final TextView medidaLuz=v.findViewById(R.id.medidasLuminosidadPlanta2);*/\n        uid=myActivity.getMachineUID();\n        db.collection(\"Mediciones planta 2\")\n                .document(uid)\n                .addSnapshotListener(new EventListener<DocumentSnapshot>() {\n                    @Override\n                    public void onEvent(@Nullable DocumentSnapshot snapshot,\n                                        @Nullable FirebaseFirestoreException e) {\n                        if (e != null) {\n                            return;\n                        }\n\n                        if (snapshot != null && snapshot.exists()) {\n                            //Temperatura\n                            String medidaT=snapshot.getString(\"Temperatura\");\n                            medidaTemp.setText(medidaT+\"Â°C\");\n                            //Humedad\n                            /*String medidaH=snapshot.getString(\"Humedad\");\n                            medidaHum.setText(medidaH+\"%\");*/\n                            //Humedad Ambiente\n                            String medidaHA=snapshot.getString(\"Humedad Ambiente\");\n                            medidaHumAm.setText(medidaHA+\"%\");\n                            //Luminosidad\n                            /*String medidaL=snapshot.getString(\"Luminosidad\");\n                            medidaLuz.setText(medidaL+\"%\");*/\n\n\n                        } else {\n\n                        }\n                    }\n                });\n        return v;\n    }\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/infinitycrop/ui/dashboard/Planta2Fragment.java	(revision c8202bf3ec3c20b3208068f5eda44f36cbcc1991)
+++ app/src/main/java/com/example/infinitycrop/ui/dashboard/Planta2Fragment.java	(date 1611260895188)
@@ -3,27 +3,47 @@
 
 import android.os.Bundle;
 
+import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 import androidx.fragment.app.Fragment;
 
+import android.util.Log;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
+import android.widget.CompoundButton;
+import android.widget.Switch;
 import android.widget.TextView;
 
+import com.example.comun.Mqtt;
 import com.example.infinitycrop.MainActivity;
 import com.example.infinitycrop.R;
+import com.google.firebase.database.DataSnapshot;
+import com.google.firebase.database.DatabaseError;
+import com.google.firebase.database.DatabaseReference;
+import com.google.firebase.database.FirebaseDatabase;
+import com.google.firebase.database.ValueEventListener;
 import com.google.firebase.firestore.DocumentSnapshot;
 import com.google.firebase.firestore.EventListener;
 import com.google.firebase.firestore.FirebaseFirestore;
 import com.google.firebase.firestore.FirebaseFirestoreException;
 
+import org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;
+import org.eclipse.paho.client.mqttv3.MqttCallback;
+import org.eclipse.paho.client.mqttv3.MqttClient;
+import org.eclipse.paho.client.mqttv3.MqttConnectOptions;
+import org.eclipse.paho.client.mqttv3.MqttException;
+import org.eclipse.paho.client.mqttv3.MqttMessage;
+import org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;
+
+import static com.example.comun.Mqtt.topicRoot;
+
 /**
  * A simple {@link Fragment} subclass.
  * Use the {@link GeneralFragment#newInstance} factory method to
  * create an instance of this fragment.
  */
-public class Planta2Fragment extends Fragment {
+public class Planta2Fragment extends Fragment implements MqttCallback {
 
     // TODO: Rename parameter arguments, choose names that match
     // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER
@@ -31,10 +51,12 @@
     private static final String ARG_PARAM2 = "param2";
     private String uid;
     private FirebaseFirestore db;
+
     // TODO: Rename and change types of parameters
     private String mParam1;
     private String mParam2;
-
+    private Switch switchLuz;
+    public static MqttClient client = null;
     public Planta2Fragment() {
         // Required empty public constructor
     }
@@ -65,12 +87,14 @@
             mParam2 = getArguments().getString(ARG_PARAM2);
         }
     }
-
+    private DatabaseReference databaseReference;
     @Override
     public View onCreateView(LayoutInflater inflater, ViewGroup container,
                              Bundle savedInstanceState) {
         // Inflate the layout for this fragment
         View v = inflater.inflate(R.layout.fragment_planta2, container, false);
+        databaseReference= FirebaseDatabase.getInstance().getReference();
+        switchLuz=v.findViewById(R.id.switchLuminosidadPlanta2);
         db = FirebaseFirestore.getInstance();
         MainActivity myActivity = (MainActivity) getActivity();
         final TextView medidaTemp=v.findViewById(R.id.medidaTemperaturaPlanta2);
@@ -108,6 +132,135 @@
                         }
                     }
                 });
+
+        //switch luz
+        /*databaseReference.child("Mediciones general")
+                .child(uid).addValueEventListener(new ValueEventListener() {
+            @Override
+            public void onDataChange(@NonNull DataSnapshot snapshot) {
+                if(snapshot.exists()){
+                    String LuzPieza1= snapshot.child("LuzPieza1").getValue().toString();
+                    String LuzPieza2=snapshot.child("LuzPieza2").getValue().toString();
+                    String LuzPieza3=snapshot.child("LuzPieza3").getValue().toString();
+                    String LuzPuerta=snapshot.child("LuzPuerta").getValue().toString();
+                    String LuzTecho=snapshot.child("LuzTecho").getValue().toString();
+
+                    if(LuzPieza3.equals("0") && LuzPuerta.equals("0")){
+                        switchLuz.setChecked(true);
+                    }else if(LuzPieza3.equals("1") && LuzPuerta.equals("1")){
+                        switchLuz.setChecked(false);
+                    }
+
+                }
+            }
+            @Override
+            public void onCancelled(@NonNull DatabaseError error) {
+
+            }
+        });*/
+
+        switchLuz.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
+            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
+                if (isChecked) {
+                    // The toggle is enabled
+                    enviarLucesOn();
+                } else {
+                    // The toggle is disabled
+                    enviarLucesOff();
+                }
+            }
+        });
         return v;
     }
+
+
+    public void enviarLucesOff(){
+        try {
+            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new
+                    MemoryPersistence());
+        } catch (MqttException e) {
+            e.printStackTrace();
+        }
+        MqttConnectOptions connOpts = new MqttConnectOptions();
+        connOpts.setCleanSession(true);
+        connOpts.setKeepAliveInterval(60);
+        connOpts.setWill(topicRoot+"WillTopic", "App desconectada".getBytes(),Mqtt.qos, false);
+
+        try {
+            client.connect(connOpts);
+        } catch (MqttException e) {
+            e.printStackTrace();
+        }
+
+        //conexiÃ³n con el broker Root1 = Lector de datos
+        //nos subscribimos a topic lectura
+        try {
+            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones-"+uid);//aqui estÃ¡ el root al que nos subscribimos si se quiere modificar se tiene que modificar este
+            client.subscribe(topicRoot + "operaciones-"+uid, Mqtt.qos);
+            client.setCallback((MqttCallback) this);
+        } catch (MqttException e) {
+            Log.e(Mqtt.TAG, "Error al suscribir.", e);
+        }
+        try {
+            Log.i(Mqtt.TAG, "Publicando mensaje: " + "mensaje");
+            MqttMessage message = new MqttMessage("3-OFF".getBytes());
+            message.setQos(Mqtt.qos);
+            message.setRetained(false);
+            client.publish(topicRoot+"operaciones-"+uid, message);
+        } catch (MqttException e) {
+            Log.e(Mqtt.TAG, "Error al publicar.", e);
+        }
+    }
+    public void enviarLucesOn(){
+        try {
+            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new
+                    MemoryPersistence());
+        } catch (MqttException e) {
+            e.printStackTrace();
+        }
+        MqttConnectOptions connOpts = new MqttConnectOptions();
+        connOpts.setCleanSession(true);
+        connOpts.setKeepAliveInterval(60);
+        connOpts.setWill(topicRoot+"WillTopic", "App desconectada".getBytes(),Mqtt.qos, false);
+
+        try {
+            client.connect(connOpts);
+        } catch (MqttException e) {
+            e.printStackTrace();
+        }
+
+        //conexiÃ³n con el broker Root1 = Lector de datos
+        //nos subscribimos a topic lectura
+        try {
+            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones-"+uid);//aqui estÃ¡ el root al que nos subscribimos si se quiere modificar se tiene que modificar este
+            client.subscribe(topicRoot + "operaciones-"+uid, Mqtt.qos);
+            client.setCallback((MqttCallback) this);
+        } catch (MqttException e) {
+            Log.e(Mqtt.TAG, "Error al suscribir.", e);
+        }
+        try {
+            Log.i(Mqtt.TAG, "Publicando mensaje: " + "mensaje");
+            MqttMessage message = new MqttMessage("3-ON".getBytes());
+            message.setQos(Mqtt.qos);
+            message.setRetained(false);
+            client.publish(topicRoot+"operaciones-"+uid, message);
+        } catch (MqttException e) {
+            Log.e(Mqtt.TAG, "Error al publicar.", e);
+        }
+    }
+
+    @Override
+    public void connectionLost(Throwable cause) {
+
+    }
+
+    @Override
+    public void messageArrived(String topic, MqttMessage message) throws Exception {
+
+    }
+
+    @Override
+    public void deliveryComplete(IMqttDeliveryToken token) {
+
+    }
 }
\ No newline at end of file
Index: app/src/main/java/com/example/infinitycrop/ui/dashboard/GeneralFragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.infinitycrop.ui.dashboard;\n\nimport android.content.Intent;\nimport android.os.Bundle;\n\nimport androidx.annotation.NonNull;\nimport androidx.annotation.Nullable;\nimport androidx.fragment.app.Fragment;\n\nimport android.util.Log;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.Button;\nimport android.widget.CompoundButton;\nimport android.widget.Switch;\nimport android.widget.TextView;\n\nimport com.example.comun.Mqtt;\nimport com.example.infinitycrop.MainActivity;\nimport com.example.infinitycrop.R;\nimport com.example.infinitycrop.ui.MachineControl.planta1;\nimport com.google.android.material.bottomsheet.BottomSheetDialog;\nimport com.google.firebase.Timestamp;\nimport com.google.firebase.database.DataSnapshot;\nimport com.google.firebase.database.DatabaseError;\nimport com.google.firebase.database.DatabaseReference;\nimport com.google.firebase.database.FirebaseDatabase;\nimport com.google.firebase.database.ValueEventListener;\nimport com.google.firebase.firestore.DocumentSnapshot;\nimport com.google.firebase.firestore.EventListener;\nimport com.google.firebase.firestore.FirebaseFirestore;\nimport com.google.firebase.firestore.FirebaseFirestoreException;\n\nimport org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;\nimport org.eclipse.paho.client.mqttv3.MqttCallback;\nimport org.eclipse.paho.client.mqttv3.MqttClient;\nimport org.eclipse.paho.client.mqttv3.MqttConnectOptions;\nimport org.eclipse.paho.client.mqttv3.MqttException;\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\nimport org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;\n\nimport java.util.Date;\nimport java.util.HashMap;\nimport java.util.Map;\n\nimport static com.example.comun.Mqtt.topicRoot;\n\n/**\n * A simple {@link Fragment} subclass.\n * Use the {@link GeneralFragment#newInstance} factory method to\n * create an instance of this fragment.\n */\npublic class GeneralFragment extends Fragment implements MqttCallback{\n    public static MqttClient client = null;\n    private String uid;\n    private FirebaseFirestore db;\n    // TODO: Rename parameter arguments, choose names that match\n    // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER\n    private static final String ARG_PARAM1 = \"param1\";\n    private static final String ARG_PARAM2 = \"param2\";\n\n    // TODO: Rename and change types of parameters\n    private String mParam1;\n    private String mParam2;\n\n    public GeneralFragment() {\n        // Required empty public constructor\n    }\n\n    /**\n     * Use this factory method to create a new instance of\n     * this fragment using the provided parameters.\n     *\n     * @param param1 Parameter 1.\n     * @param param2 Parameter 2.\n     * @return A new instance of fragment GeneralFragment.\n     */\n    // TODO: Rename and change types and number of parameters\n    public static GeneralFragment newInstance(String param1, String param2) {\n        GeneralFragment fragment = new GeneralFragment();\n        Bundle args = new Bundle();\n        args.putString(ARG_PARAM1, param1);\n        args.putString(ARG_PARAM2, param2);\n        fragment.setArguments(args);\n        return fragment;\n    }\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        if (getArguments() != null) {\n            mParam1 = getArguments().getString(ARG_PARAM1);\n            mParam2 = getArguments().getString(ARG_PARAM2);\n        }\n    }\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n        // Inflate the layout for this fragment\n        View v = inflater.inflate(R.layout.fragment_general, container, false);\n        //switch methods\n        Switch switchLuz = (Switch) v.findViewById(R.id.switchLuminosidadGeneral);\n        switchLuz.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {\n            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {\n                if (isChecked) {\n                    // The toggle is enabled\n                    enviarLucesOn();\n                } else {\n                    // The toggle is disabled\n                    enviarLucesOff();\n                }\n            }\n        });\n        db = FirebaseFirestore.getInstance();\n        MainActivity myActivity = (MainActivity) getActivity();\n        final TextView medidaTemp=v.findViewById(R.id.medidaTemperaturaGeneral);\n        final TextView medidaHum=v.findViewById(R.id.medidaHumedadGeneral);\n        /*final TextView medidaHumAm=v.findViewById(R.id.medidaSalinidadGeneral);*/\n        final TextView medidaLuz=v.findViewById(R.id.medidasLuminosidadGeneral);\n        uid=myActivity.getMachineUID();\n        db.collection(\"Mediciones general\")\n                .document(uid)\n                .addSnapshotListener(new EventListener<DocumentSnapshot>() {\n                    @Override\n                    public void onEvent(@Nullable DocumentSnapshot snapshot,\n                                        @Nullable FirebaseFirestoreException e) {\n                        if (e != null) {\n                            return;\n                        }\n\n                        if (snapshot != null && snapshot.exists()) {\n                            //Temperatura\n                            String medidaT=snapshot.getString(\"Temperatura\");\n                            medidaTemp.setText(medidaT+\"Â°C\");\n                            //Humedad\n                            String medidaH=snapshot.getString(\"Humedad\");\n                            medidaHum.setText(medidaH+\"%\");\n                            //Humedad Ambiente\n                            /*String medidaHA=snapshot.getString(\"Humedad Ambiente\");\n                            medidaHumAm.setText(medidaHA+\"%\");*/\n                            //Luminosidad\n                            String medidaL=snapshot.getString(\"Luminosidad\");\n                            medidaLuz.setText(medidaL+\"%\");\n\n\n                        } else {\n\n                        }\n                    }\n                });\n\n        //Boton para acceder a la maquina para sus parcelas\n        Button btnmymachine = (Button) v.findViewById(R.id.btnMyMachine);\n        btnmymachine.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n\n                BottomSheetDialog bottomSheetDialog = new BottomSheetDialog(\n                        getContext()\n                );\n                bottomSheetDialog.setContentView(R.layout.plantamaquina_bottom_sheet);\n                Button btnp1=bottomSheetDialog.findViewById(R.id.enterPlant2);\n                Button btn2=bottomSheetDialog.findViewById(R.id.enterPlant1);\n                bottomSheetDialog.show();\n                btnp1.setOnClickListener(new View.OnClickListener() {\n                    @Override\n                    public void onClick(View v) {\n                        Intent intent = new Intent (getContext(), planta1.class);\n                        intent.putExtra(\"idMachine\", uid);\n                        startActivity(intent);\n\n\n\n                    }\n\n                });\n            }\n        });\n\n        return v;\n    }\n        /*btnmymachine.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                Intent intent = new Intent (getContext(), MiMaquina.class);\n                startActivity(intent);\n\n            }\n        });*/\n\n\n\n    public void enviarLucesOff(){\n        try {\n            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new\n                    MemoryPersistence());\n        } catch (MqttException e) {\n            e.printStackTrace();\n        }\n        MqttConnectOptions connOpts = new MqttConnectOptions();\n        connOpts.setCleanSession(true);\n        connOpts.setKeepAliveInterval(60);\n        connOpts.setWill(topicRoot+\"WillTopic\", \"App desconectada\".getBytes(),Mqtt.qos, false);\n\n        try {\n            client.connect(connOpts);\n        } catch (MqttException e) {\n            e.printStackTrace();\n        }\n\n        //conexiÃ³n con el broker Root1 = Lector de datos\n        //nos subscribimos a topic lectura\n        try {\n            Log.i(Mqtt.TAG, \"Subscrito a \" + topicRoot + \"operaciones\");//aqui estÃ¡ el root al que nos subscribimos si se quiere modificar se tiene que modificar este\n            client.subscribe(topicRoot + \"operaciones\", Mqtt.qos);\n            client.setCallback((MqttCallback) this);\n        } catch (MqttException e) {\n            Log.e(Mqtt.TAG, \"Error al suscribir.\", e);\n        }\n        try {\n            Log.i(Mqtt.TAG, \"Publicando mensaje: \" + \"mensaje\");\n            MqttMessage message = new MqttMessage(\"1-OFF\".getBytes());\n            message.setQos(Mqtt.qos);\n            message.setRetained(false);\n            client.publish(topicRoot+\"operaciones\", message);\n        } catch (MqttException e) {\n            Log.e(Mqtt.TAG, \"Error al publicar.\", e);\n        }\n    }\n    public void enviarLucesOn(){\n        try {\n            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new\n                    MemoryPersistence());\n        } catch (MqttException e) {\n            e.printStackTrace();\n        }\n        MqttConnectOptions connOpts = new MqttConnectOptions();\n        connOpts.setCleanSession(true);\n        connOpts.setKeepAliveInterval(60);\n        connOpts.setWill(topicRoot+\"WillTopic\", \"App desconectada\".getBytes(),Mqtt.qos, false);\n\n        try {\n            client.connect(connOpts);\n        } catch (MqttException e) {\n            e.printStackTrace();\n        }\n\n        //conexiÃ³n con el broker Root1 = Lector de datos\n        //nos subscribimos a topic lectura\n        try {\n            Log.i(Mqtt.TAG, \"Subscrito a \" + topicRoot + \"operaciones\");//aqui estÃ¡ el root al que nos subscribimos si se quiere modificar se tiene que modificar este\n            client.subscribe(topicRoot + \"operaciones\", Mqtt.qos);\n            client.setCallback((MqttCallback) this);\n        } catch (MqttException e) {\n            Log.e(Mqtt.TAG, \"Error al suscribir.\", e);\n        }\n        try {\n            Log.i(Mqtt.TAG, \"Publicando mensaje: \" + \"mensaje\");\n            MqttMessage message = new MqttMessage(\"1-ON\".getBytes());\n            message.setQos(Mqtt.qos);\n            message.setRetained(false);\n            client.publish(topicRoot+\"operaciones\", message);\n        } catch (MqttException e) {\n            Log.e(Mqtt.TAG, \"Error al publicar.\", e);\n        }\n    }\n\n    @Override\n    public void connectionLost(Throwable cause) {\n        Log.d(Mqtt.TAG, \"ConexiÃ³n perdida\");\n    }\n\n    @Override\n    public void messageArrived(String topic, MqttMessage message) throws Exception {\n\n    }\n\n    @Override\n    public void deliveryComplete(IMqttDeliveryToken token) {\n        Log.d(Mqtt.TAG, \"Entrega completa\");\n    }\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/infinitycrop/ui/dashboard/GeneralFragment.java	(revision c8202bf3ec3c20b3208068f5eda44f36cbcc1991)
+++ app/src/main/java/com/example/infinitycrop/ui/dashboard/GeneralFragment.java	(date 1611260895174)
@@ -55,6 +55,7 @@
     public static MqttClient client = null;
     private String uid;
     private FirebaseFirestore db;
+    private DatabaseReference databaseReference;
     // TODO: Rename parameter arguments, choose names that match
     // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER
     private static final String ARG_PARAM1 = "param1";
@@ -100,19 +101,10 @@
                              Bundle savedInstanceState) {
         // Inflate the layout for this fragment
         View v = inflater.inflate(R.layout.fragment_general, container, false);
+        databaseReference= FirebaseDatabase.getInstance().getReference();
         //switch methods
-        Switch switchLuz = (Switch) v.findViewById(R.id.switchLuminosidadGeneral);
-        switchLuz.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
-            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
-                if (isChecked) {
-                    // The toggle is enabled
-                    enviarLucesOn();
-                } else {
-                    // The toggle is disabled
-                    enviarLucesOff();
-                }
-            }
-        });
+        final Switch switchLuz = (Switch) v.findViewById(R.id.switchLuminosidadGeneral);
+
         db = FirebaseFirestore.getInstance();
         MainActivity myActivity = (MainActivity) getActivity();
         final TextView medidaTemp=v.findViewById(R.id.medidaTemperaturaGeneral);
@@ -179,6 +171,44 @@
             }
         });
 
+        //switch luz
+        /*databaseReference.child("Mediciones general")
+                .child(uid).addValueEventListener(new ValueEventListener() {
+            @Override
+            public void onDataChange(@NonNull DataSnapshot snapshot) {
+                if(snapshot.exists()){
+                    String LuzPieza1= snapshot.child("LuzPieza1").getValue().toString();
+                    String LuzPieza2=snapshot.child("LuzPieza2").getValue().toString();
+                    String LuzPieza3=snapshot.child("LuzPieza3").getValue().toString();
+                    String LuzPuerta=snapshot.child("LuzPuerta").getValue().toString();
+                    String LuzTecho=snapshot.child("LuzTecho").getValue().toString();
+
+                    if(LuzPieza1.equals("0") && LuzPieza2.equals("0") && LuzPieza3.equals("0") && LuzPuerta.equals("0") && LuzTecho.equals("0")){
+                        switchLuz.setChecked(true);
+                    }else if(LuzPieza1.equals("1") && LuzPieza2.equals("1") && LuzPieza3.equals("1") && LuzPuerta.equals("1") && LuzTecho.equals("1")){
+                        switchLuz.setChecked(false);
+                    }
+
+                }
+            }
+            @Override
+            public void onCancelled(@NonNull DatabaseError error) {
+
+            }
+        });*/
+
+        switchLuz.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
+            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
+                if (isChecked) {
+                    // The toggle is enabled
+                    enviarLucesOn();
+                } else {
+                    // The toggle is disabled
+                    enviarLucesOff();
+                }
+            }
+        });
+
         return v;
     }
         /*btnmymachine.setOnClickListener(new View.OnClickListener() {
@@ -213,8 +243,8 @@
         //conexiÃ³n con el broker Root1 = Lector de datos
         //nos subscribimos a topic lectura
         try {
-            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones");//aqui estÃ¡ el root al que nos subscribimos si se quiere modificar se tiene que modificar este
-            client.subscribe(topicRoot + "operaciones", Mqtt.qos);
+            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones-"+uid);//aqui estÃ¡ el root al que nos subscribimos si se quiere modificar se tiene que modificar este
+            client.subscribe(topicRoot + "operaciones-"+uid, Mqtt.qos);
             client.setCallback((MqttCallback) this);
         } catch (MqttException e) {
             Log.e(Mqtt.TAG, "Error al suscribir.", e);
@@ -224,7 +254,7 @@
             MqttMessage message = new MqttMessage("1-OFF".getBytes());
             message.setQos(Mqtt.qos);
             message.setRetained(false);
-            client.publish(topicRoot+"operaciones", message);
+            client.publish(topicRoot+"operaciones-"+uid, message);
         } catch (MqttException e) {
             Log.e(Mqtt.TAG, "Error al publicar.", e);
         }
@@ -250,8 +280,8 @@
         //conexiÃ³n con el broker Root1 = Lector de datos
         //nos subscribimos a topic lectura
         try {
-            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones");//aqui estÃ¡ el root al que nos subscribimos si se quiere modificar se tiene que modificar este
-            client.subscribe(topicRoot + "operaciones", Mqtt.qos);
+            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones-"+uid);//aqui estÃ¡ el root al que nos subscribimos si se quiere modificar se tiene que modificar este
+            client.subscribe(topicRoot + "operaciones-"+uid, Mqtt.qos);
             client.setCallback((MqttCallback) this);
         } catch (MqttException e) {
             Log.e(Mqtt.TAG, "Error al suscribir.", e);
@@ -261,7 +291,7 @@
             MqttMessage message = new MqttMessage("1-ON".getBytes());
             message.setQos(Mqtt.qos);
             message.setRetained(false);
-            client.publish(topicRoot+"operaciones", message);
+            client.publish(topicRoot+"operaciones-"+uid, message);
         } catch (MqttException e) {
             Log.e(Mqtt.TAG, "Error al publicar.", e);
         }
Index: app/src/main/java/com/example/infinitycrop/ui/dashboard/Planta1Fragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.infinitycrop.ui.dashboard;\n\n\nimport android.os.Bundle;\n\nimport androidx.annotation.Nullable;\nimport androidx.fragment.app.Fragment;\n\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.TextView;\n\nimport com.example.infinitycrop.MainActivity;\nimport com.example.infinitycrop.R;\nimport com.google.firebase.firestore.DocumentSnapshot;\nimport com.google.firebase.firestore.EventListener;\nimport com.google.firebase.firestore.FirebaseFirestore;\nimport com.google.firebase.firestore.FirebaseFirestoreException;\n\n/**\n * A simple {@link Fragment} subclass.\n * Use the {@link GeneralFragment#newInstance} factory method to\n * create an instance of this fragment.\n */\npublic class Planta1Fragment extends Fragment {\n\n    // TODO: Rename parameter arguments, choose names that match\n    // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER\n    private static final String ARG_PARAM1 = \"param1\";\n    private static final String ARG_PARAM2 = \"param2\";\n    private String uid;\n    private FirebaseFirestore db;\n    // TODO: Rename and change types of parameters\n    private String mParam1;\n    private String mParam2;\n\n    public Planta1Fragment() {\n        // Required empty public constructor\n    }\n\n    /**\n     * Use this factory method to create a new instance of\n     * this fragment using the provided parameters.\n     *\n     * @param param1 Parameter 1.\n     * @param param2 Parameter 2.\n     * @return A new instance of fragment GeneralFragment.\n     */\n    // TODO: Rename and change types and number of parameters\n    public static GeneralFragment newInstance(String param1, String param2) {\n        GeneralFragment fragment = new GeneralFragment();\n        Bundle args = new Bundle();\n        args.putString(ARG_PARAM1, param1);\n        args.putString(ARG_PARAM2, param2);\n        fragment.setArguments(args);\n        return fragment;\n    }\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        if (getArguments() != null) {\n            mParam1 = getArguments().getString(ARG_PARAM1);\n            mParam2 = getArguments().getString(ARG_PARAM2);\n        }\n    }\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n        // Inflate the layout for this fragment\n        View v = inflater.inflate(R.layout.fragment_planta1, container, false);\n\n\n\n        db = FirebaseFirestore.getInstance();\n        MainActivity myActivity = (MainActivity) getActivity();\n        final TextView medidaTemp=v.findViewById(R.id.medidaTemperatura);\n        final TextView medidaHum=v.findViewById(R.id.medidaHumedad);\n        final TextView medidaHumAm=v.findViewById(R.id.medidaSalinidad);\n        /*final TextView medidaLuz=v.findViewById(R.id.medidasLuminosidad);*/\n        uid=myActivity.getMachineUID();\n        db.collection(\"Mediciones planta 1\")\n                .document(uid)\n                .addSnapshotListener(new EventListener<DocumentSnapshot>() {\n                    @Override\n                    public void onEvent(@Nullable DocumentSnapshot snapshot,\n                                        @Nullable FirebaseFirestoreException e) {\n                        if (e != null) {\n                            return;\n                        }\n\n                        if (snapshot != null && snapshot.exists()) {\n                            //Temperatura\n                            String medidaT=snapshot.getString(\"Temperatura\");\n                            medidaTemp.setText(medidaT+\"Â°C\");\n                            //Humedad\n                            String medidaH=snapshot.getString(\"Humedad\");\n                            medidaHum.setText(medidaH+\"%\");\n                            //Humedad Ambiente\n                            String medidaHA=snapshot.getString(\"Humedad Ambiente\");\n                            medidaHumAm.setText(medidaHA+\"%\");\n                            //Luminosidad\n                            /*String medidaL=snapshot.getString(\"Luminosidad\");\n                            medidaLuz.setText(medidaL+\"%\");*/\n\n\n                        } else {\n\n                        }\n                    }\n                });\n        return v;\n    }\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/infinitycrop/ui/dashboard/Planta1Fragment.java	(revision c8202bf3ec3c20b3208068f5eda44f36cbcc1991)
+++ app/src/main/java/com/example/infinitycrop/ui/dashboard/Planta1Fragment.java	(date 1611260895157)
@@ -3,38 +3,60 @@
 
 import android.os.Bundle;
 
+import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 import androidx.fragment.app.Fragment;
 
+import android.util.Log;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
+import android.widget.CompoundButton;
+import android.widget.Switch;
 import android.widget.TextView;
 
+import com.example.comun.Mqtt;
 import com.example.infinitycrop.MainActivity;
 import com.example.infinitycrop.R;
+import com.google.firebase.database.DataSnapshot;
+import com.google.firebase.database.DatabaseError;
+import com.google.firebase.database.DatabaseReference;
+import com.google.firebase.database.FirebaseDatabase;
+import com.google.firebase.database.ValueEventListener;
 import com.google.firebase.firestore.DocumentSnapshot;
 import com.google.firebase.firestore.EventListener;
 import com.google.firebase.firestore.FirebaseFirestore;
 import com.google.firebase.firestore.FirebaseFirestoreException;
 
+import org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;
+import org.eclipse.paho.client.mqttv3.MqttCallback;
+import org.eclipse.paho.client.mqttv3.MqttClient;
+import org.eclipse.paho.client.mqttv3.MqttConnectOptions;
+import org.eclipse.paho.client.mqttv3.MqttException;
+import org.eclipse.paho.client.mqttv3.MqttMessage;
+import org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;
+
+import static com.example.comun.Mqtt.topicRoot;
+
 /**
  * A simple {@link Fragment} subclass.
  * Use the {@link GeneralFragment#newInstance} factory method to
  * create an instance of this fragment.
  */
-public class Planta1Fragment extends Fragment {
+public class Planta1Fragment extends Fragment implements MqttCallback{
 
     // TODO: Rename parameter arguments, choose names that match
     // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER
     private static final String ARG_PARAM1 = "param1";
     private static final String ARG_PARAM2 = "param2";
+    private DatabaseReference databaseReference;
     private String uid;
     private FirebaseFirestore db;
     // TODO: Rename and change types of parameters
     private String mParam1;
     private String mParam2;
-
+    private Switch switchLuz;
+    public static MqttClient client = null;
     public Planta1Fragment() {
         // Required empty public constructor
     }
@@ -72,8 +94,8 @@
         // Inflate the layout for this fragment
         View v = inflater.inflate(R.layout.fragment_planta1, container, false);
 
-
-
+        switchLuz=v.findViewById(R.id.switchLuminosidadPlamta1);
+        databaseReference= FirebaseDatabase.getInstance().getReference();
         db = FirebaseFirestore.getInstance();
         MainActivity myActivity = (MainActivity) getActivity();
         final TextView medidaTemp=v.findViewById(R.id.medidaTemperatura);
@@ -111,6 +133,135 @@
                         }
                     }
                 });
+
+
+        //switch luz
+        /*databaseReference.child("Mediciones general")
+                .child(uid).addValueEventListener(new ValueEventListener() {
+            @Override
+            public void onDataChange(@NonNull DataSnapshot snapshot) {
+                if(snapshot.exists()){
+                    String LuzPieza1= snapshot.child("LuzPieza1").getValue().toString();
+                    String LuzPieza2=snapshot.child("LuzPieza2").getValue().toString();
+                    String LuzPieza3=snapshot.child("LuzPieza3").getValue().toString();
+                    String LuzPuerta=snapshot.child("LuzPuerta").getValue().toString();
+                    String LuzTecho=snapshot.child("LuzTecho").getValue().toString();
+
+                    if(LuzPieza1.equals("0") && LuzPieza2.equals("0") && LuzTecho.equals("0")){
+                        switchLuz.setChecked(true);
+                    }else if(LuzPieza1.equals("1") && LuzPieza2.equals("1") && LuzTecho.equals("1")){
+                        switchLuz.setChecked(false);
+                    }
+
+                }
+            }
+            @Override
+            public void onCancelled(@NonNull DatabaseError error) {
+
+            }
+        });*/
+
+        switchLuz.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
+            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
+                if (isChecked) {
+                    // The toggle is enabled
+                    enviarLucesOn();
+                } else {
+                    // The toggle is disabled
+                    enviarLucesOff();
+                }
+            }
+        });
         return v;
     }
+
+    public void enviarLucesOff(){
+        try {
+            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new
+                    MemoryPersistence());
+        } catch (MqttException e) {
+            e.printStackTrace();
+        }
+        MqttConnectOptions connOpts = new MqttConnectOptions();
+        connOpts.setCleanSession(true);
+        connOpts.setKeepAliveInterval(60);
+        connOpts.setWill(topicRoot+"WillTopic", "App desconectada".getBytes(),Mqtt.qos, false);
+
+        try {
+            client.connect(connOpts);
+        } catch (MqttException e) {
+            e.printStackTrace();
+        }
+
+        //conexiÃ³n con el broker Root1 = Lector de datos
+        //nos subscribimos a topic lectura
+        try {
+            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones-"+uid);//aqui estÃ¡ el root al que nos subscribimos si se quiere modificar se tiene que modificar este
+            client.subscribe(topicRoot + "operaciones-"+uid, Mqtt.qos);
+            client.setCallback((MqttCallback) this);
+        } catch (MqttException e) {
+            Log.e(Mqtt.TAG, "Error al suscribir.", e);
+        }
+        try {
+            Log.i(Mqtt.TAG, "Publicando mensaje: " + "mensaje");
+            MqttMessage message = new MqttMessage("2-OFF".getBytes());
+            message.setQos(Mqtt.qos);
+            message.setRetained(false);
+            client.publish(topicRoot+"operaciones-"+uid, message);
+        } catch (MqttException e) {
+            Log.e(Mqtt.TAG, "Error al publicar.", e);
+        }
+    }
+    public void enviarLucesOn(){
+        try {
+            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new
+                    MemoryPersistence());
+        } catch (MqttException e) {
+            e.printStackTrace();
+        }
+        MqttConnectOptions connOpts = new MqttConnectOptions();
+        connOpts.setCleanSession(true);
+        connOpts.setKeepAliveInterval(60);
+        connOpts.setWill(topicRoot+"WillTopic", "App desconectada".getBytes(),Mqtt.qos, false);
+
+        try {
+            client.connect(connOpts);
+        } catch (MqttException e) {
+            e.printStackTrace();
+        }
+
+        //conexiÃ³n con el broker Root1 = Lector de datos
+        //nos subscribimos a topic lectura
+        try {
+            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones-"+uid);//aqui estÃ¡ el root al que nos subscribimos si se quiere modificar se tiene que modificar este
+            client.subscribe(topicRoot + "operaciones-"+uid, Mqtt.qos);
+            client.setCallback((MqttCallback) this);
+        } catch (MqttException e) {
+            Log.e(Mqtt.TAG, "Error al suscribir.", e);
+        }
+        try {
+            Log.i(Mqtt.TAG, "Publicando mensaje: " + "mensaje");
+            MqttMessage message = new MqttMessage("2-ON".getBytes());
+            message.setQos(Mqtt.qos);
+            message.setRetained(false);
+            client.publish(topicRoot+"operaciones-"+uid, message);
+        } catch (MqttException e) {
+            Log.e(Mqtt.TAG, "Error al publicar.", e);
+        }
+    }
+
+    @Override
+    public void connectionLost(Throwable cause) {
+
+    }
+
+    @Override
+    public void messageArrived(String topic, MqttMessage message) throws Exception {
+
+    }
+
+    @Override
+    public void deliveryComplete(IMqttDeliveryToken token) {
+
+    }
 }
\ No newline at end of file
