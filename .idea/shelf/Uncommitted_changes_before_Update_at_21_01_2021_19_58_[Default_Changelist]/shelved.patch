Index: app/src/main/AndroidManifest.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    package=\"com.example.infinitycrop\">\n\n    <uses-permission android:name=\"android.permission.READ_EXTERNAL_STORAGE\" />\n    <uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\" />\n    <uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />\n    <uses-permission android:name=\"android.permission.ACCESS_COARSE_LOCATION\" />\n    <uses-permission android:name=\"android.permission.INTERNET\" />\n    <uses-permission android:name=\"com.google.android.things.permission.MANAGE_INPUT_DRIVERS\" />\n    <uses-permission android:name=\"com.google.android.things.permission.USE_PERIPHERAL_IO\" /> <!-- Permisos Qr -->\n    <uses-permission android:name=\"android.permission.CAMERA\" />\n    <uses-permission android:name=\"com.android.alarm.permission.SET_ALARM\" />\n\n    <uses-feature android:name=\"android.hardware.camera\" />\n    <uses-feature android:name=\"android.hardware.camera.autofocus\" />\n\n    <application\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher\"\n        android:theme=\"@style/AppThemeHome\">\n        <activity android:name=\".ui.dashboard.CreateClima\"></activity>\n        <activity android:name=\".ui.Foro.main.Community.NewPost.PostView\" />\n        <activity android:name=\".ui.Foro.main.Community.NewPost.CreatePost.CreatePost\" />\n        <activity android:name=\".ui.Foro.main.Community.CommunityMain\" />\n        <activity android:name=\".ui.Foro.lets_start.EditCommunity\" />\n        <activity android:name=\".ui.list_machine.ModifyMachine\" />\n        <activity android:name=\".ui.Foro.main.ForoMain\" />\n        <activity android:name=\".ui.Foro.lets_start.AddCommunity\" />\n        <activity android:name=\".ui.Foro.lets_start.choose_community\" />\n        <activity android:name=\".ui.Foro.lets_start.welcome_forum\" />\n        <activity android:name=\".MainActivity\" />\n\n        <service android:name=\".ui.service.ServicioMqtt\" />\n        <service android:name=\".ui.service.ServicioNotificaciones\" />\n\n        <activity android:name=\".ui.LoadAnimations.IntroductoryActivity\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.SET_ALARM\" />\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n        <activity android:name=\".ui.profile.settings.AboutInfinityCrap\" />\n        <activity android:name=\".ui.profile.settings.HelpProfile\" />\n        <activity android:name=\".ui.list_machine.MainActivityMachineList\" />\n        <activity android:name=\".ui.list_machine.AddMachine\" />\n        <activity android:name=\".ui.profile.settings.ModifyProfile\" />\n        <activity android:name=\".ui.logmail.RegisterActivity\" />\n        <activity android:name=\".ui.logmail.LoginActivity\" />\n        <activity android:name=\".ui.list_machine.CaptureAct\" />\n        <activity android:name=\".ui.login.LogActivity\" />\n        <activity android:name=\".ui.LoadAnimations.IntroductoryActivity2\" />\n        <activity android:name=\".ui.LoadAnimations.LogprimeraActivity\" />\n        <activity android:name=\".ui.graphics.GraphicsActivity\" />\n        <activity android:name=\".ui.MachineControl.planta1\" />\n        <activity android:name=\".ui.notifications.NotificacionesActivity\" />\n        <activity android:name=\".ui.guiabotanica.GuiaActivity\" />\n        <activity android:name=\".ui.guiabotanica.PlantActivity\" />\n\n        <meta-data\n            android:name=\"com.google.android.geo.API_KEY\"\n            android:value=\"@string/google_maps_key\" />\n        <meta-data\n            android:name=\"com.facebook.sdk.ApplicationId\"\n            android:value=\"@string/facebook_app_id\"\n            tools:replace=\"android:value\" />\n        <meta-data\n            android:name=\"preloaded_fonts\"\n            android:resource=\"@array/preloaded_fonts\" />\n\n        <activity\n            android:name=\"com.theartofdev.edmodo.cropper.CropImageActivity\"\n            android:theme=\"@style/Base.Theme.AppCompat\" />\n    </application>\n\n</manifest>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/AndroidManifest.xml	(revision 6a46eaa504348e2e3bd04e08f565c03719a31f9d)
+++ app/src/main/AndroidManifest.xml	(date 1611252890544)
@@ -22,7 +22,8 @@
         android:label="@string/app_name"
         android:roundIcon="@mipmap/ic_launcher"
         android:theme="@style/AppThemeHome">
-        <activity android:name=".ui.dashboard.CreateClima"></activity>
+        <activity android:name=".ui.dashboard.EditarClima"></activity>
+        <activity android:name=".ui.dashboard.CreateClima" />
         <activity android:name=".ui.Foro.main.Community.NewPost.PostView" />
         <activity android:name=".ui.Foro.main.Community.NewPost.CreatePost.CreatePost" />
         <activity android:name=".ui.Foro.main.Community.CommunityMain" />
Index: app/src/main/res/layout/bottom_sheet_create_clima.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\">\r\n    <Button\r\n        android:id=\"@+id/createNewClima\"\r\n        android:layout_width=\"0dp\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginStart=\"24dp\"\r\n        android:layout_marginTop=\"32dp\"\r\n        android:layout_marginEnd=\"24dp\"\r\n        android:background=\"@drawable/button_enter_machine\"\r\n        android:stateListAnimator=\"@null\"\r\n        android:text=\"Acceder a la máquina\"\r\n        android:textAllCaps=\"false\"\r\n        android:textColor=\"#FFFFFF\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintHorizontal_bias=\"0.5\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n    <Button\r\n        android:id=\"@+id/createDefaultClima\"\r\n        android:layout_width=\"0dp\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginStart=\"24dp\"\r\n        android:layout_marginTop=\"16dp\"\r\n        android:layout_marginEnd=\"24dp\"\r\n        android:background=\"@drawable/button_action_machine\"\r\n        android:stateListAnimator=\"@null\"\r\n        android:text=\"Modificar máquina\"\r\n        android:textAllCaps=\"false\"\r\n        android:textColor=\"@color/colorPrimaryDashboard\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintHorizontal_bias=\"0.5\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/createNewClima\" />\r\n\r\n    <Button\r\n        android:id=\"@+id/btn_cancelarCreateClima\"\r\n        android:layout_width=\"0dp\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginStart=\"24dp\"\r\n        android:layout_marginTop=\"16dp\"\r\n        android:layout_marginEnd=\"24dp\"\r\n        android:background=\"@drawable/button_action_machine\"\r\n        android:stateListAnimator=\"@null\"\r\n        android:text=\"Cancelar\"\r\n        android:textAllCaps=\"false\"\r\n        android:textColor=\"@color/colorPrimaryDashboard\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintHorizontal_bias=\"0.5\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/createDefaultClima\" />\r\n</androidx.constraintlayout.widget.ConstraintLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/bottom_sheet_create_clima.xml	(revision 6a46eaa504348e2e3bd04e08f565c03719a31f9d)
+++ app/src/main/res/layout/bottom_sheet_create_clima.xml	(date 1611250710601)
@@ -1,8 +1,10 @@
 <?xml version="1.0" encoding="utf-8"?>
 <androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
     android:layout_width="match_parent"
-    android:layout_height="match_parent"
+    android:layout_height="wrap_content"
+    android:background="@drawable/bottom_sheet_background"
     xmlns:app="http://schemas.android.com/apk/res-auto">
+
     <Button
         android:id="@+id/createNewClima"
         android:layout_width="0dp"
@@ -12,7 +14,7 @@
         android:layout_marginEnd="24dp"
         android:background="@drawable/button_enter_machine"
         android:stateListAnimator="@null"
-        android:text="Acceder a la máquina"
+        android:text="Crear nuevo clima"
         android:textAllCaps="false"
         android:textColor="#FFFFFF"
         app:layout_constraintEnd_toEndOf="parent"
@@ -29,7 +31,7 @@
         android:layout_marginEnd="24dp"
         android:background="@drawable/button_action_machine"
         android:stateListAnimator="@null"
-        android:text="Modificar máquina"
+        android:text="Crear apartir del clima por defecto"
         android:textAllCaps="false"
         android:textColor="@color/colorPrimaryDashboard"
         app:layout_constraintEnd_toEndOf="parent"
@@ -44,11 +46,13 @@
         android:layout_marginStart="24dp"
         android:layout_marginTop="16dp"
         android:layout_marginEnd="24dp"
+        android:layout_marginBottom="40dp"
         android:background="@drawable/button_action_machine"
         android:stateListAnimator="@null"
         android:text="Cancelar"
         android:textAllCaps="false"
         android:textColor="@color/colorPrimaryDashboard"
+        app:layout_constraintBottom_toBottomOf="parent"
         app:layout_constraintEnd_toEndOf="parent"
         app:layout_constraintHorizontal_bias="0.5"
         app:layout_constraintStart_toStartOf="parent"
Index: app/src/main/java/com/example/infinitycrop/ui/dashboard/RvClimas/AdapterClimas.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.infinitycrop.ui.dashboard.RvClimas;\r\n\r\nimport android.content.Context;\r\nimport android.util.Log;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.ImageView;\r\nimport android.widget.LinearLayout;\r\nimport android.widget.TextView;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport com.example.comun.Mqtt;\r\nimport com.example.infinitycrop.R;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.firestore.DocumentSnapshot;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\nimport com.google.firebase.firestore.QueryDocumentSnapshot;\r\nimport com.google.firebase.firestore.QuerySnapshot;\r\nimport com.squareup.picasso.Picasso;\r\n\r\nimport org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;\r\nimport org.eclipse.paho.client.mqttv3.MqttCallback;\r\nimport org.eclipse.paho.client.mqttv3.MqttClient;\r\nimport org.eclipse.paho.client.mqttv3.MqttConnectOptions;\r\nimport org.eclipse.paho.client.mqttv3.MqttException;\r\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\r\nimport org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;\r\n\r\nimport java.util.List;\r\n\r\nimport static com.example.comun.Mqtt.topicRoot;\r\n\r\npublic class AdapterClimas extends RecyclerView.Adapter<AdapterClimas.ClimasHolder>  implements  View.OnClickListener,MqttCallback {\r\n\r\n    //Acceso a la maquina\r\n    public static MqttClient client = null;\r\n    private List<ClimaModel> climaModelList;\r\n    private Context context;\r\n    private FirebaseFirestore db;\r\n    private View.OnClickListener listener;\r\n    private FirebaseAuth firebaseAuth;\r\n    private String machineId;\r\n\r\n    public AdapterClimas(List<ClimaModel> climaModelList, Context context,String machineId) {\r\n        this.climaModelList = climaModelList;\r\n        this.context = context;\r\n        this.machineId=machineId;\r\n    }\r\n\r\n    @NonNull\r\n    @Override\r\n    public ClimasHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\r\n        View v= LayoutInflater.from(parent.getContext())\r\n                .inflate(R.layout.static_rv_item,parent,false);\r\n        v.setOnClickListener(this);\r\n        return new ClimasHolder(v);\r\n    }\r\n\r\n    @Override\r\n    public void onBindViewHolder(@NonNull final ClimasHolder holder, int position) {\r\n        db=FirebaseFirestore.getInstance();\r\n        final ClimaModel climaModel=climaModelList.get(position);\r\n\r\n        holder.textView.setText(climaModel.getName());\r\n        //String idMachine=climaModel.getMachineId();\r\n        String climaID=climaModel.getUid();\r\n        final String[] idRealMachine = {\"\"};\r\n\r\n        //recupera el id del documento en la coleccion Machine\r\n\r\n        db.collection(\"Machine\")\r\n                .whereEqualTo(\"description\",machineId)\r\n                .limit(1)\r\n                .get()\r\n                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<QuerySnapshot> task) {\r\n                        if (task.isSuccessful()) {\r\n                            for (QueryDocumentSnapshot document : task.getResult()) {\r\n                                idRealMachine[0] =document.getId();\r\n                            }\r\n                            db.collection(\"Machine\").document(idRealMachine[0]).collection(\"Clima\")\r\n                                    .document(\"Activado\").get()\r\n                                    .addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n                                        @Override\r\n                                        public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                                            if (task.isSuccessful()) {\r\n                                                DocumentSnapshot document = task.getResult();\r\n                                                if (document.exists()) {\r\n                                                    String climaActivated= document.getString(\"climaID\");\r\n                                                    if(climaModel.getUid().equals(climaActivated)){\r\n                                                        holder.linearLayout.setBackgroundResource(R.drawable.button_action_machine);\r\n                                                        setClimaTemperatura(machineId,climaModel.getTemperatura(),climaModel.getHumedad());\r\n                                                    }\r\n                                                } else {\r\n\r\n                                                }\r\n                                            } else {\r\n\r\n                                            }\r\n                                        }\r\n                                    });\r\n\r\n                        } else {\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n\r\n        /*db.collection(\"Machine\")\r\n                .whereEqualTo(\"description\",machineId)\r\n                .limit(1)\r\n                .get()\r\n                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<QuerySnapshot> task) {\r\n                        if (task.isSuccessful()) {\r\n                            String idRealMachine=\"\";\r\n                            for (QueryDocumentSnapshot document : task.getResult()) {\r\n                                idRealMachine=document.getId();\r\n                            }\r\n\r\n                            db.collection(\"Machine\").document(idRealMachine).collection(\"Clima\")\r\n                                    .document(\"Activado\").get()\r\n                                    .addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n                                @Override\r\n                                public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                                    if (task.isSuccessful()) {\r\n                                        DocumentSnapshot document = task.getResult();\r\n                                        if (document.exists()) {\r\n                                            String idClima=document.getString(\"climaID\");\r\n                                            if(climaModel.getUid().equals(idClima)){\r\n                                                holder.linearLayout.setBackgroundResource(R.drawable.button_action_machine);\r\n                                            }\r\n\r\n\r\n                                        } else {\r\n\r\n                                        }\r\n                                    } else {\r\n\r\n                                    }\r\n                                }\r\n                            });\r\n                        } else {\r\n\r\n                        }\r\n                    }\r\n                });*/\r\n    }\r\n\r\n    private void getClimaIdActivated(String UidMachine){\r\n\r\n    }\r\n\r\n    @Override\r\n    public int getItemCount() {\r\n        return climaModelList.size();\r\n    }\r\n\r\n    //onclick\r\n\r\n    public void setOnClickListener(View.OnClickListener listener) {\r\n        this.listener = listener;\r\n    }\r\n\r\n    @Override\r\n    public void onClick(View v) {\r\n        if(listener!=null){\r\n            listener.onClick(v);\r\n        }\r\n    }\r\n\r\n    //MQTT -> INICIO\r\n\r\n    public void setClimaTemperatura(String machine,String temperatura,String humedad){\r\n        String mensaje=machine+\"-5-\"+temperatura;\r\n        try {\r\n            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new\r\n                    MemoryPersistence());\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n        MqttConnectOptions connOpts = new MqttConnectOptions();\r\n        connOpts.setCleanSession(true);\r\n        connOpts.setKeepAliveInterval(60);\r\n        connOpts.setWill(topicRoot+\"WillTopic\", \"App desconectada\".getBytes(),Mqtt.qos, false);\r\n\r\n        try {\r\n            client.connect(connOpts);\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        //conexión con el broker Root1 = Lector de datos\r\n        //nos subscribimos a topic\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Subscrito a \" + topicRoot + \"operaciones\");//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este\r\n            client.subscribe(topicRoot + \"operaciones\", Mqtt.qos);\r\n            client.setCallback((MqttCallback) this);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al suscribir.\", e);\r\n        }\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Publicando mensaje: \" + \"mensaje\");\r\n            MqttMessage message = new MqttMessage(mensaje.getBytes());\r\n            message.setQos(Mqtt.qos);\r\n            message.setRetained(false);\r\n            client.publish(topicRoot+\"operaciones\", message);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al publicar.\", e);\r\n        }\r\n        setClimaHumedad(machineId,humedad);\r\n    }\r\n    public void setClimaHumedad(String machine,String humedad){\r\n        String mensaje=machine+\"-4-\"+humedad;\r\n        try {\r\n            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new\r\n                    MemoryPersistence());\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n        MqttConnectOptions connOpts = new MqttConnectOptions();\r\n        connOpts.setCleanSession(true);\r\n        connOpts.setKeepAliveInterval(60);\r\n        connOpts.setWill(topicRoot+\"WillTopic\", \"App desconectada\".getBytes(),Mqtt.qos, false);\r\n\r\n        try {\r\n            client.connect(connOpts);\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        //conexión con el broker Root1 = Lector de datos\r\n        //nos subscribimos a topic\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Subscrito a \" + topicRoot + \"operaciones\");//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este\r\n            client.subscribe(topicRoot + \"operaciones\", Mqtt.qos);\r\n            client.setCallback((MqttCallback) this);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al suscribir.\", e);\r\n        }\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Publicando mensaje: \" + \"mensaje\");\r\n            MqttMessage message = new MqttMessage(mensaje.getBytes());\r\n            message.setQos(Mqtt.qos);\r\n            message.setRetained(false);\r\n            client.publish(topicRoot+\"operaciones\", message);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al publicar.\", e);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void connectionLost(Throwable cause) {\r\n\r\n    }\r\n\r\n    @Override\r\n    public void messageArrived(String topic, MqttMessage message) throws Exception {\r\n\r\n    }\r\n\r\n    @Override\r\n    public void deliveryComplete(IMqttDeliveryToken token) {\r\n\r\n    }\r\n\r\n\r\n\r\n    //MQTT-> FIN\r\n\r\n    public static class ClimasHolder extends RecyclerView.ViewHolder{\r\n        protected TextView textView;\r\n        protected ImageView imageView;\r\n        protected LinearLayout linearLayout;\r\n        public ClimasHolder(@NonNull View itemView) {\r\n            super(itemView);\r\n            imageView=itemView.findViewById(R.id.image);\r\n            textView=itemView.findViewById(R.id.text);\r\n            linearLayout=itemView.findViewById(R.id.linearLayoutItem);\r\n        }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/infinitycrop/ui/dashboard/RvClimas/AdapterClimas.java	(revision 6a46eaa504348e2e3bd04e08f565c03719a31f9d)
+++ app/src/main/java/com/example/infinitycrop/ui/dashboard/RvClimas/AdapterClimas.java	(date 1611254516426)
@@ -180,7 +180,7 @@
     //MQTT -> INICIO
 
     public void setClimaTemperatura(String machine,String temperatura,String humedad){
-        String mensaje=machine+"-5-"+temperatura;
+        String mensaje="5-"+temperatura;
         try {
             client = new MqttClient(Mqtt.broker, Mqtt.clientId, new
                     MemoryPersistence());
@@ -201,8 +201,8 @@
         //conexión con el broker Root1 = Lector de datos
         //nos subscribimos a topic
         try {
-            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones");//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este
-            client.subscribe(topicRoot + "operaciones", Mqtt.qos);
+            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones-"+machine);//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este
+            client.subscribe(topicRoot + "operaciones-"+machine, Mqtt.qos);
             client.setCallback((MqttCallback) this);
         } catch (MqttException e) {
             Log.e(Mqtt.TAG, "Error al suscribir.", e);
@@ -212,14 +212,14 @@
             MqttMessage message = new MqttMessage(mensaje.getBytes());
             message.setQos(Mqtt.qos);
             message.setRetained(false);
-            client.publish(topicRoot+"operaciones", message);
+            client.publish(topicRoot+"operaciones-"+machine, message);
         } catch (MqttException e) {
             Log.e(Mqtt.TAG, "Error al publicar.", e);
         }
         setClimaHumedad(machineId,humedad);
     }
     public void setClimaHumedad(String machine,String humedad){
-        String mensaje=machine+"-4-"+humedad;
+        String mensaje="4-"+humedad;
         try {
             client = new MqttClient(Mqtt.broker, Mqtt.clientId, new
                     MemoryPersistence());
@@ -240,8 +240,8 @@
         //conexión con el broker Root1 = Lector de datos
         //nos subscribimos a topic
         try {
-            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones");//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este
-            client.subscribe(topicRoot + "operaciones", Mqtt.qos);
+            Log.i(Mqtt.TAG, "Subscrito a " + topicRoot + "operaciones-"+machine);//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este
+            client.subscribe(topicRoot + "operaciones-"+machine, Mqtt.qos);
             client.setCallback((MqttCallback) this);
         } catch (MqttException e) {
             Log.e(Mqtt.TAG, "Error al suscribir.", e);
@@ -251,7 +251,7 @@
             MqttMessage message = new MqttMessage(mensaje.getBytes());
             message.setQos(Mqtt.qos);
             message.setRetained(false);
-            client.publish(topicRoot+"operaciones", message);
+            client.publish(topicRoot+"operaciones-"+machine, message);
         } catch (MqttException e) {
             Log.e(Mqtt.TAG, "Error al publicar.", e);
         }
Index: app/src/main/java/com/example/infinitycrop/ui/control_panel/Control_panelFragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.infinitycrop.ui.control_panel;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\n\r\nimport androidx.constraintlayout.widget.ConstraintLayout;\r\nimport androidx.fragment.app.Fragment;\r\n\r\nimport android.util.Log;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\n\r\nimport com.example.infinitycrop.MainActivity;\r\nimport com.example.infinitycrop.R;\r\nimport com.example.infinitycrop.ui.Foro.lets_start.welcome_forum;\r\nimport com.example.infinitycrop.ui.graphics.GraphicsActivity;\r\nimport com.example.infinitycrop.ui.guiabotanica.GuiaActivity;\r\nimport com.example.infinitycrop.ui.notifications.NotificacionesActivity;\r\n\r\n/**\r\n * A simple {@link Fragment} subclass.\r\n * Use the {@link Control_panelFragment#newInstance} factory method to\r\n * create an instance of this fragment.\r\n */\r\npublic class Control_panelFragment extends Fragment {\r\n\r\n    private String uid;\r\n\r\n    // TODO: Rename parameter arguments, choose names that match\r\n    // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER\r\n    private static final String ARG_PARAM1 = \"param1\";\r\n    private static final String ARG_PARAM2 = \"param2\";\r\n\r\n    // TODO: Rename and change types of parameters\r\n    private String mParam1;\r\n    private String mParam2;\r\n    private ConstraintLayout btn_forum;\r\n    private ConstraintLayout btn_grafics;\r\n    private ConstraintLayout btn_notificaciones;\r\n    private ConstraintLayout btn_guia;\r\n\r\n    public Control_panelFragment() {\r\n        // Required empty public constructor\r\n    }\r\n\r\n    /**\r\n     * Use this factory method to create a new instance of\r\n     * this fragment using the provided parameters.\r\n     *\r\n     * @param param1 Parameter 1.\r\n     * @param param2 Parameter 2.\r\n     * @return A new instance of fragment control_panel.\r\n     */\r\n    // TODO: Rename and change types and number of parameters\r\n    public static Control_panelFragment newInstance(String param1, String param2) {\r\n        Control_panelFragment fragment = new Control_panelFragment();\r\n        Bundle args = new Bundle();\r\n        args.putString(ARG_PARAM1, param1);\r\n        args.putString(ARG_PARAM2, param2);\r\n        fragment.setArguments(args);\r\n        return fragment;\r\n    }\r\n\r\n    @Override\r\n    public void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        if (getArguments() != null) {\r\n            mParam1 = getArguments().getString(ARG_PARAM1);\r\n            mParam2 = getArguments().getString(ARG_PARAM2);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\r\n                             Bundle savedInstanceState) {\r\n        // Inflate the layout for this fragment\r\n        View v= inflater.inflate(R.layout.fragment_control_panel, container, false);\r\n        MainActivity myActivity = (MainActivity)getActivity();\r\n        uid=myActivity.getMachineUID();\r\n\r\n        //buttons\r\n        btn_forum=v.findViewById(R.id.btn_forum);\r\n\r\n        //onClick\r\n        btn_forum.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(getActivity(), welcome_forum.class);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n\r\n\r\n\r\n        //buttons\r\n        btn_grafics=v.findViewById(R.id.btn_graficas);\r\n\r\n        //onClick\r\n        btn_grafics.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(getActivity(), GraphicsActivity.class);\r\n                intent.putExtra(\"idMachine\", uid);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n\r\n\r\n        //buttons\r\n        btn_notificaciones=v.findViewById(R.id.btn_notificaciones);\r\n\r\n        //onClick\r\n        btn_notificaciones.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(getActivity(), NotificacionesActivity.class);\r\n                intent.putExtra(\"idMachine\", uid);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n\r\n        //buttons\r\n        btn_guia=v.findViewById(R.id.btn_guia_botanica);\r\n\r\n        //onClick\r\n        btn_guia.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(getActivity(), GuiaActivity.class);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n\r\n        return v;\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/infinitycrop/ui/control_panel/Control_panelFragment.java	(revision 6a46eaa504348e2e3bd04e08f565c03719a31f9d)
+++ app/src/main/java/com/example/infinitycrop/ui/control_panel/Control_panelFragment.java	(date 1611255085673)
@@ -3,6 +3,7 @@
 import android.content.Intent;
 import android.os.Bundle;
 
+import androidx.annotation.NonNull;
 import androidx.constraintlayout.widget.ConstraintLayout;
 import androidx.fragment.app.Fragment;
 
@@ -14,9 +15,15 @@
 import com.example.infinitycrop.MainActivity;
 import com.example.infinitycrop.R;
 import com.example.infinitycrop.ui.Foro.lets_start.welcome_forum;
+import com.example.infinitycrop.ui.Foro.main.ForoMain;
 import com.example.infinitycrop.ui.graphics.GraphicsActivity;
 import com.example.infinitycrop.ui.guiabotanica.GuiaActivity;
 import com.example.infinitycrop.ui.notifications.NotificacionesActivity;
+import com.google.android.gms.tasks.OnCompleteListener;
+import com.google.android.gms.tasks.Task;
+import com.google.firebase.auth.FirebaseAuth;
+import com.google.firebase.firestore.DocumentSnapshot;
+import com.google.firebase.firestore.FirebaseFirestore;
 
 /**
  * A simple {@link Fragment} subclass.
@@ -71,6 +78,9 @@
         }
     }
 
+    private FirebaseFirestore db;
+    private FirebaseAuth firebaseAuth;
+    private String idAuth;
     @Override
     public View onCreateView(LayoutInflater inflater, ViewGroup container,
                              Bundle savedInstanceState) {
@@ -79,6 +89,9 @@
         MainActivity myActivity = (MainActivity)getActivity();
         uid=myActivity.getMachineUID();
 
+        db=FirebaseFirestore.getInstance();
+        firebaseAuth= FirebaseAuth.getInstance();
+        idAuth=firebaseAuth.getUid();
         //buttons
         btn_forum=v.findViewById(R.id.btn_forum);
 
@@ -86,8 +99,24 @@
         btn_forum.setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
-                Intent intent = new Intent(getActivity(), welcome_forum.class);
-                startActivity(intent);
+                db.collection("Foro user").document(idAuth)
+                        .get().addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {
+                    @Override
+                    public void onComplete(@NonNull Task<DocumentSnapshot> task) {
+                        if (task.isSuccessful()) {
+                            DocumentSnapshot document = task.getResult();
+                            if (document.exists()) {
+                                Intent intent = new Intent(getActivity(), ForoMain.class);
+                                startActivity(intent);
+                            } else {
+                                Intent intent = new Intent(getActivity(), welcome_forum.class);
+                                startActivity(intent);
+                            }
+                        } else {
+
+                        }
+                    }
+                });
             }
         });
 
Index: app/src/main/java/com/example/infinitycrop/ui/dashboard/DashboardFragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.infinitycrop.ui.dashboard;\r\n\r\nimport android.Manifest;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.content.pm.PackageManager;\r\nimport android.location.Location;\r\nimport android.location.LocationListener;\r\nimport android.location.LocationManager;\r\nimport android.os.AsyncTask;\r\nimport android.os.Bundle;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AlertDialog;\r\nimport androidx.core.app.ActivityCompat;\r\nimport androidx.fragment.app.Fragment;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\nimport androidx.viewpager.widget.ViewPager;\r\n\r\nimport android.os.Handler;\r\nimport android.os.StrictMode;\r\nimport android.util.Log;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.Button;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.example.comun.Mqtt;\r\nimport com.example.infinitycrop.MainActivity;\r\nimport com.example.infinitycrop.R;\r\nimport com.example.infinitycrop.ui.Foro.lets_start.rv_community.CommunityModel;\r\nimport com.example.infinitycrop.ui.Foro.main.Home.RVs.RVFollowed.AdapterFollowedCmty;\r\nimport com.example.infinitycrop.ui.MachineControl.planta1;\r\nimport com.example.infinitycrop.ui.dashboard.RvClimas.AdapterClimas;\r\nimport com.example.infinitycrop.ui.dashboard.RvClimas.ClimaModel;\r\nimport com.example.infinitycrop.ui.recycler_control.StaticRvAdapter;\r\nimport com.example.infinitycrop.ui.recycler_control.StaticRvModel;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.android.material.bottomsheet.BottomSheetDialog;\r\nimport com.google.android.material.tabs.TabLayout;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.FirebaseUser;\r\nimport com.google.firebase.firestore.DocumentSnapshot;\r\nimport com.google.firebase.firestore.EventListener;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\nimport com.google.firebase.firestore.FirebaseFirestoreException;\r\nimport com.google.firebase.firestore.Query;\r\nimport com.google.firebase.firestore.QueryDocumentSnapshot;\r\nimport com.google.firebase.firestore.QuerySnapshot;\r\nimport com.loopj.android.http.AsyncHttpClient;\r\nimport com.loopj.android.http.JsonHttpResponseHandler;\r\nimport com.loopj.android.http.RequestParams;\r\nimport com.squareup.okhttp.Callback;\r\nimport com.squareup.okhttp.OkHttpClient;\r\nimport com.squareup.okhttp.Request;\r\nimport com.squareup.okhttp.Response;\r\n\r\nimport org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;\r\nimport org.eclipse.paho.client.mqttv3.MqttCallback;\r\nimport org.eclipse.paho.client.mqttv3.MqttClient;\r\nimport org.eclipse.paho.client.mqttv3.MqttConnectOptions;\r\nimport org.eclipse.paho.client.mqttv3.MqttException;\r\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\r\nimport org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;\r\nimport org.json.JSONArray;\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.IOException;\r\nimport java.io.InputStream;\r\nimport java.io.InputStreamReader;\r\nimport java.net.HttpURLConnection;\r\nimport java.net.MalformedURLException;\r\nimport java.net.URL;\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\nimport java.util.concurrent.ExecutionException;\r\n\r\nimport cz.msebera.android.httpclient.Header;\r\n\r\nimport static com.example.comun.Mqtt.topicRoot;\r\n\r\n/**\r\n * A simple {@link Fragment} subclass.\r\n * Use the {@link DashboardFragment#newInstance} factory method to\r\n * create an instance of this fragment.\r\n */\r\npublic class DashboardFragment extends Fragment implements MqttCallback {\r\n\r\n    private RecyclerView recyclerView;\r\n    //private StaticRvAdapter staticRvAdapter;\r\n    private AdapterClimas adapterClimas;\r\n    private TabLayout tabLayout;\r\n    private ViewPager viewPager;\r\n    //Weather\r\n\r\n    final long MIN_TIME = 200;\r\n    final float MIN_DISTANCE = 200;\r\n    final int REQUEST_CODE = 101;\r\n    final String APP_ID = \"2599fe29f309cebdb21dd7dcf235662a\";\r\n    String Location_Provider = LocationManager.GPS_PROVIDER;\r\n    final String WEATHER_URL = \"https://api.openweathermap.org/data/2.5/weather\";\r\n\r\n    TextView NameofCity, weatherState, Temperature;\r\n    ImageView mweatherIcon;\r\n    private String idUser;\r\n    LocationManager mLocationManager;\r\n    LocationListener mLocationListner;\r\n    private List<ClimaModel> climaModelList=new ArrayList<>();\r\n    private FirebaseFirestore db;\r\n    private FirebaseAuth mAuth;\r\n    //Acceso a la maquina\r\n    public static MqttClient client = null;\r\n    // TODO: Rename parameter arguments, choose names that match\r\n    // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER\r\n    private static final String ARG_PARAM1 = \"param1\";\r\n    private static final String ARG_PARAM2 = \"param2\";\r\n\r\n    // TODO: Rename and change types of parameters\r\n    private String mParam1;\r\n    private String mParam2;\r\n\r\n    public DashboardFragment() {\r\n        // Required empty public constructor\r\n    }\r\n\r\n    /**\r\n     * Use this factory method to create a new instance of\r\n     * this fragment using the provided parameters.\r\n     *\r\n     * @param param1 Parameter 1.\r\n     * @param param2 Parameter 2.\r\n     * @return A new instance of fragment DashboardFragment.\r\n     */\r\n    // TODO: Rename and change types and number of parameters\r\n    public static DashboardFragment newInstance(String param1, String param2) {\r\n        DashboardFragment fragment = new DashboardFragment();\r\n        Bundle args = new Bundle();\r\n        args.putString(ARG_PARAM1, param1);\r\n        args.putString(ARG_PARAM2, param2);\r\n        fragment.setArguments(args);\r\n        return fragment;\r\n    }\r\n\r\n    @Override\r\n    public void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        if (getArguments() != null) {\r\n            mParam1 = getArguments().getString(ARG_PARAM1);\r\n            mParam2 = getArguments().getString(ARG_PARAM2);\r\n        }\r\n    }\r\n    private String uidActualMachine;\r\n    private TextView btn_createCima;\r\n    @Override\r\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\r\n                             Bundle savedInstanceState) {\r\n        // Inflate the layout for this fragment\r\n        final View v = inflater.inflate(R.layout.fragment_dashboard, container, false);\r\n        //FIREBASE\r\n\r\n        MainActivity myActivity = (MainActivity) getActivity();\r\n        uidActualMachine=myActivity.getMachineUID();\r\n        //Recojo los datos del usuario\r\n        mAuth = FirebaseAuth.getInstance();\r\n        final FirebaseUser usuario = mAuth.getCurrentUser();\r\n        final FirebaseFirestore fStore = FirebaseFirestore.getInstance();\r\n        idUser = mAuth.getUid();\r\n        db=FirebaseFirestore.getInstance();\r\n        btn_createCima=v.findViewById(R.id.btn_anyadir_clima);\r\n        //rv\r\n        recyclerView = v.findViewById(R.id.rv_1);\r\n        initRvClimas();\r\n        getMyClimas();\r\n\r\n        btn_createCima.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                final BottomSheetDialog bottomSheetDialog=new BottomSheetDialog(getContext(),R.style.BottomSheetDialogTheme);\r\n                bottomSheetDialog.setContentView(R.layout.bottom_sheet_create_clima);\r\n\r\n                Button create_new=bottomSheetDialog.findViewById(R.id.createNewClima);\r\n                Button create_plantilla=bottomSheetDialog.findViewById(R.id.createDefaultClima);\r\n                Button backClimna=bottomSheetDialog.findViewById(R.id.btn_cancelarCreateClima);\r\n\r\n\r\n                create_new.setOnClickListener(new View.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(View v) {\r\n\r\n                    }\r\n                });\r\n\r\n                create_plantilla.setOnClickListener(new View.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(View v) {\r\n\r\n                    }\r\n                });\r\n\r\n\r\n                backClimna.setOnClickListener(new View.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(View v) {\r\n                        bottomSheetDialog.dismiss();\r\n                    }\r\n                });\r\n\r\n\r\n\r\n                bottomSheetDialog.show();\r\n            }\r\n        });\r\n\r\n\r\n        //guardo el nombre en un textView\r\n        /*final TextView nombre = (TextView) v.findViewById(R.id.hello_text);\r\n        String res=\"Hola\"+\" \"+usuario.getDisplayName();\r\n        nombre.setText(res);\r\n        DocumentReference documentReference=fStore.collection(\"Usuarios\").document(idUser);\r\n        documentReference.addSnapshotListener(new EventListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onEvent(@Nullable DocumentSnapshot snapshot, @Nullable FirebaseFirestoreException e) {\r\n                if(usuario.getDisplayName() == null){\r\n                    String res1=\"Hola\"+\" \"+snapshot.getString(\"username\");\r\n                    nombre.setText(res1);\r\n                }\r\n            }\r\n        });*/\r\n\r\n        //switch methods\r\n /*     Switch switchLuz = (Switch) v.findViewById(R.id.switchLuminosidadGeneral);\r\n        switchLuz.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {\r\n            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {\r\n                if (isChecked) {\r\n                    // The toggle is enabled\r\n                    enviarLucesOn();\r\n                } else {\r\n                    // The toggle is disabled\r\n                    enviarLucesOff();\r\n                }\r\n            }\r\n        });*/\r\n\r\n\r\n        //\r\n\r\n\r\n        //RECYCLER VIEW\r\n        /*ArrayList<StaticRvModel> item = new ArrayList<>();\r\n        item.add(new StaticRvModel(R.drawable.icons_sun, \"Soleado\"));\r\n        item.add(new StaticRvModel(R.drawable.icons_night_mode, \"Nocturno\"));\r\n        item.add(new StaticRvModel(R.drawable.icons_energy_saving, \"Ahorro\"));\r\n        item.add(new StaticRvModel(R.drawable.icons_power_off, \"Apagado\"));\r\n        item.add(new StaticRvModel(R.drawable.icons_custom, \"Custom\"));*/\r\n\r\n        final TextView medidasT = v.findViewById(R.id.medidaTemperaturaGeneral);\r\n        final TextView medidasH = v.findViewById(R.id.medidaHumedadGeneral);\r\n        /*final TextView medidasS = v.findViewById(R.id.medidaSalinidadGeneral);*/\r\n        /*final TextView medidasL = v.findViewById(R.id.medidasLuminosidadGeneral);*/\r\n\r\n\r\n\r\n\r\n        //TABS\r\n        tabLayout = v.findViewById(R.id.tab_layout);\r\n        viewPager = v.findViewById(R.id.view_pager);\r\n        //Array\r\n        ArrayList<String> arrayList = new ArrayList<>();\r\n\r\n        //set up with viewpager\r\n        tabLayout.setupWithViewPager(viewPager);\r\n\r\n        TabAdapter adapter = new TabAdapter(getActivity().getSupportFragmentManager());\r\n        //Pestañas\r\n        adapter.addFrag(new GeneralFragment(), \"General\");\r\n        adapter.addFrag(new Planta1Fragment(), \"Planta 1\");\r\n        adapter.addFrag(new Planta2Fragment(), \"Planta 2\");\r\n\r\n        viewPager.setAdapter(adapter);\r\n\r\n        /*((MainActivity)getActivity()).ola();*/\r\n     /*   //LEER DATOS FIREBASE\r\n        //Temperatura\r\n       DocumentReference documentTemperatura=fStore.collection(\"SensoresA-T\").document(\"Temperatura\");\r\n        documentTemperatura.addSnapshotListener(new EventListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onEvent(@Nullable DocumentSnapshot snapshot, @Nullable FirebaseFirestoreException e) {\r\n                String resMediTemp=snapshot.getString(\"Medición\")+\"°C\";\r\n                medidasT.setText(resMediTemp);\r\n            }\r\n        });\r\n        //Humedad\r\n        DocumentReference documentHumedad=fStore.collection(\"SensoresA-T\").document(\"Humedad\");\r\n        documentHumedad.addSnapshotListener(new EventListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onEvent(@Nullable DocumentSnapshot snapshot, @Nullable FirebaseFirestoreException e) {\r\n                String resMediHum=snapshot.getString(\"Porcentaje\")+\"%\";\r\n                medidasH.setText(resMediHum);\r\n            }\r\n        });\r\n        //Iluminación\r\n        DocumentReference documentIluminación=fStore.collection(\"SensoresA-T\").document(\"Iluminación\");\r\n        documentIluminación.addSnapshotListener(new EventListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onEvent(@Nullable DocumentSnapshot snapshot, @Nullable FirebaseFirestoreException e) {\r\n                String resMediIlum=snapshot.getString(\"Porcentaje\")+\"%\";\r\n                medidasL.setText(resMediIlum);\r\n            }\r\n        });\r\n        //Temperatura ambiente\r\n        DocumentReference documentambiente=fStore.collection(\"SensoresA-T\").document(\"Temperatura ambiente\");\r\n        documentambiente.addSnapshotListener(new EventListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onEvent(@Nullable DocumentSnapshot snapshot, @Nullable FirebaseFirestoreException e) {\r\n                String resMediIAmb=snapshot.getString(\"Medición\")+\"°C\";\r\n                medidasS.setText(resMediIAmb);\r\n            }\r\n        });\r\n\r\n      */\r\n        //Weather App\r\n        weatherState =(TextView) v.findViewById(R.id.weatherCondition);\r\n        Temperature = (TextView)v.findViewById(R.id.temperature);\r\n        mweatherIcon =(ImageView) v.findViewById(R.id.weatherIcon);\r\n        NameofCity = (TextView)v.findViewById(R.id.cityName);\r\n\r\n        return v;\r\n    }\r\n    @Override\r\n    public void onResume() {\r\n        super.onResume();\r\n        getWeatherForCurrentLocation();\r\n    }\r\n    private void getWeatherForCurrentLocation() {\r\n        mLocationManager = (LocationManager) getContext().getSystemService(Context.LOCATION_SERVICE);\r\n        mLocationListner = new LocationListener() {\r\n            @Override\r\n            public void onLocationChanged(Location location) {\r\n                String Latitude = String.valueOf(location.getLatitude());\r\n                String Longitude = String.valueOf(location.getLongitude());\r\n                RequestParams params = new RequestParams();\r\n                params.put(\"lat\",Latitude);\r\n                params.put(\"lon\",Longitude);\r\n                params.put(\"appid\",APP_ID);\r\n                letsDoSomeWorking(params);\r\n\r\n            }\r\n            @Override\r\n            public void onStatusChanged(String provider, int status, Bundle extras) {\r\n\r\n            }\r\n\r\n            @Override\r\n            public void onProviderEnabled(String provider) {\r\n\r\n            }\r\n\r\n            @Override\r\n            public void onProviderDisabled(String provider) {\r\n\r\n            }\r\n        };\r\n        if (ActivityCompat.checkSelfPermission(getContext(), Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(getContext(), Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n            // TODO: Consider calling\r\n            //    ActivityCompat#requestPermissions\r\n            // here to request the missing permissions, and then overriding\r\n            //   public void onRequestPermissionsResult(int requestCode, String[] permissions,\r\n            //                                          int[] grantResults)\r\n            // to handle the case where the user grants the permission. See the documentation\r\n            // for ActivityCompat#requestPermissions for more details.\r\n            ActivityCompat.requestPermissions(getActivity(),new String[]{Manifest.permission.ACCESS_FINE_LOCATION},REQUEST_CODE);\r\n            return;\r\n        }\r\n        mLocationManager.requestLocationUpdates(Location_Provider, MIN_TIME, MIN_DISTANCE, mLocationListner);\r\n    }\r\n    @Override\r\n    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\r\n        super.onRequestPermissionsResult(requestCode, permissions, grantResults);\r\n        if (requestCode == REQUEST_CODE) {\r\n            if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {\r\n                Toast.makeText(getContext(), \"Localizacion obtenida\", Toast.LENGTH_SHORT).show();\r\n                getWeatherForCurrentLocation();\r\n            } else {\r\n                Toast.makeText(getContext(), \"Localizaacion no obtenida\", Toast.LENGTH_SHORT).show();\r\n            }\r\n\r\n        }\r\n    }\r\n    private void letsDoSomeWorking(RequestParams params){\r\n        AsyncHttpClient client =new AsyncHttpClient();\r\n        client.get(WEATHER_URL,params,new JsonHttpResponseHandler(){\r\n            @Override\r\n            public void onSuccess(int statusCode, Header[] headers, JSONObject response) {\r\n                /*Toast.makeText(getContext(), \"Data obteninda\", Toast.LENGTH_SHORT).show();*/\r\n                weatherData weatherD= weatherData.fromJson(response);\r\n                updateUI(weatherD);\r\n                //super.onSuccess(statusCode, headers, response);\r\n            }\r\n            @Override\r\n            public void onFailure(int statusCode, Header[] headers, Throwable throwable, JSONObject errorResponse) {\r\n                //super.onFailure(statusCode, headers, throwable, errorResponse);\r\n                Toast.makeText(getContext(), \"Data no obteninda\", Toast.LENGTH_SHORT).show();\r\n            }\r\n        });\r\n    }\r\n    private void updateUI(weatherData weather){\r\n        Temperature.setText(weather.getmTemperature());\r\n        NameofCity.setText(weather.getMcity());\r\n        weatherState.setText(weather.getmWeatherType());\r\n        int resourceID =getResources().getIdentifier(weather.getMicon(),\"drawable\",getActivity().getPackageName());\r\n        mweatherIcon.setImageResource(resourceID);\r\n\r\n\r\n    }\r\n    @Override\r\n    public void onPause() {\r\n        super.onPause();\r\n        if(mLocationManager!=null){\r\n            mLocationManager.removeUpdates(mLocationListner);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    public void enviarLucesOff(){\r\n        try {\r\n            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new\r\n                    MemoryPersistence());\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n        MqttConnectOptions connOpts = new MqttConnectOptions();\r\n        connOpts.setCleanSession(true);\r\n        connOpts.setKeepAliveInterval(60);\r\n        connOpts.setWill(topicRoot+\"WillTopic\", \"App desconectada\".getBytes(),Mqtt.qos, false);\r\n\r\n        try {\r\n            client.connect(connOpts);\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        //conexión con el broker Root1 = Lector de datos\r\n        //nos subscribimos a topic lectura\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Subscrito a \" + topicRoot + \"luces\");//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este\r\n            client.subscribe(topicRoot + \"luces\", Mqtt.qos);\r\n            client.setCallback((MqttCallback) this);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al suscribir.\", e);\r\n        }\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Publicando mensaje: \" + \"mensaje\");\r\n            MqttMessage message = new MqttMessage(\"luces OFF\".getBytes());\r\n            message.setQos(Mqtt.qos);\r\n            message.setRetained(false);\r\n            client.publish(topicRoot+\"luces\", message);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al publicar.\", e);\r\n        }\r\n    }\r\n    public void enviarLucesOn(){\r\n        try {\r\n            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new\r\n                    MemoryPersistence());\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n        MqttConnectOptions connOpts = new MqttConnectOptions();\r\n        connOpts.setCleanSession(true);\r\n        connOpts.setKeepAliveInterval(60);\r\n        connOpts.setWill(topicRoot+\"WillTopic\", \"App desconectada\".getBytes(),Mqtt.qos, false);\r\n\r\n        try {\r\n            client.connect(connOpts);\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        //conexión con el broker Root1 = Lector de datos\r\n        //nos subscribimos a topic lectura\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Subscrito a \" + topicRoot + \"luces\");//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este\r\n            client.subscribe(topicRoot + \"luces\", Mqtt.qos);\r\n            client.setCallback((MqttCallback) this);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al suscribir.\", e);\r\n        }\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Publicando mensaje: \" + \"mensaje\");\r\n            MqttMessage message = new MqttMessage(\"luces ON\".getBytes());\r\n            message.setQos(Mqtt.qos);\r\n            message.setRetained(false);\r\n            client.publish(topicRoot+\"luces\", message);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al publicar.\", e);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void connectionLost(Throwable cause) {\r\n        Log.d(Mqtt.TAG, \"Conexión perdida\");\r\n    }\r\n\r\n    @Override\r\n    public void messageArrived(String topic, MqttMessage message) throws Exception {\r\n\r\n    }\r\n\r\n    @Override\r\n    public void deliveryComplete(IMqttDeliveryToken token) {\r\n        Log.d(Mqtt.TAG, \"Entrega completa\");\r\n    }\r\n\r\n\r\n\r\n\r\n    private void setText(final TextView text, final String value) {\r\n        getActivity().runOnUiThread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                text.setText(value);\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n\r\n    //App location\r\n   /* private void getLocation() {\r\n\r\n        //Check Permissions again\r\n\r\n        /*if (ActivityCompat.checkSelfPermission(\r\n                getContext(),Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(\r\n                getContext(), Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n            ActivityCompat.requestPermissions(getActivity(), new String[]{Manifest.permission.ACCESS_FINE_LOCATION}, REQUEST_LOCATION);\r\n        } else {\r\n\r\n            Location LocationNetwork=locationManager.getLastKnownLocation(LocationManager.NETWORK_PROVIDER);\r\n             if (LocationNetwork !=null)\r\n            {\r\n                double lat=LocationNetwork.getLatitude();\r\n                double longi=LocationNetwork.getLongitude();\r\n\r\n                latitude=String.valueOf(lat);\r\n                longitude=String.valueOf(longi);\r\n               /* loc_func(LocationNetwork);*/\r\n              /*  api_key(String.valueOf(view_city.getText()));\r\n                showLocationTxt.setText(\"Your Location:\"+\"\\n\"+\"Latitude= \"+latitude+\"\\n\"+\"Longitude= \"+longitude);\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    private void OnGPS() {\r\n\r\n        final AlertDialog.Builder builder= new AlertDialog.Builder(getContext());\r\n\r\n        builder.setMessage(\"Enable GPS\").setCancelable(false).setPositiveButton(\"YES\", new DialogInterface.OnClickListener() {\r\n            @Override\r\n            public void onClick(DialogInterface dialog, int which) {\r\n                startActivity(new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS));\r\n                getLocation();\r\n            }\r\n        }).setNegativeButton(\"NO\", new DialogInterface.OnClickListener() {\r\n            @Override\r\n            public void onClick(DialogInterface dialog, int which) {\r\n\r\n                dialog.cancel();\r\n            }\r\n        });\r\n        final AlertDialog alertDialog=builder.create();\r\n        alertDialog.show();\r\n    }\r\n\r\n    private void loc_func(Location location){\r\n        try {\r\n            Geocoder geocoder=new Geocoder(getContext());\r\n            List<Address> addresses = geocoder.getFromLocation(lat, longi, 1);\r\n            /*String address = addresses.get(0).getSubLocality();*/\r\n           /* String cityName = addresses.get(0).getLocality();\r\n            String stateName = addresses.get(0).getAdminArea();\r\n            String country = addresses.get(0).getCountryName();\r\n            //txt_paddress.setText(address);\r\n            view_city.setText(cityName);\r\n            view_country.setText(country);\r\n            //txt_state.setText(stateName);*/\r\n\r\n       /* } catch (IOException e) {\r\n            e.printStackTrace();\r\n            Toast.makeText(getContext(), \"Error:\"+e, Toast.LENGTH_SHORT).show();\r\n        }\r\n    }\r\n\r\n    private void inicioGPS(){\r\n\r\n\r\n        //Check gps is enable or not\r\n\r\n        if (!locationManager.isProviderEnabled(LocationManager.GPS_PROVIDER))\r\n        {\r\n            //Write Function To enable gps\r\n\r\n            OnGPS();\r\n        }\r\n        else\r\n        {\r\n            //GPS is already On then\r\n\r\n            /*getLocation();*/\r\n /*       }\r\n    }*/\r\n\r\n    private void initRvClimas(){\r\n        recyclerView.setLayoutManager(new LinearLayoutManager(requireContext(), LinearLayoutManager.HORIZONTAL, false));\r\n        //recyclerView.setAdapter(staticRvAdapter);\r\n    }\r\n    private void getMyClimas(){\r\n\r\n        db.collection(\"Climas\").document(\"Default\").get()\r\n                .addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                        if (task.isSuccessful()) {\r\n                            DocumentSnapshot document = task.getResult();\r\n                            if (document.exists()) {\r\n                                String name=document.getString(\"name\");\r\n                                String creator=document.getString(\"creator\");\r\n                                String temperatura=document.getString(\"temperatura\");\r\n                                String humedad=document.getString(\"humedad\");\r\n                                String machine=document.getString(\"machineId\");\r\n                                boolean defecto=document.getBoolean(\"defecto\");\r\n                                String uid=document.getId();\r\n                                final ClimaModel DefaultClima=new ClimaModel(temperatura,humedad,name,creator,uid,uidActualMachine,defecto);\r\n\r\n                                db.collection(\"Climas\")\r\n                                        .whereEqualTo(\"creator\",idUser)\r\n                                        .addSnapshotListener(new EventListener<QuerySnapshot>() {\r\n                                            @Override\r\n                                            public void onEvent(@Nullable QuerySnapshot value,\r\n                                                                @Nullable FirebaseFirestoreException e) {\r\n                                                if (e != null) {\r\n                                                    return;\r\n                                                }\r\n                                                if(value!=null){\r\n                                                    climaModelList.clear();\r\n                                                    climaModelList.add(DefaultClima);\r\n                                                    for (QueryDocumentSnapshot doc : value) {\r\n                                                        String name=doc.getString(\"name\");\r\n                                                        String creator=doc.getString(\"creator\");\r\n                                                        String temperatura=doc.getString(\"temperatura\");\r\n                                                        String humedad=doc.getString(\"humedad\");\r\n                                                        String machine=doc.getString(\"machineId\");\r\n                                                        boolean defecto=doc.getBoolean(\"defecto\");\r\n                                                        String uid=doc.getId();\r\n\r\n                                                        ClimaModel climaModel=new ClimaModel(temperatura,humedad,name,creator,uid,uidActualMachine,defecto);\r\n                                                        climaModelList.add(climaModel);\r\n                                                    }\r\n                                                    adapterClimas= new AdapterClimas(climaModelList,getContext(),uidActualMachine);\r\n                                                    onclickClima();\r\n                                                    recyclerView.setAdapter(adapterClimas);\r\n                                                }\r\n                                            }\r\n                                        });\r\n\r\n                            }\r\n                        } else {\r\n\r\n                        }\r\n                    }\r\n                });\r\n    }\r\n\r\n    private void onclickClima(){\r\n        adapterClimas.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                int position=recyclerView.getChildLayoutPosition(v);\r\n                ClimaModel climaModel=climaModelList.get(position);\r\n                bottomSheetClima(climaModel,position);\r\n            }\r\n        });\r\n    }\r\n\r\n    private String climaActivated;\r\n\r\n    private void bottomSheetClima(final ClimaModel climaModel, final int position){\r\n        final String uiDocument=climaModel.getUid();\r\n        final BottomSheetDialog bottomSheetDialog=new BottomSheetDialog(getContext(),R.style.BottomSheetDialogTheme);\r\n        bottomSheetDialog.setContentView(R.layout.bottom_sheet_climas);\r\n        final AlertDialog.Builder builder = new AlertDialog.Builder(getContext());\r\n\r\n        TextView name=bottomSheetDialog.findViewById(R.id.name_clima);\r\n        TextView temp=bottomSheetDialog.findViewById(R.id.umbral_temperatura_clima);\r\n        TextView hum=bottomSheetDialog.findViewById(R.id.umbral_humedad_clima);\r\n        final Button activar=bottomSheetDialog.findViewById(R.id.btn_activatClima);\r\n        Button editar=bottomSheetDialog.findViewById(R.id.btn_editar_clima);\r\n        Button eliminar=bottomSheetDialog.findViewById(R.id.btn_eliminar_clima);\r\n        Button cancelar=bottomSheetDialog.findViewById(R.id.btn_cancelar_clima);\r\n\r\n        name.setText(climaModel.getName());\r\n        temp.setText(climaModel.getTemperatura());\r\n        hum.setText(climaModel.getHumedad());\r\n        //onClick\r\n\r\n\r\n        final String[] idRealMachine = {\"\"};\r\n        db.collection(\"Machine\")\r\n                .whereEqualTo(\"description\",uidActualMachine)\r\n                .limit(1)\r\n                .get()\r\n                .addOnCompleteListener(new OnCompleteListener<QuerySnapshot>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<QuerySnapshot> task) {\r\n                        if (task.isSuccessful()) {\r\n                            for (QueryDocumentSnapshot document : task.getResult()) {\r\n                                idRealMachine[0] =document.getId();\r\n                            }\r\n                            db.collection(\"Machine\").document(idRealMachine[0]).collection(\"Clima\")\r\n                                    .document(\"Activado\").get()\r\n                                    .addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n                                        @Override\r\n                                        public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                                            if (task.isSuccessful()) {\r\n                                                DocumentSnapshot document = task.getResult();\r\n                                                if (document.exists()) {\r\n                                                    climaActivated= document.getString(\"climaID\");\r\n                                                    if(climaModel.getUid().equals(climaActivated)){\r\n                                                        activar.setText(\"Desactivar clima\");\r\n                                                        activar.setBackgroundResource(R.drawable.button_unfollow);\r\n                                                        activar.setTextColor(getResources().getColor(R.color.black));\r\n                                                    }else{\r\n                                                        activar.setText(\"Activar clima\");\r\n                                                        activar.setBackgroundResource(R.drawable.button_enter_machine);\r\n                                                        activar.setTextColor(getResources().getColor(R.color.white));\r\n                                                    }\r\n                                                } else {\r\n\r\n                                                }\r\n                                            } else {\r\n\r\n                                            }\r\n                                        }\r\n                                    });\r\n\r\n                        } else {\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n        activar.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                if(activar.getText().equals(\"Desactivar clima\")){\r\n                    if(climaModel.isDefecto()){\r\n                        Toast.makeText(getContext(),\"Tienes que tener activado al menos un clima\", Toast.LENGTH_LONG).show();\r\n                    }else{\r\n                        db.collection(\"Machine\").document(idRealMachine[0]).collection(\"Clima\").document(\"Activado\").update(\"climaID\",\"Default\");\r\n                    }\r\n                }else if(activar.getText().equals(\"Activar clima\")){\r\n                    db.collection(\"Machine\").document(idRealMachine[0]).collection(\"Clima\").document(\"Activado\").update(\"climaID\",climaModel.getUid());\r\n                }\r\n                getMyClimas();\r\n                bottomSheetDialog.dismiss();\r\n\r\n            }\r\n        });\r\n\r\n        if(climaModel.isDefecto()){\r\n            editar.setVisibility(View.GONE);\r\n            eliminar.setVisibility(View.GONE);\r\n            cancelar.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View v) {\r\n                    bottomSheetDialog.dismiss();\r\n                }\r\n            });\r\n        }else{\r\n            editar.setVisibility(View.VISIBLE);\r\n            eliminar.setVisibility(View.VISIBLE);\r\n            editar.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View v) {\r\n                    //Intent tiwh extra to edit clima\r\n                }\r\n            });\r\n            eliminar.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View v) {\r\n                    builder.setMessage(\"¿Seguro que quieres eliminar este clima?\");\r\n                    builder.setTitle(\"Eliminar clima\");\r\n                    builder.setPositiveButton(\"Eliminar\", new DialogInterface.OnClickListener() {\r\n                        @Override\r\n                        public void onClick(DialogInterface dialog, int which) {\r\n                            if(climaModel.getUid().equals(climaActivated)){\r\n                                db.collection(\"Machine\").document(idRealMachine[0]).collection(\"Clima\").document(\"Activado\").update(\"climaID\",\"Default\");\r\n                                db.collection(\"Climas\").document(climaModel.getUid()).delete();\r\n                            }else{\r\n                                db.collection(\"Climas\").document(climaModel.getUid()).delete();\r\n                            }\r\n\r\n                            bottomSheetDialog.dismiss();\r\n                            dialog.cancel();\r\n                        }\r\n                    }).setNegativeButton(\"Cancelar\", new DialogInterface.OnClickListener() {\r\n                        @Override\r\n                        public void onClick(DialogInterface dialog, int which) {\r\n                            dialog.cancel();\r\n                        }\r\n                    });\r\n                    AlertDialog dialog = builder.create();\r\n                    dialog.show();\r\n                }\r\n            });\r\n            cancelar.setOnClickListener(new View.OnClickListener() {\r\n                @Override\r\n                public void onClick(View v) {\r\n                    bottomSheetDialog.dismiss();\r\n                }\r\n            });\r\n        }\r\n        bottomSheetDialog.show();\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/infinitycrop/ui/dashboard/DashboardFragment.java	(revision 6a46eaa504348e2e3bd04e08f565c03719a31f9d)
+++ app/src/main/java/com/example/infinitycrop/ui/dashboard/DashboardFragment.java	(date 1611253775125)
@@ -34,7 +34,9 @@
 import com.example.comun.Mqtt;
 import com.example.infinitycrop.MainActivity;
 import com.example.infinitycrop.R;
+import com.example.infinitycrop.ui.Foro.lets_start.EditCommunity;
 import com.example.infinitycrop.ui.Foro.lets_start.rv_community.CommunityModel;
+import com.example.infinitycrop.ui.Foro.main.Community.NewPost.CreatePost.CreatePost;
 import com.example.infinitycrop.ui.Foro.main.Home.RVs.RVFollowed.AdapterFollowedCmty;
 import com.example.infinitycrop.ui.MachineControl.planta1;
 import com.example.infinitycrop.ui.dashboard.RvClimas.AdapterClimas;
@@ -194,14 +196,20 @@
                 create_new.setOnClickListener(new View.OnClickListener() {
                     @Override
                     public void onClick(View v) {
-
+                        Intent intent = new Intent(getContext(), CreateClima.class);
+                        intent.putExtra("modo", "new");
+                        startActivity(intent);
+                        bottomSheetDialog.dismiss();
                     }
                 });
 
                 create_plantilla.setOnClickListener(new View.OnClickListener() {
                     @Override
                     public void onClick(View v) {
-
+                        Intent intent = new Intent(getContext(), CreateClima.class);
+                        intent.putExtra("modo", "default");
+                        startActivity(intent);
+                        bottomSheetDialog.dismiss();
                     }
                 });
 
@@ -794,6 +802,10 @@
                 @Override
                 public void onClick(View v) {
                     //Intent tiwh extra to edit clima
+                    Intent intent = new Intent(getContext(), EditarClima.class);
+                    intent.putExtra("id", climaModel.getUid());
+                    startActivity(intent);
+                    bottomSheetDialog.dismiss();
                 }
             });
             eliminar.setOnClickListener(new View.OnClickListener() {
Index: app/src/main/res/layout/activity_create_clima.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".ui.dashboard.CreateClima\">\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/activity_create_clima.xml	(revision 6a46eaa504348e2e3bd04e08f565c03719a31f9d)
+++ app/src/main/res/layout/activity_create_clima.xml	(date 1611253154797)
@@ -1,9 +1,112 @@
 <?xml version="1.0" encoding="utf-8"?>
-<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
+<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:app="http://schemas.android.com/apk/res-auto"
     xmlns:tools="http://schemas.android.com/tools"
     android:layout_width="match_parent"
+    android:background="#EFE9E9"
     android:layout_height="match_parent"
     tools:context=".ui.dashboard.CreateClima">
 
-</androidx.constraintlayout.widget.ConstraintLayout>
\ No newline at end of file
+    <androidx.constraintlayout.widget.ConstraintLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content">
+
+
+        <TextView
+            android:id="@+id/textView37"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="20dp"
+            android:layout_marginBottom="500dp"
+            android:text="Crear Clima"
+            android:textColor="@color/black"
+            android:textSize="22sp"
+            android:textStyle="bold"
+            app:layout_constraintBottom_toBottomOf="parent"
+            app:layout_constraintEnd_toEndOf="parent"
+            app:layout_constraintStart_toStartOf="parent"
+            app:layout_constraintTop_toTopOf="parent" />
+
+        <com.google.android.material.textfield.TextInputLayout
+            android:id="@+id/textInputLayout2"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginStart="20dp"
+            android:layout_marginTop="50dp"
+            android:layout_marginEnd="20dp"
+            app:layout_constraintEnd_toEndOf="parent"
+            app:layout_constraintStart_toStartOf="parent"
+            app:layout_constraintTop_toBottomOf="@+id/textView37">
+
+            <com.google.android.material.textfield.TextInputEditText
+                android:id="@+id/name_climaCreateClima"
+                android:layout_width="match_parent"
+                android:layout_height="wrap_content"
+                android:hint="Nombre del clima" />
+        </com.google.android.material.textfield.TextInputLayout>
+
+        <TextView
+            android:id="@+id/textView38"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_marginStart="20dp"
+            android:layout_marginTop="29dp"
+            android:text="Definir umbrales >"
+            app:layout_constraintEnd_toEndOf="parent"
+            app:layout_constraintStart_toStartOf="parent"
+            app:layout_constraintTop_toBottomOf="@+id/textInputLayout2" />
+
+        <EditText
+            android:id="@+id/temperaturaCreateClima"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_marginStart="20dp"
+            android:layout_marginTop="8dp"
+            android:layout_marginEnd="8dp"
+            android:ems="10"
+            android:hint="Temperatura"
+            android:inputType="numberDecimal"
+            app:layout_constraintEnd_toStartOf="@+id/humedadCreateClima"
+            app:layout_constraintStart_toStartOf="parent"
+            app:layout_constraintTop_toBottomOf="@+id/textView38" />
+
+        <EditText
+            android:id="@+id/humedadCreateClima"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_marginEnd="20dp"
+            android:ems="10"
+            android:hint="Humedad"
+            android:inputType="numberDecimal"
+            app:layout_constraintEnd_toEndOf="parent"
+            app:layout_constraintStart_toEndOf="@+id/temperaturaCreateClima"
+            app:layout_constraintTop_toTopOf="@+id/temperaturaCreateClima" />
+
+        <Button
+            android:id="@+id/btn_cancelar_crearClima"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:layout_marginStart="20dp"
+            android:layout_marginTop="20dp"
+            android:background="@drawable/button_action_machine"
+            android:padding="10dp"
+            android:text="@string/posts_text11"
+            android:textColor="@color/colorPrimaryDashboard"
+            app:layout_constraintStart_toStartOf="parent"
+            app:layout_constraintTop_toBottomOf="@+id/temperaturaCreateClima" />
+
+        <Button
+            android:id="@+id/btn_createClima_act"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="20dp"
+            android:layout_marginEnd="20dp"
+            android:background="@drawable/button_enter_machine"
+            android:padding="10dp"
+            android:text="Crear clima"
+            android:textColor="@color/white"
+            app:layout_constraintEnd_toEndOf="parent"
+            app:layout_constraintTop_toBottomOf="@+id/humedadCreateClima" />
+    </androidx.constraintlayout.widget.ConstraintLayout>
+
+</ScrollView>
\ No newline at end of file
Index: app/src/main/java/com/example/infinitycrop/ui/dashboard/EditarClima.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/infinitycrop/ui/dashboard/EditarClima.java	(date 1611253680763)
+++ app/src/main/java/com/example/infinitycrop/ui/dashboard/EditarClima.java	(date 1611253680763)
@@ -0,0 +1,107 @@
+package com.example.infinitycrop.ui.dashboard;
+
+import androidx.annotation.NonNull;
+import androidx.appcompat.app.AppCompatActivity;
+
+import android.os.Bundle;
+import android.view.View;
+import android.widget.Button;
+import android.widget.EditText;
+import android.widget.Toast;
+
+import com.example.infinitycrop.R;
+import com.google.android.gms.tasks.OnCompleteListener;
+import com.google.android.gms.tasks.Task;
+import com.google.android.material.textfield.TextInputEditText;
+import com.google.firebase.auth.FirebaseAuth;
+import com.google.firebase.firestore.DocumentSnapshot;
+import com.google.firebase.firestore.FirebaseFirestore;
+
+import java.util.HashMap;
+import java.util.Map;
+
+public class EditarClima extends AppCompatActivity {
+
+
+    private String modo;
+    private TextInputEditText name_climaCreateClima;
+    private EditText temperaturaCreateClima;
+    private EditText humedadCreateClima;
+    private Button btn_createClima_act;
+    private Button btn_cancelar_crearClima;
+    private FirebaseFirestore db;
+    private FirebaseAuth firebaseAuth;
+    private String id;
+    private String uid;
+
+    @Override
+    protected void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+        setContentView(R.layout.activity_editar_clima);
+
+        Bundle extras = getIntent().getExtras();
+        id = extras.getString("id");
+
+        db=FirebaseFirestore.getInstance();
+
+        name_climaCreateClima=findViewById(R.id.name_climaEditClima);
+        temperaturaCreateClima=findViewById(R.id.temperaturaEditClima);
+        humedadCreateClima=findViewById(R.id.humedadEditClima);
+        btn_createClima_act=findViewById(R.id.btn_EditClima_act);
+        btn_cancelar_crearClima=findViewById(R.id.btn_cancelar_EditClima);
+        firebaseAuth= FirebaseAuth.getInstance();
+        uid=firebaseAuth.getUid();
+
+
+        db.collection("Climas").document(id).get()
+                .addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {
+                    @Override
+                    public void onComplete(@NonNull Task<DocumentSnapshot> task) {
+                        if (task.isSuccessful()) {
+                            DocumentSnapshot document = task.getResult();
+                            if (document.exists()) {
+                                name_climaCreateClima.setText(document.getString("name"));
+                                temperaturaCreateClima.setText(document.getString("temperatura"));
+                                humedadCreateClima.setText(document.getString("humedad"));
+                            } else {
+
+                            }
+                        } else {
+
+                        }
+                    }
+                });
+
+        btn_cancelar_crearClima.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View v) {
+                finish();
+            }
+        });
+
+        btn_createClima_act.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View v) {
+                if(name_climaCreateClima.getText().equals("") || temperaturaCreateClima.getText().toString().equals("") || humedadCreateClima.getText().toString().equals("")){
+                    Toast.makeText(getApplicationContext(),"Introduce todos los datos necesarios", Toast.LENGTH_LONG).show();
+                }else{
+
+
+                    final Map<String, Object> a = new HashMap<>();
+                    a.put("name", name_climaCreateClima.getText().toString());
+                    a.put("humedad", humedadCreateClima.getText().toString());
+                    a.put("temperatura", temperaturaCreateClima.getText().toString() );
+                    a.put("creator", uid );
+                    a.put("machineId", "" );
+                    a.put("defecto", false );
+
+                    db.collection("Climas").document(id).update(a);
+
+                    Toast.makeText(getApplicationContext(),"Clima editado con éxito", Toast.LENGTH_LONG).show();
+                    finish();
+                }
+
+            }
+        });
+    }
+}
\ No newline at end of file
Index: app/src/main/java/com/example/infinitycrop/ui/dashboard/CreateClima.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.infinitycrop.ui.dashboard;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport android.os.Bundle;\r\n\r\nimport com.example.infinitycrop.R;\r\n\r\npublic class CreateClima extends AppCompatActivity {\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_create_clima);\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/infinitycrop/ui/dashboard/CreateClima.java	(revision 6a46eaa504348e2e3bd04e08f565c03719a31f9d)
+++ app/src/main/java/com/example/infinitycrop/ui/dashboard/CreateClima.java	(date 1611252696183)
@@ -1,16 +1,110 @@
 package com.example.infinitycrop.ui.dashboard;
 
+import androidx.annotation.NonNull;
 import androidx.appcompat.app.AppCompatActivity;
 
 import android.os.Bundle;
+import android.view.View;
+import android.widget.Button;
+import android.widget.EditText;
+import android.widget.Toast;
 
 import com.example.infinitycrop.R;
+import com.google.android.gms.tasks.OnCompleteListener;
+import com.google.android.gms.tasks.Task;
+import com.google.android.material.textfield.TextInputEditText;
+import com.google.firebase.auth.FirebaseAuth;
+import com.google.firebase.firestore.DocumentSnapshot;
+import com.google.firebase.firestore.FirebaseFirestore;
+
+import java.util.HashMap;
+import java.util.Map;
 
 public class CreateClima extends AppCompatActivity {
 
+
+    private String modo;
+    private TextInputEditText name_climaCreateClima;
+    private EditText temperaturaCreateClima;
+    private EditText humedadCreateClima;
+    private Button btn_createClima_act;
+    private Button btn_cancelar_crearClima;
+    private FirebaseFirestore db;
+    private FirebaseAuth firebaseAuth;
+    private String uid;
+
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_create_clima);
+
+        Bundle extras = getIntent().getExtras();
+        modo = extras.getString("modo");
+
+        db=FirebaseFirestore.getInstance();
+
+        name_climaCreateClima=findViewById(R.id.name_climaCreateClima);
+        temperaturaCreateClima=findViewById(R.id.temperaturaCreateClima);
+        humedadCreateClima=findViewById(R.id.humedadCreateClima);
+        btn_createClima_act=findViewById(R.id.btn_createClima_act);
+        btn_cancelar_crearClima=findViewById(R.id.btn_cancelar_crearClima);
+        firebaseAuth= FirebaseAuth.getInstance();
+        uid=firebaseAuth.getUid();
+
+        btn_cancelar_crearClima.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View v) {
+                finish();
+            }
+        });
+
+
+        if(modo.equals("default")){
+            db.collection("Climas").document("Default").get()
+                    .addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {
+                        @Override
+                        public void onComplete(@NonNull Task<DocumentSnapshot> task) {
+                            if (task.isSuccessful()) {
+                                DocumentSnapshot document = task.getResult();
+                                if (document.exists()) {
+                                   name_climaCreateClima.setText(document.getString("name"));
+                                    temperaturaCreateClima.setText(document.getString("temperatura"));
+                                    humedadCreateClima.setText(document.getString("humedad"));
+                                } else {
+
+                                }
+                            } else {
+
+                            }
+                        }
+                    });
+        }
+
+
+        btn_createClima_act.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View v) {
+                if(name_climaCreateClima.getText().equals("") || temperaturaCreateClima.getText().toString().equals("") || humedadCreateClima.getText().toString().equals("")){
+                    Toast.makeText(getApplicationContext(),"Introduce todos los datos necesarios", Toast.LENGTH_LONG).show();
+                }else{
+
+
+                    final Map<String, Object> a = new HashMap<>();
+                    a.put("name", name_climaCreateClima.getText().toString());
+                    a.put("humedad", humedadCreateClima.getText().toString());
+                    a.put("temperatura", temperaturaCreateClima.getText().toString() );
+                    a.put("creator", uid );
+                    a.put("machineId", "" );
+                    a.put("defecto", false );
+
+                    db.collection("Climas").add(a);
+
+                    Toast.makeText(getApplicationContext(),"Clima creado con éxito", Toast.LENGTH_LONG).show();
+                    finish();
+                }
+
+            }
+        });
+
     }
 }
\ No newline at end of file
Index: app/src/main/res/layout/activity_editar_clima.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/activity_editar_clima.xml	(date 1611253284125)
+++ app/src/main/res/layout/activity_editar_clima.xml	(date 1611253284125)
@@ -0,0 +1,112 @@
+<?xml version="1.0" encoding="utf-8"?>
+<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    xmlns:tools="http://schemas.android.com/tools"
+    android:layout_width="match_parent"
+    android:background="#EFE9E9"
+    android:layout_height="match_parent"
+    tools:context=".ui.dashboard.EditarClima">
+
+    <androidx.constraintlayout.widget.ConstraintLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content">
+
+
+        <TextView
+            android:id="@+id/textView37"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="20dp"
+            android:layout_marginBottom="500dp"
+            android:text="Editar Clima"
+            android:textColor="@color/black"
+            android:textSize="22sp"
+            android:textStyle="bold"
+            app:layout_constraintBottom_toBottomOf="parent"
+            app:layout_constraintEnd_toEndOf="parent"
+            app:layout_constraintStart_toStartOf="parent"
+            app:layout_constraintTop_toTopOf="parent" />
+
+        <com.google.android.material.textfield.TextInputLayout
+            android:id="@+id/textInputLayout2"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginStart="20dp"
+            android:layout_marginTop="50dp"
+            android:layout_marginEnd="20dp"
+            app:layout_constraintEnd_toEndOf="parent"
+            app:layout_constraintStart_toStartOf="parent"
+            app:layout_constraintTop_toBottomOf="@+id/textView37">
+
+            <com.google.android.material.textfield.TextInputEditText
+                android:id="@+id/name_climaEditClima"
+                android:layout_width="match_parent"
+                android:layout_height="wrap_content"
+                android:hint="Nombre del clima" />
+        </com.google.android.material.textfield.TextInputLayout>
+
+        <TextView
+            android:id="@+id/textView38"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_marginStart="20dp"
+            android:layout_marginTop="29dp"
+            android:text="Definir umbrales >"
+            app:layout_constraintEnd_toEndOf="parent"
+            app:layout_constraintStart_toStartOf="parent"
+            app:layout_constraintTop_toBottomOf="@+id/textInputLayout2" />
+
+        <EditText
+            android:id="@+id/temperaturaEditClima"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_marginStart="20dp"
+            android:layout_marginTop="8dp"
+            android:layout_marginEnd="8dp"
+            android:ems="10"
+            android:hint="Temperatura"
+            android:inputType="numberDecimal"
+            app:layout_constraintEnd_toStartOf="@+id/humedadEditClima"
+            app:layout_constraintStart_toStartOf="parent"
+            app:layout_constraintTop_toBottomOf="@+id/textView38" />
+
+        <EditText
+            android:id="@+id/humedadEditClima"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_marginEnd="20dp"
+            android:ems="10"
+            android:hint="Humedad"
+            android:inputType="numberDecimal"
+            app:layout_constraintEnd_toEndOf="parent"
+            app:layout_constraintStart_toEndOf="@+id/temperaturaEditClima"
+            app:layout_constraintTop_toTopOf="@+id/temperaturaEditClima" />
+
+        <Button
+            android:id="@+id/btn_cancelar_EditClima"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:layout_marginStart="20dp"
+            android:layout_marginTop="20dp"
+            android:background="@drawable/button_action_machine"
+            android:padding="10dp"
+            android:text="@string/posts_text11"
+            android:textColor="@color/colorPrimaryDashboard"
+            app:layout_constraintStart_toStartOf="parent"
+            app:layout_constraintTop_toBottomOf="@+id/temperaturaEditClima" />
+
+        <Button
+            android:id="@+id/btn_EditClima_act"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="20dp"
+            android:layout_marginEnd="20dp"
+            android:background="@drawable/button_enter_machine"
+            android:padding="10dp"
+            android:text="Guardar cambios"
+            android:textColor="@color/white"
+            app:layout_constraintEnd_toEndOf="parent"
+            app:layout_constraintTop_toBottomOf="@+id/humedadEditClima" />
+    </androidx.constraintlayout.widget.ConstraintLayout>
+
+</ScrollView>
\ No newline at end of file
