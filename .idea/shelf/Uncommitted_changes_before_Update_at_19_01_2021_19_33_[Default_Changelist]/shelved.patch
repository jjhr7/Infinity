Index: app/src/main/java/com/example/infinitycrop/ui/dashboard/DashboardFragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.infinitycrop.ui.dashboard;\r\n\r\nimport android.Manifest;\r\nimport android.content.Context;\r\nimport android.location.LocationManager;\r\nimport android.os.Bundle;\r\n\r\nimport androidx.core.app.ActivityCompat;\r\nimport androidx.fragment.app.Fragment;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\nimport androidx.viewpager.widget.ViewPager;\r\n\r\nimport android.os.StrictMode;\r\nimport android.util.Log;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\n\r\nimport com.example.comun.Mqtt;\r\nimport com.example.infinitycrop.R;\r\nimport com.example.infinitycrop.ui.recycler_control.StaticRvAdapter;\r\nimport com.example.infinitycrop.ui.recycler_control.StaticRvModel;\r\nimport com.google.android.material.tabs.TabLayout;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.FirebaseUser;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\nimport com.squareup.okhttp.Callback;\r\nimport com.squareup.okhttp.OkHttpClient;\r\nimport com.squareup.okhttp.Request;\r\nimport com.squareup.okhttp.Response;\r\n\r\nimport org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;\r\nimport org.eclipse.paho.client.mqttv3.MqttCallback;\r\nimport org.eclipse.paho.client.mqttv3.MqttClient;\r\nimport org.eclipse.paho.client.mqttv3.MqttConnectOptions;\r\nimport org.eclipse.paho.client.mqttv3.MqttException;\r\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\r\nimport org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;\r\nimport org.json.JSONArray;\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.IOException;\r\nimport java.util.ArrayList;\r\n\r\nimport static com.example.comun.Mqtt.topicRoot;\r\n\r\n/**\r\n * A simple {@link Fragment} subclass.\r\n * Use the {@link DashboardFragment#newInstance} factory method to\r\n * create an instance of this fragment.\r\n */\r\npublic class DashboardFragment extends Fragment implements MqttCallback{\r\n\r\n    private RecyclerView recyclerView;\r\n    private StaticRvAdapter staticRvAdapter;\r\n    private TabLayout tabLayout;\r\n    private ViewPager viewPager;\r\n    //WEATHER\r\n    private static  final int REQUEST_LOCATION=1;\r\n    double lat;\r\n    double longi;\r\n\r\n    TextView showLocationTxt;\r\n\r\n    LocationManager locationManager;\r\n    String latitude,longitude;\r\n\r\n    TextView view_city;\r\n    TextView view_temp;\r\n    TextView view_desc;\r\n    TextView view_country;\r\n\r\n    ImageView view_weather;\r\n    //\r\n    //Acceso a la maquina\r\n\r\n\r\n\r\n    public static MqttClient client = null;\r\n    // TODO: Rename parameter arguments, choose names that match\r\n    // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER\r\n    private static final String ARG_PARAM1 = \"param1\";\r\n    private static final String ARG_PARAM2 = \"param2\";\r\n\r\n    // TODO: Rename and change types of parameters\r\n    private String mParam1;\r\n    private String mParam2;\r\n\r\n    public DashboardFragment() {\r\n        // Required empty public constructor\r\n    }\r\n\r\n    /**\r\n     * Use this factory method to create a new instance of\r\n     * this fragment using the provided parameters.\r\n     *\r\n     * @param param1 Parameter 1.\r\n     * @param param2 Parameter 2.\r\n     * @return A new instance of fragment DashboardFragment.\r\n     */\r\n    // TODO: Rename and change types and number of parameters\r\n    public static DashboardFragment newInstance(String param1, String param2) {\r\n        DashboardFragment fragment = new DashboardFragment();\r\n        Bundle args = new Bundle();\r\n        args.putString(ARG_PARAM1, param1);\r\n        args.putString(ARG_PARAM2, param2);\r\n        fragment.setArguments(args);\r\n        return fragment;\r\n    }\r\n\r\n    @Override\r\n    public void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        if (getArguments() != null) {\r\n            mParam1 = getArguments().getString(ARG_PARAM1);\r\n            mParam2 = getArguments().getString(ARG_PARAM2);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\r\n                             Bundle savedInstanceState) {\r\n        // Inflate the layout for this fragment\r\n        View v= inflater.inflate(R.layout.fragment_dashboard, container, false);\r\n        //FIREBASE\r\n        //Recojo los datos del usuario\r\n        final FirebaseAuth mAuth = FirebaseAuth.getInstance();\r\n        final FirebaseUser usuario = mAuth.getCurrentUser();\r\n        final FirebaseFirestore fStore=FirebaseFirestore.getInstance();\r\n        String idUser=usuario.getUid();\r\n        //guardo el nombre en un textView\r\n        /*final TextView nombre = (TextView) v.findViewById(R.id.hello_text);\r\n        String res=\"Hola\"+\" \"+usuario.getDisplayName();\r\n        nombre.setText(res);\r\n        DocumentReference documentReference=fStore.collection(\"Usuarios\").document(idUser);\r\n        documentReference.addSnapshotListener(new EventListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onEvent(@Nullable DocumentSnapshot snapshot, @Nullable FirebaseFirestoreException e) {\r\n                if(usuario.getDisplayName() == null){\r\n                    String res1=\"Hola\"+\" \"+snapshot.getString(\"username\");\r\n                    nombre.setText(res1);\r\n                }\r\n            }\r\n        });*/\r\n\r\n        //switch methods\r\n /*     Switch switchLuz = (Switch) v.findViewById(R.id.switchLuminosidadGeneral);\r\n        switchLuz.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {\r\n            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {\r\n                if (isChecked) {\r\n                    // The toggle is enabled\r\n                    enviarLucesOn();\r\n                } else {\r\n                    // The toggle is disabled\r\n                    enviarLucesOff();\r\n                }\r\n            }\r\n        });*/\r\n\r\n\r\n        //WEATHER\r\n        ActivityCompat.requestPermissions(getActivity(),new String[]\r\n                {Manifest.permission.ACCESS_FINE_LOCATION}, REQUEST_LOCATION);\r\n\r\n        view_city =v.findViewById(R.id.town);\r\n        view_city.setText(\"\");\r\n        view_temp =v.findViewById(R.id.temp);\r\n        view_temp.setText(\"\");\r\n        view_desc =v.findViewById(R.id.desc);\r\n        view_desc.setText(\"\");\r\n        view_country=v.findViewById(R.id.txtCountry);\r\n        view_country.setText(\"\");\r\n        view_weather =v.findViewById(R.id.wheather_image);\r\n\r\n        locationManager=(LocationManager)getActivity().getSystemService(Context.LOCATION_SERVICE);\r\n       /* inicioGPS();*/\r\n        //\r\n\r\n\r\n\r\n\r\n        //RECYCLER VIEW\r\n        ArrayList<StaticRvModel> item=new ArrayList<>();\r\n        item.add(new StaticRvModel(R.drawable.icons_sun,\"Soleado\"));\r\n        item.add(new StaticRvModel(R.drawable.icons_night_mode,\"Nocturno\"));\r\n        item.add(new StaticRvModel(R.drawable.icons_energy_saving,\"Ahorro\"));\r\n        item.add(new StaticRvModel(R.drawable.icons_power_off,\"Apagado\"));\r\n        item.add(new StaticRvModel(R.drawable.icons_custom,\"Custom\"));\r\n\r\n        final TextView medidasT=v.findViewById(R.id.medidaTemperaturaGeneral);\r\n        final TextView medidasH=v.findViewById(R.id.medidaHumedadGeneral);\r\n        final TextView medidasS=v.findViewById(R.id.medidaSalinidadGeneral);\r\n        final TextView medidasL=v.findViewById(R.id.medidasLuminosidadGeneral);\r\n\r\n        recyclerView=v.findViewById(R.id.rv_1);\r\n        staticRvAdapter=new StaticRvAdapter(item,medidasT,medidasH,medidasS,medidasL);\r\n        recyclerView.setLayoutManager(new LinearLayoutManager(requireContext(),LinearLayoutManager.HORIZONTAL,false));\r\n        recyclerView.setAdapter(staticRvAdapter);\r\n\r\n\r\n        //TABS\r\n        tabLayout = v.findViewById(R.id.tab_layout);\r\n        viewPager = v.findViewById(R.id.view_pager);\r\n         //Array\r\n        ArrayList<String> arrayList = new ArrayList<>();\r\n\r\n        //set up with viewpager\r\n        tabLayout.setupWithViewPager(viewPager);\r\n\r\n        TabAdapter adapter = new TabAdapter(getActivity().getSupportFragmentManager());\r\n        //Pestañas\r\n        adapter.addFrag(new GeneralFragment(),\"General\");\r\n        adapter.addFrag(new Planta1Fragment(),\"Planta 1\");\r\n        adapter.addFrag(new Planta2Fragment(),\"Planta 2\");\r\n\r\n        viewPager.setAdapter(adapter );\r\n\r\n        /*((MainActivity)getActivity()).ola();*/\r\n     /*   //LEER DATOS FIREBASE\r\n        //Temperatura\r\n       DocumentReference documentTemperatura=fStore.collection(\"SensoresA-T\").document(\"Temperatura\");\r\n        documentTemperatura.addSnapshotListener(new EventListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onEvent(@Nullable DocumentSnapshot snapshot, @Nullable FirebaseFirestoreException e) {\r\n                String resMediTemp=snapshot.getString(\"Medición\")+\"°C\";\r\n                medidasT.setText(resMediTemp);\r\n            }\r\n        });\r\n        //Humedad\r\n        DocumentReference documentHumedad=fStore.collection(\"SensoresA-T\").document(\"Humedad\");\r\n        documentHumedad.addSnapshotListener(new EventListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onEvent(@Nullable DocumentSnapshot snapshot, @Nullable FirebaseFirestoreException e) {\r\n                String resMediHum=snapshot.getString(\"Porcentaje\")+\"%\";\r\n                medidasH.setText(resMediHum);\r\n            }\r\n        });\r\n        //Iluminación\r\n        DocumentReference documentIluminación=fStore.collection(\"SensoresA-T\").document(\"Iluminación\");\r\n        documentIluminación.addSnapshotListener(new EventListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onEvent(@Nullable DocumentSnapshot snapshot, @Nullable FirebaseFirestoreException e) {\r\n                String resMediIlum=snapshot.getString(\"Porcentaje\")+\"%\";\r\n                medidasL.setText(resMediIlum);\r\n            }\r\n        });\r\n        //Temperatura ambiente\r\n        DocumentReference documentambiente=fStore.collection(\"SensoresA-T\").document(\"Temperatura ambiente\");\r\n        documentambiente.addSnapshotListener(new EventListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onEvent(@Nullable DocumentSnapshot snapshot, @Nullable FirebaseFirestoreException e) {\r\n                String resMediIAmb=snapshot.getString(\"Medición\")+\"°C\";\r\n                medidasS.setText(resMediIAmb);\r\n            }\r\n        });\r\n\r\n      */\r\n\r\n\r\n        return v;\r\n    }\r\n\r\n    public void enviarLucesOff(){\r\n        try {\r\n            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new\r\n                    MemoryPersistence());\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n        MqttConnectOptions connOpts = new MqttConnectOptions();\r\n        connOpts.setCleanSession(true);\r\n        connOpts.setKeepAliveInterval(60);\r\n        connOpts.setWill(topicRoot+\"WillTopic\", \"App desconectada\".getBytes(),Mqtt.qos, false);\r\n\r\n        try {\r\n            client.connect(connOpts);\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        //conexión con el broker Root1 = Lector de datos\r\n        //nos subscribimos a topic lectura\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Subscrito a \" + topicRoot + \"luces\");//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este\r\n            client.subscribe(topicRoot + \"luces\", Mqtt.qos);\r\n            client.setCallback((MqttCallback) this);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al suscribir.\", e);\r\n        }\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Publicando mensaje: \" + \"mensaje\");\r\n            MqttMessage message = new MqttMessage(\"luces OFF\".getBytes());\r\n            message.setQos(Mqtt.qos);\r\n            message.setRetained(false);\r\n            client.publish(topicRoot+\"luces\", message);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al publicar.\", e);\r\n        }\r\n    }\r\n    public void enviarLucesOn(){\r\n        try {\r\n            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new\r\n                    MemoryPersistence());\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n        MqttConnectOptions connOpts = new MqttConnectOptions();\r\n        connOpts.setCleanSession(true);\r\n        connOpts.setKeepAliveInterval(60);\r\n        connOpts.setWill(topicRoot+\"WillTopic\", \"App desconectada\".getBytes(),Mqtt.qos, false);\r\n\r\n        try {\r\n            client.connect(connOpts);\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        //conexión con el broker Root1 = Lector de datos\r\n        //nos subscribimos a topic lectura\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Subscrito a \" + topicRoot + \"luces\");//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este\r\n            client.subscribe(topicRoot + \"luces\", Mqtt.qos);\r\n            client.setCallback((MqttCallback) this);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al suscribir.\", e);\r\n        }\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Publicando mensaje: \" + \"mensaje\");\r\n            MqttMessage message = new MqttMessage(\"luces ON\".getBytes());\r\n            message.setQos(Mqtt.qos);\r\n            message.setRetained(false);\r\n            client.publish(topicRoot+\"luces\", message);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al publicar.\", e);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void connectionLost(Throwable cause) {\r\n        Log.d(Mqtt.TAG, \"Conexión perdida\");\r\n    }\r\n\r\n    @Override\r\n    public void messageArrived(String topic, MqttMessage message) throws Exception {\r\n\r\n    }\r\n\r\n    @Override\r\n    public void deliveryComplete(IMqttDeliveryToken token) {\r\n        Log.d(Mqtt.TAG, \"Entrega completa\");\r\n    }\r\n\r\n\r\n    //WEATHER METHODS\r\n    private void api_key(final String City) {\r\n        OkHttpClient client = new OkHttpClient();\r\n\r\n        Request request = new Request.Builder()\r\n                .url(\"https://api.openweathermap.org/data/2.5/weather?q=\" + City + \"&appid=a6f41d947e0542a26580bcd5c3fb90ef&units=metric\")\r\n                .get()\r\n                .build();\r\n        StrictMode.ThreadPolicy policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();\r\n        StrictMode.setThreadPolicy(policy);\r\n        try {\r\n            Response response = client.newCall(request).execute();\r\n            client.newCall(request).enqueue(new Callback() {\r\n                @Override\r\n                public void onFailure(Request request, IOException e) {\r\n\r\n                }\r\n\r\n                @Override\r\n                public void onResponse(Response response) throws IOException {\r\n                    String responseData = response.body().string();\r\n                    try {\r\n                        JSONObject json = new JSONObject(responseData);\r\n                        JSONArray array = json.getJSONArray(\"weather\");\r\n                        JSONObject object = array.getJSONObject(0);\r\n\r\n                        String description = object.getString(\"description\");\r\n                        String icons = object.getString(\"icon\");\r\n\r\n                        JSONObject temp1 = json.getJSONObject(\"main\");\r\n                        Double Temperature = temp1.getDouble(\"temp\");\r\n\r\n                        setText(view_city, City);\r\n\r\n                        String temps = Math.round(Temperature) + \" °C\";\r\n                        setText(view_temp, temps);\r\n                        setText(view_desc, description);\r\n                        setImage(view_weather, icons);\r\n\r\n                    } catch (JSONException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                }\r\n\r\n            });\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n    }\r\n\r\n    private void setText(final TextView text, final String value) {\r\n        getActivity().runOnUiThread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                text.setText(value);\r\n            }\r\n        });\r\n    }\r\n\r\n    private void setImage(final ImageView imageView, final String value) {\r\n        getActivity().runOnUiThread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                //paste switch\r\n                switch (value) {\r\n                    case \"01d\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d01d));\r\n                        break;\r\n                    case \"01n\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d01d));\r\n                        break;\r\n                    case \"02d\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d02d));\r\n                        break;\r\n                    case \"02n\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d02d));\r\n                        break;\r\n                    case \"03d\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d03d));\r\n                        break;\r\n                    case \"03n\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d03d));\r\n                        break;\r\n                    case \"04d\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d04d));\r\n                        break;\r\n                    case \"04n\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d04d));\r\n                        break;\r\n                    case \"09d\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d09d));\r\n                        break;\r\n                    case \"09n\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d09d));\r\n                        break;\r\n                    case \"10d\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d10d));\r\n                        break;\r\n                    case \"10n\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d10d));\r\n                        break;\r\n                    case \"11d\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d11d));\r\n                        break;\r\n                    case \"11n\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d11d));\r\n                        break;\r\n                    case \"13d\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d13d));\r\n                        break;\r\n                    case \"13n\":\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d13d));\r\n                        break;\r\n                    default:\r\n                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.wheather));\r\n\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    //App location\r\n   /* private void getLocation() {\r\n\r\n        //Check Permissions again\r\n\r\n        /*if (ActivityCompat.checkSelfPermission(\r\n                getContext(),Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(\r\n                getContext(), Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n            ActivityCompat.requestPermissions(getActivity(), new String[]{Manifest.permission.ACCESS_FINE_LOCATION}, REQUEST_LOCATION);\r\n        } else {\r\n\r\n            Location LocationNetwork=locationManager.getLastKnownLocation(LocationManager.NETWORK_PROVIDER);\r\n             if (LocationNetwork !=null)\r\n            {\r\n                double lat=LocationNetwork.getLatitude();\r\n                double longi=LocationNetwork.getLongitude();\r\n\r\n                latitude=String.valueOf(lat);\r\n                longitude=String.valueOf(longi);\r\n               /* loc_func(LocationNetwork);*/\r\n              /*  api_key(String.valueOf(view_city.getText()));\r\n                showLocationTxt.setText(\"Your Location:\"+\"\\n\"+\"Latitude= \"+latitude+\"\\n\"+\"Longitude= \"+longitude);\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    private void OnGPS() {\r\n\r\n        final AlertDialog.Builder builder= new AlertDialog.Builder(getContext());\r\n\r\n        builder.setMessage(\"Enable GPS\").setCancelable(false).setPositiveButton(\"YES\", new DialogInterface.OnClickListener() {\r\n            @Override\r\n            public void onClick(DialogInterface dialog, int which) {\r\n                startActivity(new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS));\r\n                getLocation();\r\n            }\r\n        }).setNegativeButton(\"NO\", new DialogInterface.OnClickListener() {\r\n            @Override\r\n            public void onClick(DialogInterface dialog, int which) {\r\n\r\n                dialog.cancel();\r\n            }\r\n        });\r\n        final AlertDialog alertDialog=builder.create();\r\n        alertDialog.show();\r\n    }\r\n\r\n    private void loc_func(Location location){\r\n        try {\r\n            Geocoder geocoder=new Geocoder(getContext());\r\n            List<Address> addresses = geocoder.getFromLocation(lat, longi, 1);\r\n            /*String address = addresses.get(0).getSubLocality();*/\r\n           /* String cityName = addresses.get(0).getLocality();\r\n            String stateName = addresses.get(0).getAdminArea();\r\n            String country = addresses.get(0).getCountryName();\r\n            //txt_paddress.setText(address);\r\n            view_city.setText(cityName);\r\n            view_country.setText(country);\r\n            //txt_state.setText(stateName);*/\r\n\r\n       /* } catch (IOException e) {\r\n            e.printStackTrace();\r\n            Toast.makeText(getContext(), \"Error:\"+e, Toast.LENGTH_SHORT).show();\r\n        }\r\n    }\r\n\r\n    private void inicioGPS(){\r\n\r\n\r\n        //Check gps is enable or not\r\n\r\n        if (!locationManager.isProviderEnabled(LocationManager.GPS_PROVIDER))\r\n        {\r\n            //Write Function To enable gps\r\n\r\n            OnGPS();\r\n        }\r\n        else\r\n        {\r\n            //GPS is already On then\r\n\r\n            /*getLocation();*/\r\n /*       }\r\n    }*/\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/infinitycrop/ui/dashboard/DashboardFragment.java	(revision 97b60040cb9ddffbf7eb424364e4fc4451452801)
+++ app/src/main/java/com/example/infinitycrop/ui/dashboard/DashboardFragment.java	(date 1611080613863)
@@ -2,15 +2,22 @@
 
 import android.Manifest;
 import android.content.Context;
+import android.content.Intent;
+import android.content.pm.PackageManager;
+import android.location.Location;
+import android.location.LocationListener;
 import android.location.LocationManager;
+import android.os.AsyncTask;
 import android.os.Bundle;
 
+import androidx.annotation.NonNull;
 import androidx.core.app.ActivityCompat;
 import androidx.fragment.app.Fragment;
 import androidx.recyclerview.widget.LinearLayoutManager;
 import androidx.recyclerview.widget.RecyclerView;
 import androidx.viewpager.widget.ViewPager;
 
+import android.os.Handler;
 import android.os.StrictMode;
 import android.util.Log;
 import android.view.LayoutInflater;
@@ -18,15 +25,20 @@
 import android.view.ViewGroup;
 import android.widget.ImageView;
 import android.widget.TextView;
+import android.widget.Toast;
 
 import com.example.comun.Mqtt;
 import com.example.infinitycrop.R;
+import com.example.infinitycrop.ui.MachineControl.planta1;
 import com.example.infinitycrop.ui.recycler_control.StaticRvAdapter;
 import com.example.infinitycrop.ui.recycler_control.StaticRvModel;
 import com.google.android.material.tabs.TabLayout;
 import com.google.firebase.auth.FirebaseAuth;
 import com.google.firebase.auth.FirebaseUser;
 import com.google.firebase.firestore.FirebaseFirestore;
+import com.loopj.android.http.AsyncHttpClient;
+import com.loopj.android.http.JsonHttpResponseHandler;
+import com.loopj.android.http.RequestParams;
 import com.squareup.okhttp.Callback;
 import com.squareup.okhttp.OkHttpClient;
 import com.squareup.okhttp.Request;
@@ -44,7 +56,15 @@
 import org.json.JSONObject;
 
 import java.io.IOException;
+import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.net.HttpURLConnection;
+import java.net.MalformedURLException;
+import java.net.URL;
 import java.util.ArrayList;
+import java.util.concurrent.ExecutionException;
+
+import cz.msebera.android.httpclient.Header;
 
 import static com.example.comun.Mqtt.topicRoot;
 
@@ -53,33 +73,30 @@
  * Use the {@link DashboardFragment#newInstance} factory method to
  * create an instance of this fragment.
  */
-public class DashboardFragment extends Fragment implements MqttCallback{
+public class DashboardFragment extends Fragment implements MqttCallback {
 
     private RecyclerView recyclerView;
     private StaticRvAdapter staticRvAdapter;
     private TabLayout tabLayout;
     private ViewPager viewPager;
-    //WEATHER
-    private static  final int REQUEST_LOCATION=1;
-    double lat;
-    double longi;
+    //Weather
+
+    final long MIN_TIME = 200;
+    final float MIN_DISTANCE = 200;
+    final int REQUEST_CODE = 101;
+    final String APP_ID = "2599fe29f309cebdb21dd7dcf235662a";
+    String Location_Provider = LocationManager.GPS_PROVIDER;
+    final String WEATHER_URL = "https://api.openweathermap.org/data/2.5/weather";
 
-    TextView showLocationTxt;
+    TextView NameofCity, weatherState, Temperature;
+    ImageView mweatherIcon;
 
-    LocationManager locationManager;
-    String latitude,longitude;
+    LocationManager mLocationManager;
+    LocationListener mLocationListner;
 
-    TextView view_city;
-    TextView view_temp;
-    TextView view_desc;
-    TextView view_country;
 
-    ImageView view_weather;
-    //
+
     //Acceso a la maquina
-
-
-
     public static MqttClient client = null;
     // TODO: Rename parameter arguments, choose names that match
     // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER
@@ -125,13 +142,13 @@
     public View onCreateView(LayoutInflater inflater, ViewGroup container,
                              Bundle savedInstanceState) {
         // Inflate the layout for this fragment
-        View v= inflater.inflate(R.layout.fragment_dashboard, container, false);
+        final View v = inflater.inflate(R.layout.fragment_dashboard, container, false);
         //FIREBASE
         //Recojo los datos del usuario
         final FirebaseAuth mAuth = FirebaseAuth.getInstance();
         final FirebaseUser usuario = mAuth.getCurrentUser();
-        final FirebaseFirestore fStore=FirebaseFirestore.getInstance();
-        String idUser=usuario.getUid();
+        final FirebaseFirestore fStore = FirebaseFirestore.getInstance();
+        String idUser = usuario.getUid();
         //guardo el nombre en un textView
         /*final TextView nombre = (TextView) v.findViewById(R.id.hello_text);
         String res="Hola"+" "+usuario.getDisplayName();
@@ -162,50 +179,32 @@
         });*/
 
 
-        //WEATHER
-        ActivityCompat.requestPermissions(getActivity(),new String[]
-                {Manifest.permission.ACCESS_FINE_LOCATION}, REQUEST_LOCATION);
-
-        view_city =v.findViewById(R.id.town);
-        view_city.setText("");
-        view_temp =v.findViewById(R.id.temp);
-        view_temp.setText("");
-        view_desc =v.findViewById(R.id.desc);
-        view_desc.setText("");
-        view_country=v.findViewById(R.id.txtCountry);
-        view_country.setText("");
-        view_weather =v.findViewById(R.id.wheather_image);
-
-        locationManager=(LocationManager)getActivity().getSystemService(Context.LOCATION_SERVICE);
-       /* inicioGPS();*/
         //
-
-
 
 
         //RECYCLER VIEW
-        ArrayList<StaticRvModel> item=new ArrayList<>();
-        item.add(new StaticRvModel(R.drawable.icons_sun,"Soleado"));
-        item.add(new StaticRvModel(R.drawable.icons_night_mode,"Nocturno"));
-        item.add(new StaticRvModel(R.drawable.icons_energy_saving,"Ahorro"));
-        item.add(new StaticRvModel(R.drawable.icons_power_off,"Apagado"));
-        item.add(new StaticRvModel(R.drawable.icons_custom,"Custom"));
+        ArrayList<StaticRvModel> item = new ArrayList<>();
+        item.add(new StaticRvModel(R.drawable.icons_sun, "Soleado"));
+        item.add(new StaticRvModel(R.drawable.icons_night_mode, "Nocturno"));
+        item.add(new StaticRvModel(R.drawable.icons_energy_saving, "Ahorro"));
+        item.add(new StaticRvModel(R.drawable.icons_power_off, "Apagado"));
+        item.add(new StaticRvModel(R.drawable.icons_custom, "Custom"));
 
-        final TextView medidasT=v.findViewById(R.id.medidaTemperaturaGeneral);
-        final TextView medidasH=v.findViewById(R.id.medidaHumedadGeneral);
-        final TextView medidasS=v.findViewById(R.id.medidaSalinidadGeneral);
-        final TextView medidasL=v.findViewById(R.id.medidasLuminosidadGeneral);
+        final TextView medidasT = v.findViewById(R.id.medidaTemperaturaGeneral);
+        final TextView medidasH = v.findViewById(R.id.medidaHumedadGeneral);
+        final TextView medidasS = v.findViewById(R.id.medidaSalinidadGeneral);
+        final TextView medidasL = v.findViewById(R.id.medidasLuminosidadGeneral);
 
-        recyclerView=v.findViewById(R.id.rv_1);
-        staticRvAdapter=new StaticRvAdapter(item,medidasT,medidasH,medidasS,medidasL);
-        recyclerView.setLayoutManager(new LinearLayoutManager(requireContext(),LinearLayoutManager.HORIZONTAL,false));
+        recyclerView = v.findViewById(R.id.rv_1);
+        staticRvAdapter = new StaticRvAdapter(item, medidasT, medidasH, medidasS, medidasL);
+        recyclerView.setLayoutManager(new LinearLayoutManager(requireContext(), LinearLayoutManager.HORIZONTAL, false));
         recyclerView.setAdapter(staticRvAdapter);
 
 
         //TABS
         tabLayout = v.findViewById(R.id.tab_layout);
         viewPager = v.findViewById(R.id.view_pager);
-         //Array
+        //Array
         ArrayList<String> arrayList = new ArrayList<>();
 
         //set up with viewpager
@@ -213,11 +212,11 @@
 
         TabAdapter adapter = new TabAdapter(getActivity().getSupportFragmentManager());
         //Pestañas
-        adapter.addFrag(new GeneralFragment(),"General");
-        adapter.addFrag(new Planta1Fragment(),"Planta 1");
-        adapter.addFrag(new Planta2Fragment(),"Planta 2");
+        adapter.addFrag(new GeneralFragment(), "General");
+        adapter.addFrag(new Planta1Fragment(), "Planta 1");
+        adapter.addFrag(new Planta2Fragment(), "Planta 2");
 
-        viewPager.setAdapter(adapter );
+        viewPager.setAdapter(adapter);
 
         /*((MainActivity)getActivity()).ola();*/
      /*   //LEER DATOS FIREBASE
@@ -259,10 +258,109 @@
         });
 
       */
-
+        //Weather App
+        weatherState =(TextView) v.findViewById(R.id.weatherCondition);
+        Temperature = (TextView)v.findViewById(R.id.temperature);
+        mweatherIcon =(ImageView) v.findViewById(R.id.weatherIcon);
+        NameofCity = (TextView)v.findViewById(R.id.cityName);
 
         return v;
     }
+    @Override
+    public void onResume() {
+        super.onResume();
+        getWeatherForCurrentLocation();
+    }
+    private void getWeatherForCurrentLocation() {
+        mLocationManager = (LocationManager) getContext().getSystemService(Context.LOCATION_SERVICE);
+        mLocationListner = new LocationListener() {
+            @Override
+            public void onLocationChanged(Location location) {
+                String Latitude = String.valueOf(location.getLatitude());
+                String Longitude = String.valueOf(location.getLongitude());
+                RequestParams params = new RequestParams();
+                params.put("lat",Latitude);
+                params.put("lon",Longitude);
+                params.put("appid",APP_ID);
+                letsDoSomeWorking(params);
+
+            }
+            @Override
+            public void onStatusChanged(String provider, int status, Bundle extras) {
+
+            }
+
+            @Override
+            public void onProviderEnabled(String provider) {
+
+            }
+
+            @Override
+            public void onProviderDisabled(String provider) {
+
+            }
+        };
+        if (ActivityCompat.checkSelfPermission(getContext(), Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(getContext(), Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {
+            // TODO: Consider calling
+            //    ActivityCompat#requestPermissions
+            // here to request the missing permissions, and then overriding
+            //   public void onRequestPermissionsResult(int requestCode, String[] permissions,
+            //                                          int[] grantResults)
+            // to handle the case where the user grants the permission. See the documentation
+            // for ActivityCompat#requestPermissions for more details.
+            ActivityCompat.requestPermissions(getActivity(),new String[]{Manifest.permission.ACCESS_FINE_LOCATION},REQUEST_CODE);
+            return;
+        }
+        mLocationManager.requestLocationUpdates(Location_Provider, MIN_TIME, MIN_DISTANCE, mLocationListner);
+    }
+    @Override
+    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
+        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
+        if (requestCode == REQUEST_CODE) {
+            if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
+                Toast.makeText(getContext(), "Localizacion obtenida", Toast.LENGTH_SHORT).show();
+                getWeatherForCurrentLocation();
+            } else {
+                Toast.makeText(getContext(), "Localizaacion no obtenida", Toast.LENGTH_SHORT).show();
+            }
+
+        }
+    }
+    private void letsDoSomeWorking(RequestParams params){
+        AsyncHttpClient client =new AsyncHttpClient();
+        client.get(WEATHER_URL,params,new JsonHttpResponseHandler(){
+            @Override
+            public void onSuccess(int statusCode, Header[] headers, JSONObject response) {
+                /*Toast.makeText(getContext(), "Data obteninda", Toast.LENGTH_SHORT).show();*/
+                weatherData weatherD= weatherData.fromJson(response);
+                updateUI(weatherD);
+                //super.onSuccess(statusCode, headers, response);
+            }
+            @Override
+            public void onFailure(int statusCode, Header[] headers, Throwable throwable, JSONObject errorResponse) {
+                //super.onFailure(statusCode, headers, throwable, errorResponse);
+                Toast.makeText(getContext(), "Data no obteninda", Toast.LENGTH_SHORT).show();
+            }
+        });
+    }
+    private void updateUI(weatherData weather){
+        Temperature.setText(weather.getmTemperature());
+        NameofCity.setText(weather.getMcity());
+        weatherState.setText(weather.getmWeatherType());
+        int resourceID =getResources().getIdentifier(weather.getMicon(),"drawable",getActivity().getPackageName());
+        mweatherIcon.setImageResource(resourceID);
+
+
+    }
+    @Override
+    public void onPause() {
+        super.onPause();
+        if(mLocationManager!=null){
+            mLocationManager.removeUpdates(mLocationListner);
+        }
+    }
+
+
 
     public void enviarLucesOff(){
         try {
@@ -355,56 +453,7 @@
     }
 
 
-    //WEATHER METHODS
-    private void api_key(final String City) {
-        OkHttpClient client = new OkHttpClient();
-
-        Request request = new Request.Builder()
-                .url("https://api.openweathermap.org/data/2.5/weather?q=" + City + "&appid=a6f41d947e0542a26580bcd5c3fb90ef&units=metric")
-                .get()
-                .build();
-        StrictMode.ThreadPolicy policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();
-        StrictMode.setThreadPolicy(policy);
-        try {
-            Response response = client.newCall(request).execute();
-            client.newCall(request).enqueue(new Callback() {
-                @Override
-                public void onFailure(Request request, IOException e) {
 
-                }
-
-                @Override
-                public void onResponse(Response response) throws IOException {
-                    String responseData = response.body().string();
-                    try {
-                        JSONObject json = new JSONObject(responseData);
-                        JSONArray array = json.getJSONArray("weather");
-                        JSONObject object = array.getJSONObject(0);
-
-                        String description = object.getString("description");
-                        String icons = object.getString("icon");
-
-                        JSONObject temp1 = json.getJSONObject("main");
-                        Double Temperature = temp1.getDouble("temp");
-
-                        setText(view_city, City);
-
-                        String temps = Math.round(Temperature) + " °C";
-                        setText(view_temp, temps);
-                        setText(view_desc, description);
-                        setImage(view_weather, icons);
-
-                    } catch (JSONException e) {
-                        e.printStackTrace();
-                    }
-                }
-
-            });
-        } catch (IOException e) {
-            e.printStackTrace();
-        }
-
-    }
 
     private void setText(final TextView text, final String value) {
         getActivity().runOnUiThread(new Runnable() {
@@ -415,67 +464,7 @@
         });
     }
 
-    private void setImage(final ImageView imageView, final String value) {
-        getActivity().runOnUiThread(new Runnable() {
-            @Override
-            public void run() {
-                //paste switch
-                switch (value) {
-                    case "01d":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d01d));
-                        break;
-                    case "01n":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d01d));
-                        break;
-                    case "02d":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d02d));
-                        break;
-                    case "02n":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d02d));
-                        break;
-                    case "03d":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d03d));
-                        break;
-                    case "03n":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d03d));
-                        break;
-                    case "04d":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d04d));
-                        break;
-                    case "04n":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d04d));
-                        break;
-                    case "09d":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d09d));
-                        break;
-                    case "09n":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d09d));
-                        break;
-                    case "10d":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d10d));
-                        break;
-                    case "10n":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d10d));
-                        break;
-                    case "11d":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d11d));
-                        break;
-                    case "11n":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d11d));
-                        break;
-                    case "13d":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d13d));
-                        break;
-                    case "13n":
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.d13d));
-                        break;
-                    default:
-                        imageView.setImageDrawable(getResources().getDrawable(R.drawable.wheather));
 
-                }
-            }
-        });
-    }
 
     //App location
    /* private void getLocation() {
Index: app/src/main/res/layout/fragment_dashboard.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<ScrollView xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    tools:context=\".ui.dashboard.DashboardFragment\">\r\n\r\n    <!-- TODO: Update blank fragment layout -->\r\n    <!--<TextView\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_centerInParent=\"true\"\r\n        android:textSize=\"50dp\"\r\n        android:text=\"Home fragment\" />-->\r\n    <!--<LinearLayout\r\n        android:orientation=\"vertical\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\">\r\n\r\n        <RelativeLayout\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginRight=\"28dp\"\r\n            android:layout_marginTop=\"32dp\"\r\n            android:layout_marginLeft=\"28dp\">\r\n\r\n            <ImageView\r\n                android:layout_alignParentRight=\"true\"\r\n                android:src=\"@drawable/ic_home\"\r\n                android:layout_width=\"62dp\"\r\n                android:layout_height=\"62dp\"/>\r\n\r\n        </RelativeLayout>\r\n\r\n    </LinearLayout>-->\r\n\r\n    <androidx.constraintlayout.widget.ConstraintLayout\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\">\r\n\r\n        <androidx.constraintlayout.widget.ConstraintLayout\r\n            android:id=\"@+id/constraintLayout3\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginTop=\"10dp\"\r\n            android:gravity=\"center\"\r\n            app:layout_constraintEnd_toEndOf=\"parent\"\r\n            app:layout_constraintStart_toStartOf=\"parent\"\r\n            app:layout_constraintTop_toTopOf=\"parent\">\r\n\r\n            <LinearLayout\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:orientation=\"horizontal\"\r\n                app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                app:layout_constraintEnd_toEndOf=\"parent\"\r\n                app:layout_constraintStart_toStartOf=\"parent\"\r\n                app:layout_constraintTop_toTopOf=\"parent\">\r\n\r\n                <ImageView\r\n                    android:id=\"@+id/imgLogo\"\r\n                    android:layout_width=\"32dp\"\r\n                    android:layout_height=\"32dp\"\r\n                    android:src=\"@drawable/logo_without_background\" />\r\n\r\n                <TextView\r\n                    android:id=\"@+id/textInfinity\"\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"match_parent\"\r\n                    android:layout_marginLeft=\"2dp\"\r\n                    android:gravity=\"center\"\r\n                    android:text=\"Infinity Crop\"\r\n                    android:textSize=\"19sp\" />\r\n\r\n            </LinearLayout>\r\n\r\n        </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n        <androidx.cardview.widget.CardView\r\n            android:id=\"@+id/hello_text\"\r\n            android:layout_width=\"0dp\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_margin=\"12dp\"\r\n            android:layout_marginStart=\"8dp\"\r\n            android:layout_marginTop=\"60dp\"\r\n            android:layout_marginEnd=\"8dp\"\r\n            app:cardCornerRadius=\"12dp\"\r\n            app:cardElevation=\"6dp\"\r\n            app:layout_constraintEnd_toEndOf=\"parent\"\r\n            app:layout_constraintStart_toStartOf=\"parent\"\r\n            app:layout_constraintTop_toBottomOf=\"@+id/constraintLayout3\">\r\n\r\n            <LinearLayout\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"match_parent\"\r\n\r\n                android:orientation=\"vertical\"\r\n                android:padding=\"2dp\">\r\n\r\n                <androidx.constraintlayout.widget.ConstraintLayout\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"153dp\"\r\n                    android:layout_marginBottom=\"12dp\">\r\n\r\n\r\n                    <ImageView\r\n                        android:id=\"@+id/wheather_image\"\r\n                        android:layout_width=\"158dp\"\r\n                        android:layout_height=\"130dp\"\r\n                        android:layout_marginEnd=\"32dp\"\r\n                        android:src=\"@drawable/wheather\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toEndOf=\"parent\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\"\r\n                        app:layout_constraintVertical_bias=\"0.547\"\r\n                        tools:ignore=\"MissingConstraints\" />\r\n\r\n                    <TextView\r\n                        android:id=\"@+id/temp\"\r\n                        android:layout_width=\"wrap_content\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_marginStart=\"24dp\"\r\n                        android:layout_marginTop=\"8dp\"\r\n                        android:text=\"15°C\"\r\n                        android:textColor=\"#000000\"\r\n                        android:textSize=\"36sp\"\r\n                        app:layout_constraintEnd_toStartOf=\"@+id/wheather_image\"\r\n                        app:layout_constraintHorizontal_bias=\"0.013\"\r\n                        app:layout_constraintStart_toStartOf=\"parent\"\r\n                        app:layout_constraintTop_toBottomOf=\"@+id/town\"\r\n                        tools:ignore=\"MissingConstraints\" />\r\n\r\n                    <TextView\r\n                        android:id=\"@+id/desc\"\r\n                        android:layout_width=\"wrap_content\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_marginStart=\"24dp\"\r\n                        android:layout_marginTop=\"8dp\"\r\n                        android:text=\"Description\"\r\n                        android:textAppearance=\"@style/TextAppearance.AppCompat.Body1\"\r\n                        android:textColor=\"#494343\"\r\n                        app:layout_constraintEnd_toStartOf=\"@+id/wheather_image\"\r\n                        app:layout_constraintHorizontal_bias=\"0.012\"\r\n                        app:layout_constraintStart_toStartOf=\"parent\"\r\n                        app:layout_constraintTop_toBottomOf=\"@+id/temp\"\r\n                        tools:ignore=\"MissingConstraints\" />\r\n\r\n                    <TextView\r\n                        android:id=\"@+id/town\"\r\n                        android:layout_width=\"wrap_content\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_marginStart=\"24dp\"\r\n                        android:layout_marginTop=\"16dp\"\r\n                        android:text=\"Krakow\"\r\n                        android:textAppearance=\"@style/TextAppearance.AppCompat.Body1\"\r\n                        android:textSize=\"18sp\"\r\n                        app:layout_constraintEnd_toStartOf=\"@+id/wheather_image\"\r\n                        app:layout_constraintHorizontal_bias=\"0.011\"\r\n                        app:layout_constraintStart_toStartOf=\"parent\"\r\n                        app:layout_constraintTop_toTopOf=\"parent\"\r\n                        tools:ignore=\"MissingConstraints\" />\r\n\r\n                    <TextView\r\n                        android:id=\"@+id/txtCountry\"\r\n                        android:layout_width=\"84dp\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_marginStart=\"24dp\"\r\n                        android:text=\"TextView\"\r\n                        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                        app:layout_constraintEnd_toStartOf=\"@+id/wheather_image\"\r\n                        app:layout_constraintHorizontal_bias=\"0.015\"\r\n                        app:layout_constraintStart_toStartOf=\"parent\"\r\n                        app:layout_constraintTop_toBottomOf=\"@+id/desc\"\r\n                        app:layout_constraintVertical_bias=\"0.818\"\r\n                        tools:ignore=\"MissingConstraints\" />\r\n\r\n                </androidx.constraintlayout.widget.ConstraintLayout>\r\n            </LinearLayout>\r\n        </androidx.cardview.widget.CardView>\r\n\r\n\r\n        <RelativeLayout\r\n            android:id=\"@+id/relativeLayout2\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:layout_marginTop=\"60dp\"\r\n            android:layout_marginLeft=\"20dp\"\r\n            android:layout_marginRight=\"20dp\"\r\n            app:layout_constraintTop_toBottomOf=\"@+id/hello_text\"\r\n            tools:layout_editor_absoluteX=\"20dp\">\r\n\r\n            <TextView\r\n                android:id=\"@+id/textMode\"\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:text=\"Modos  >\"\r\n\r\n                android:textSize=\"19sp\" />\r\n\r\n            <!--<ImageView\r\n                android:layout_width=\"62dp\"\r\n                android:layout_height=\"62dp\"\r\n                android:layout_alignParentRight=\"true\"\r\n                android:src=\"@drawable/ic_sun\" />-->\r\n        </RelativeLayout>\r\n\r\n        <androidx.recyclerview.widget.RecyclerView\r\n            android:id=\"@+id/rv_1\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"150dp\"\r\n            android:layout_marginLeft=\"10dp\"\r\n            android:layout_marginTop=\"2dp\"\r\n            android:layout_marginRight=\"10dp\"\r\n            app:layout_constraintBottom_toBottomOf=\"parent\"\r\n            app:layout_constraintEnd_toEndOf=\"parent\"\r\n            app:layout_constraintStart_toStartOf=\"parent\"\r\n            app:layout_constraintTop_toBottomOf=\"@+id/relativeLayout2\"\r\n            app:layout_constraintVertical_bias=\"0\" />\r\n\r\n        <!--<androidx.recyclerview.widget.RecyclerView\r\n            android:id=\"@+id/rv_2\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"200dp\"\r\n            android:layout_marginLeft=\"10dp\"\r\n            android:layout_marginTop=\"40dp\"\r\n            android:layout_marginRight=\"10dp\"\r\n            app:layout_constraintBottom_toBottomOf=\"parent\"\r\n            app:layout_constraintEnd_toEndOf=\"parent\"\r\n            app:layout_constraintStart_toStartOf=\"parent\"\r\n            app:layout_constraintTop_toBottomOf=\"@+id/rv_1\"\r\n            app:layout_constraintVertical_bias=\"0\" />-->\r\n\r\n        <LinearLayout\r\n            android:layout_width=\"0dp\"\r\n            android:layout_height=\"400dp\"\r\n            android:layout_marginTop=\"16dp\"\r\n            android:orientation=\"vertical\"\r\n            app:layout_constraintEnd_toEndOf=\"parent\"\r\n            app:layout_constraintStart_toStartOf=\"parent\"\r\n            app:layout_constraintTop_toBottomOf=\"@+id/rv_1\">\r\n\r\n            <com.google.android.material.tabs.TabLayout\r\n                android:id=\"@+id/tab_layout\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"48dp\"\r\n                android:layout_marginLeft=\"8dp\"\r\n                android:layout_marginRight=\"8dp\"\r\n                android:background=\"@drawable/back_unselected_dash\"\r\n                app:tabIndicatorHeight=\"0dp\"\r\n                app:tabSelectedTextColor=\"@color/colorPrimary\"\r\n                app:tabBackground=\"@drawable/back_tabs_dash\"\r\n                app:tabTextColor=\"@android:color/black\" />\r\n\r\n            <androidx.constraintlayout.widget.ConstraintLayout\r\n                android:layout_width=\"wrap_content\"\r\n                android:layout_height=\"wrap_content\">\r\n\r\n                <androidx.viewpager.widget.ViewPager\r\n                    android:id=\"@+id/view_pager\"\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:layout_marginStart=\"10dp\"\r\n                    android:layout_marginEnd=\"10dp\"\r\n                    app:layout_constraintEnd_toEndOf=\"parent\"\r\n                    app:layout_constraintStart_toStartOf=\"parent\"\r\n                    app:layout_constraintTop_toTopOf=\"parent\">\r\n\r\n                </androidx.viewpager.widget.ViewPager>\r\n            </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n        </LinearLayout>\r\n\r\n    </androidx.constraintlayout.widget.ConstraintLayout>\r\n</ScrollView>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/fragment_dashboard.xml	(revision 97b60040cb9ddffbf7eb424364e4fc4451452801)
+++ app/src/main/res/layout/fragment_dashboard.xml	(date 1611080417505)
@@ -105,77 +105,69 @@
 
 
                     <ImageView
-                        android:id="@+id/wheather_image"
-                        android:layout_width="158dp"
-                        android:layout_height="130dp"
-                        android:layout_marginEnd="32dp"
-                        android:src="@drawable/wheather"
+                        android:id="@+id/weatherIcon"
+                        android:layout_width="146dp"
+                        android:layout_height="117dp"
+                        android:src="@drawable/cloudy"
                         app:layout_constraintBottom_toBottomOf="parent"
                         app:layout_constraintEnd_toEndOf="parent"
+                        app:layout_constraintHorizontal_bias="1.0"
+                        app:layout_constraintStart_toStartOf="@+id/guideline2"
                         app:layout_constraintTop_toTopOf="parent"
-                        app:layout_constraintVertical_bias="0.547"
+                        app:layout_constraintVertical_bias="0.472"
                         tools:ignore="MissingConstraints" />
 
                     <TextView
-                        android:id="@+id/temp"
+                        android:id="@+id/cityName"
                         android:layout_width="wrap_content"
                         android:layout_height="wrap_content"
-                        android:layout_marginStart="24dp"
-                        android:layout_marginTop="8dp"
-                        android:text="15°C"
-                        android:textColor="#000000"
-                        android:textSize="36sp"
-                        app:layout_constraintEnd_toStartOf="@+id/wheather_image"
-                        app:layout_constraintHorizontal_bias="0.013"
+                        android:layout_marginStart="35dp"
+                        android:layout_marginTop="12dp"
+                        android:text="Cargando..."
+                        android:textColor="@color/black"
+                        android:textSize="32sp"
+                        app:layout_constraintEnd_toStartOf="@+id/guideline2"
+                        app:layout_constraintHorizontal_bias="0.0"
                         app:layout_constraintStart_toStartOf="parent"
-                        app:layout_constraintTop_toBottomOf="@+id/town"
-                        tools:ignore="MissingConstraints" />
+                        app:layout_constraintTop_toTopOf="parent" />
 
                     <TextView
-                        android:id="@+id/desc"
+                        android:id="@+id/temperature"
                         android:layout_width="wrap_content"
                         android:layout_height="wrap_content"
-                        android:layout_marginStart="24dp"
-                        android:layout_marginTop="8dp"
-                        android:text="Description"
-                        android:textAppearance="@style/TextAppearance.AppCompat.Body1"
-                        android:textColor="#494343"
-                        app:layout_constraintEnd_toStartOf="@+id/wheather_image"
-                        app:layout_constraintHorizontal_bias="0.012"
-                        app:layout_constraintStart_toStartOf="parent"
-                        app:layout_constraintTop_toBottomOf="@+id/temp"
-                        tools:ignore="MissingConstraints" />
+                        android:layout_marginTop="2dp"
+                        android:textColor="#000000"
+                        android:textSize="55sp"
+                        app:layout_constraintEnd_toStartOf="@+id/weatherIcon"
+                        app:layout_constraintHorizontal_bias="0.0"
+                        app:layout_constraintStart_toStartOf="@+id/cityName"
+                        app:layout_constraintTop_toBottomOf="@+id/cityName" />
 
                     <TextView
-                        android:id="@+id/town"
+                        android:id="@+id/weatherCondition"
                         android:layout_width="wrap_content"
                         android:layout_height="wrap_content"
-                        android:layout_marginStart="24dp"
-                        android:layout_marginTop="16dp"
-                        android:text="Krakow"
-                        android:textAppearance="@style/TextAppearance.AppCompat.Body1"
-                        android:textSize="18sp"
-                        app:layout_constraintEnd_toStartOf="@+id/wheather_image"
-                        app:layout_constraintHorizontal_bias="0.011"
-                        app:layout_constraintStart_toStartOf="parent"
-                        app:layout_constraintTop_toTopOf="parent"
-                        tools:ignore="MissingConstraints" />
-
-                    <TextView
-                        android:id="@+id/txtCountry"
-                        android:layout_width="84dp"
-                        android:layout_height="wrap_content"
-                        android:layout_marginStart="24dp"
-                        android:text="TextView"
+                        android:layout_marginBottom="16dp"
+                        android:text="Cargando..."
+                        android:textColor="@color/black"
+                        android:textSize="15dp"
                         app:layout_constraintBottom_toBottomOf="parent"
-                        app:layout_constraintEnd_toStartOf="@+id/wheather_image"
-                        app:layout_constraintHorizontal_bias="0.015"
-                        app:layout_constraintStart_toStartOf="parent"
-                        app:layout_constraintTop_toBottomOf="@+id/desc"
-                        app:layout_constraintVertical_bias="0.818"
-                        tools:ignore="MissingConstraints" />
+                        app:layout_constraintEnd_toEndOf="@+id/cityName"
+                        app:layout_constraintHorizontal_bias="0.0"
+                        app:layout_constraintStart_toStartOf="@+id/temperature"
+                        app:layout_constraintTop_toBottomOf="@+id/temperature"
+                        app:layout_constraintVertical_bias="0.0" />
+
+                    <androidx.constraintlayout.widget.Guideline
+                        android:id="@+id/guideline2"
+                        android:layout_width="wrap_content"
+                        android:layout_height="wrap_content"
+                        android:orientation="vertical"
+                        app:layout_constraintGuide_begin="237dp" />
+
 
                 </androidx.constraintlayout.widget.ConstraintLayout>
+
             </LinearLayout>
         </androidx.cardview.widget.CardView>
 
Index: app/src/main/java/com/example/infinitycrop/ui/MachineControl/planta1.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.infinitycrop.ui.MachineControl;\r\n\r\nimport android.app.DatePickerDialog;\r\nimport android.app.TimePickerDialog;\r\nimport android.content.Intent;\r\nimport android.graphics.Color;\r\nimport android.graphics.drawable.ColorDrawable;\r\nimport android.os.Bundle;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.CheckBox;\r\nimport android.widget.DatePicker;\r\nimport android.widget.EditText;\r\nimport android.widget.TextView;\r\nimport android.widget.TimePicker;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.example.infinitycrop.R;\r\nimport com.google.firebase.auth.FirebaseUser;\r\nimport com.google.firebase.firestore.DocumentSnapshot;\r\nimport com.google.firebase.firestore.EventListener;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\nimport com.google.firebase.firestore.FirebaseFirestoreException;\r\nimport com.google.firebase.firestore.QuerySnapshot;\r\n\r\nimport java.text.ParseException;\r\nimport java.text.SimpleDateFormat;\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.Calendar;\r\nimport java.util.Date;\r\nimport java.util.List;\r\nimport java.util.SortedSet;\r\n\r\nimport kotlin.Unit;\r\nimport kotlin.jvm.functions.Function1;\r\nimport me.sujanpoudel.wheelview.WheelView;\r\n\r\npublic class planta1 extends AppCompatActivity {\r\n  private CheckBox checkYes, checkNo;\r\n    private Button editInfo, saveChanges;\r\n    private TextView mDisplayDate,mDisplayHour,infoTitle;\r\n    private EditText nameplant;\r\n    private FirebaseFirestore db;\r\n    private List<String> nombres;\r\n    private List<String> estado;\r\n    private String id;\r\n    private String idDocument;\r\n    //Reloj\r\n    int t2Hour, t2Minute;\r\n    private DatePickerDialog.OnDateSetListener mDateSetListener;\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_planta1);\r\n        db=FirebaseFirestore.getInstance();\r\n        //bungle get extra\r\n        Bundle extras = getIntent().getExtras();\r\n        id = extras.getString(\"idMachine\");\r\n        //arrays\r\n        nombres=new ArrayList<>();\r\n        estado=new ArrayList<>();\r\n        //firestore\r\n        db.collection(\"Mediciones planta 1\").document(id).collection(\"DatosPiso\")\r\n                .addSnapshotListener(new EventListener<QuerySnapshot>() {\r\n                    @Override\r\n                    public void onEvent(@Nullable QuerySnapshot snapshots,\r\n                                        @Nullable FirebaseFirestoreException e) {\r\n                        if (e != null) {\r\n                            return;\r\n                        }\r\n                        for (DocumentSnapshot doc : snapshots) {\r\n                                nombres.add(doc.getString(\"name\"));\r\n                                estado.add(doc.getId());\r\n                        }\r\n                        Toast.makeText(getApplicationContext(),nombres.toString(), Toast.LENGTH_LONG).show();\r\n\r\n                        final WheelView wheelView = (WheelView) findViewById(R.id.wheelview);\r\n                        wheelView.setTitles(nombres);\r\n                        wheelView.setSelectListener(new Function1<Integer, Unit>() {\r\n                            @Override\r\n                            public Unit invoke(Integer integer) {\r\n                                showToast(integer);\r\n                                return Unit.INSTANCE;\r\n                            }\r\n                            private final  void showToast(Integer index) {\r\n                               // Toast.makeText(planta1.this,\"\"+wheelView.getTitles().get(index),Toast.LENGTH_SHORT).show();\r\n                                idDocument=estado.get(index);\r\n                                Toast.makeText(planta1.this,\"\"+idDocument,Toast.LENGTH_SHORT).show();\r\n                                itenInfo(idDocument);\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n\r\n\r\n\r\n\r\n\r\n        //Nombre de la planta\r\n        nameplant = (EditText)findViewById(R.id.editTextNobrep);\r\n        nameplant.setEnabled(false);\r\n        //Checkboxes\r\n        checkYes=(CheckBox)findViewById(R.id.checkBoxSi);\r\n        checkYes.setKeyListener(null);\r\n        checkNo=(CheckBox)findViewById(R.id.checkBoxNo);\r\n        checkNo.setKeyListener(null);\r\n\r\n        //Boton guardar cambios\r\n        saveChanges = (Button)findViewById(R.id.btn_save);\r\n        saveChanges.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                editInfo.setVisibility(View.VISIBLE);\r\n                saveChanges.setVisibility(View.GONE);\r\n                mDisplayDate.setEnabled(false);\r\n                mDisplayHour.setEnabled(false);\r\n                nameplant.setEnabled(false);\r\n                infoTitle.setText(\"Pulsa el botón para editar:\");\r\n            }\r\n        });\r\n\r\n        //Boton editar informacion\r\n        editInfo = (Button) findViewById(R.id.btnedit);\r\n        editInfo.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                saveChanges.setVisibility(View.VISIBLE);\r\n                editInfo.setVisibility(View.GONE);\r\n                mDisplayDate.setEnabled(true);\r\n                mDisplayHour.setEnabled(true);\r\n                nameplant.setEnabled(true);\r\n                infoTitle.setText(\"Información completa:\");\r\n\r\n            }\r\n        });\r\n        infoTitle = (TextView) findViewById(R.id.textViewinfo);\r\n        //HORA\r\n        mDisplayHour =(TextView) findViewById(R.id.editHour);\r\n        mDisplayHour.setEnabled(false);\r\n        mDisplayHour.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                TimePickerDialog timePickerDialog = new TimePickerDialog(\r\n                        planta1.this, android.R.style.Theme_Holo_Light_Dialog_MinWidth, new TimePickerDialog.OnTimeSetListener() {\r\n                    @Override\r\n                    public void onTimeSet(TimePicker view, int hourOfDay, int minute) {\r\n                        t2Hour = hourOfDay;\r\n                        t2Minute = minute;\r\n                        String time = t2Hour + \":\" + t2Minute;\r\n                        SimpleDateFormat f24Hours = new SimpleDateFormat(\"HH:mm\");\r\n                        try {\r\n                            Date date = f24Hours.parse(time);\r\n                            SimpleDateFormat f12Hours = new SimpleDateFormat(\"hh:mm aa\");\r\n                            mDisplayHour.setText(f12Hours.format(date));\r\n                        } catch (ParseException e) {\r\n                            e.printStackTrace();\r\n                        }\r\n                    }\r\n                },12,0,false\r\n                );\r\n                timePickerDialog.getWindow().setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));\r\n                timePickerDialog.updateTime(t2Hour,t2Minute);\r\n                timePickerDialog.show();\r\n            }\r\n        });\r\n\r\n\r\n        //CALENDARIO\r\n        mDisplayDate = (TextView) findViewById(R.id.tvDate);\r\n        mDisplayDate.setEnabled(false);\r\n        mDisplayDate.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Calendar cal = Calendar.getInstance();\r\n                int year = cal.get(Calendar.YEAR);\r\n                int month = cal.get(Calendar.MONTH);\r\n                int day = cal.get(Calendar.DAY_OF_MONTH);\r\n\r\n                DatePickerDialog dialog = new DatePickerDialog(planta1.this,android.R.style.Theme_Holo_Dialog_MinWidth, mDateSetListener,year,month,day);\r\n                dialog.getWindow().setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));\r\n                dialog.show();\r\n            }\r\n\r\n        });\r\n        mDateSetListener = new DatePickerDialog.OnDateSetListener() {\r\n            @Override\r\n            public void onDateSet(DatePicker datePicker, int year, int month, int day) {\r\n                month = month+1;\r\n                String date = day +\"/\" + month +\"/\"+ year;\r\n                mDisplayDate.setText(date);\r\n            }\r\n        };\r\n\r\n    }\r\n\r\n    private void itenInfo(String uiDoc){\r\n        //hacer consulta a ese documento con uiDOc y sacar su info\r\n        //luego set Text a all\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/infinitycrop/ui/MachineControl/planta1.java	(revision 97b60040cb9ddffbf7eb424364e4fc4451452801)
+++ app/src/main/java/com/example/infinitycrop/ui/MachineControl/planta1.java	(date 1611080556561)
@@ -1,29 +1,44 @@
 package com.example.infinitycrop.ui.MachineControl;
 
+import android.app.AlarmManager;
 import android.app.DatePickerDialog;
+import android.app.FragmentTransaction;
 import android.app.TimePickerDialog;
+import android.content.Context;
 import android.content.Intent;
 import android.graphics.Color;
 import android.graphics.drawable.ColorDrawable;
 import android.os.Bundle;
+import android.os.CountDownTimer;
 import android.view.View;
 import android.widget.Button;
 import android.widget.CheckBox;
 import android.widget.DatePicker;
 import android.widget.EditText;
+import android.widget.ImageView;
+import android.widget.RelativeLayout;
 import android.widget.TextView;
 import android.widget.TimePicker;
 import android.widget.Toast;
 
+import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 import androidx.appcompat.app.AppCompatActivity;
+import androidx.constraintlayout.widget.ConstraintLayout;
+import androidx.fragment.app.Fragment;
 
 import com.example.infinitycrop.R;
-import com.google.firebase.auth.FirebaseUser;
+import com.example.infinitycrop.ui.dashboard.DashboardFragment;
+import com.example.infinitycrop.ui.dashboard.GeneralFragment;
+import com.example.infinitycrop.ui.logmail.LoginActivity;
+import com.google.android.gms.tasks.OnFailureListener;
+import com.google.android.gms.tasks.OnSuccessListener;
+import com.google.firebase.firestore.DocumentReference;
 import com.google.firebase.firestore.DocumentSnapshot;
 import com.google.firebase.firestore.EventListener;
 import com.google.firebase.firestore.FirebaseFirestore;
 import com.google.firebase.firestore.FirebaseFirestoreException;
+import com.google.firebase.firestore.ListenerRegistration;
 import com.google.firebase.firestore.QuerySnapshot;
 
 import java.text.ParseException;
@@ -32,23 +47,40 @@
 import java.util.Arrays;
 import java.util.Calendar;
 import java.util.Date;
+import java.util.HashMap;
 import java.util.List;
-import java.util.SortedSet;
+import java.util.Map;
 
 import kotlin.Unit;
 import kotlin.jvm.functions.Function1;
 import me.sujanpoudel.wheelview.WheelView;
 
 public class planta1 extends AppCompatActivity {
-  private CheckBox checkYes, checkNo;
+    private List<String> nombres;
+    private List<String> estado;
+    //Aviso al entrar
+    private ConstraintLayout fondoR;
+    private ImageView imgr,goBack;
+    private TextView textR;
+    //
+
+    private int piso = 1;
+    String one = String.valueOf(piso);
+    private int stated = 1;
+    String state = String.valueOf(stated);
+
+
+    private CheckBox checkYes, checkNo;
     private Button editInfo, saveChanges;
     private TextView mDisplayDate,mDisplayHour,infoTitle;
     private EditText nameplant;
     private FirebaseFirestore db;
-    private List<String> nombres;
-    private List<String> estado;
+
+    private String idDocument;
     private String id;
-    private String idDocument;
+
+
+
     //Reloj
     int t2Hour, t2Minute;
     private DatePickerDialog.OnDateSetListener mDateSetListener;
@@ -56,10 +88,38 @@
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_planta1);
+
+        //Aviso al entrar
+        fondoR = findViewById(R.id.constraitR);
+        imgr = findViewById(R.id.imageprevius);
+        textR = findViewById(R.id.txtInfoD);
+        CountDownTimer countDownTimer = new CountDownTimer(3000, 1000) {//Se pone la cuenta atras para que no se superponga con la animación
+            public void onTick(long millisUntilFinished) {
+
+            }
+
+            public void onFinish() {
+
+                fondoR.setVisibility(View.GONE);
+                imgr.setVisibility(View.GONE);
+                textR.setVisibility(View.GONE);
+
+            }
+        }.start();
+        //boton para volver
+        goBack= findViewById(R.id.backDashboard);
+        goBack.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View v) {
+               finish();
+            }
+        });
+
         db=FirebaseFirestore.getInstance();
         //bungle get extra
         Bundle extras = getIntent().getExtras();
         id = extras.getString("idMachine");
+
         //arrays
         nombres=new ArrayList<>();
         estado=new ArrayList<>();
@@ -72,14 +132,18 @@
                         if (e != null) {
                             return;
                         }
+                        nombres.clear();
                         for (DocumentSnapshot doc : snapshots) {
                                 nombres.add(doc.getString("name"));
                                 estado.add(doc.getId());
                         }
-                        Toast.makeText(getApplicationContext(),nombres.toString(), Toast.LENGTH_LONG).show();
+                       /* Toast.makeText(getApplicationContext(),nombres.toString(), Toast.LENGTH_LONG).show();*/
+
+
 
                         final WheelView wheelView = (WheelView) findViewById(R.id.wheelview);
                         wheelView.setTitles(nombres);
+
                         wheelView.setSelectListener(new Function1<Integer, Unit>() {
                             @Override
                             public Unit invoke(Integer integer) {
@@ -91,8 +155,11 @@
                                 idDocument=estado.get(index);
                                 Toast.makeText(planta1.this,""+idDocument,Toast.LENGTH_SHORT).show();
                                 itenInfo(idDocument);
+
+
                             }
                         });
+
                     }
                 });
 
@@ -114,12 +181,17 @@
         saveChanges.setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
+                saveNote(v);
                 editInfo.setVisibility(View.VISIBLE);
                 saveChanges.setVisibility(View.GONE);
                 mDisplayDate.setEnabled(false);
                 mDisplayHour.setEnabled(false);
                 nameplant.setEnabled(false);
                 infoTitle.setText("Pulsa el botón para editar:");
+
+
+
+
             }
         });
 
@@ -128,6 +200,7 @@
         editInfo.setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
+
                 saveChanges.setVisibility(View.VISIBLE);
                 editInfo.setVisibility(View.GONE);
                 mDisplayDate.setEnabled(true);
@@ -135,6 +208,7 @@
                 nameplant.setEnabled(true);
                 infoTitle.setText("Información completa:");
 
+
             }
         });
         infoTitle = (TextView) findViewById(R.id.textViewinfo);
@@ -165,6 +239,7 @@
                 timePickerDialog.getWindow().setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));
                 timePickerDialog.updateTime(t2Hour,t2Minute);
                 timePickerDialog.show();
+                startAlarm(v);
             }
         });
 
@@ -197,9 +272,79 @@
 
     }
 
+    @Override
+    protected void onStart() {
+        super.onStart();
+
+
+    }
+    private void startAlarm(View v){
+        AlarmManager alarmManager = (AlarmManager) getSystemService(Context.ALARM_SERVICE);
+
+    }
+    public void saveNote(View v){
+        String cola = idDocument;
+        String nombre = nameplant.getText().toString();
+        String hora = mDisplayHour.getText().toString();
+        String dia = mDisplayDate.getText().toString();
+        String piso = one;
+
+        Map<String, Object> note = new HashMap<>();
+        note.put("name",nombre);
+        note.put("fecha",dia);
+        note.put("hora",hora);
+        note.put("piso",piso);
+
+        db.collection("Mediciones planta 1").document(id).collection("DatosPiso").document(cola).set(note).addOnSuccessListener(new OnSuccessListener<Void>() {
+            @Override
+            public void onSuccess(Void aVoid) {
+            Toast.makeText(planta1.this,"va bien",Toast.LENGTH_SHORT).show();
+            }
+        }).addOnFailureListener(new OnFailureListener() {
+            @Override
+            public void onFailure(@NonNull Exception e) {
+                Toast.makeText(planta1.this,"va mal",Toast.LENGTH_SHORT).show();
+            }
+        });
+
+
+    }
+
     private void itenInfo(String uiDoc){
         //hacer consulta a ese documento con uiDOc y sacar su info
         //luego set Text a all
+        db.collection("Mediciones planta 1").document(id).collection("DatosPiso").document(uiDoc).get()
+                .addOnSuccessListener(new OnSuccessListener<DocumentSnapshot>() {
+                    @Override
+                    public void onSuccess(DocumentSnapshot documentSnapshot) {
+                        if(documentSnapshot.exists()){
+                            String nombre = documentSnapshot.getString("name");
+                            String fecha = documentSnapshot.getString("fecha");
+                            String hora = documentSnapshot.getString("hora");
+
+                           // Map<String,Object> note = documentSnapshot.getData();
+                            nameplant.setText(nombre);
+                            mDisplayHour.setText(hora);
+                            mDisplayDate.setText(fecha);
+
+                        }else{
+                            Toast.makeText(planta1.this,"Document does exist",Toast.LENGTH_SHORT).show();
+                        }
+                    }
+                }).addOnFailureListener(new OnFailureListener() {
+            @Override
+            public void onFailure(@NonNull Exception e) {
+                Toast.makeText(planta1.this,"va mal",Toast.LENGTH_SHORT).show();
+            }
+        });
+                /*.addSnapshotListener(new EventListener<DocumentSnapshot>() {
+                    @Override
+                    public void onEvent(@Nullable DocumentSnapshot value, @Nullable FirebaseFirestoreException error) {
+
+                    }
+                });*/
+
+
     }
 
 }
Index: app/src/main/res/layout/activity_planta1.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<ScrollView xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    android:layout_width=\"match_parent\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    android:background=\"@drawable/bg4\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\"com.example.infinitycrop.ui.MachineControl.planta1\">\r\n\r\n    <RelativeLayout\r\n\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\"\r\n        android:layout_marginBottom=\"7.3dp\">\r\n\r\n        <LinearLayout\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"match_parent\"\r\n\r\n            android:orientation=\"vertical\">\r\n\r\n            <ImageView\r\n                android:id=\"@+id/backTomachinelist\"\r\n                android:layout_width=\"40dp\"\r\n                android:layout_height=\"40dp\"\r\n                android:layout_marginLeft=\"10dp\"\r\n                android:layout_marginTop=\"30dp\"\r\n                android:src=\"@drawable/icons_arrow_left_green\">\r\n\r\n            </ImageView>\r\n\r\n            <LinearLayout\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginTop=\"12dp\"\r\n                android:orientation=\"horizontal\">\r\n\r\n                <TextView\r\n                    android:id=\"@+id/textView\"\r\n                    android:layout_width=\"469dp\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:layout_marginLeft=\"10dp\"\r\n                    android:layout_weight=\"1\"\r\n                    android:gravity=\"clip_horizontal\"\r\n                    android:text=\"Piso 1\"\r\n                    android:textColor=\"@color/white\"\r\n                    android:textSize=\"25dp\"\r\n                    android:textStyle=\"bold\" />\r\n\r\n                <LinearLayout\r\n                    android:layout_width=\"0dp\"\r\n                    android:layout_height=\"match_parent\"\r\n                    android:layout_weight=\"1\"\r\n                    android:gravity=\"bottom|right\"\r\n                    android:orientation=\"vertical\" />\r\n\r\n                <LinearLayout\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:orientation=\"vertical\" />\r\n            </LinearLayout>\r\n\r\n            <me.sujanpoudel.wheelview.WheelView\r\n                android:id=\"@+id/wheelview\"\r\n                android:layout_width=\"290dp\"\r\n                android:layout_height=\"203dp\"\r\n                android:layout_gravity=\"center\"\r\n                app:layout_constraintEnd_toEndOf=\"parent\"\r\n                app:layout_constraintTop_toTopOf=\"parent\"\r\n                app:wheelAnchorAngle=\"270\"\r\n                app:wheelAnimationDuration=\"500\"\r\n                app:wheelArcBackgroundColor=\"@color/colorSecondaryDark\"\r\n                app:wheelCenterIcon=\"@drawable/logo_without_background\"\r\n                app:wheelDividerStrokeWidth=\"1dp\"\r\n                app:wheelMode=\"ANIMATE_TO_ANCHOR\"\r\n                app:wheelSelectedArcBackgroundColor=\"@color/colorSecondary\"\r\n                app:wheelSelectedTextColor=\"@color/white\"\r\n                app:wheelStartAngle=\"315\"\r\n                app:wheelTextColor=\"@color/white\"\r\n                app:wheelTextSize=\"16sp\" />\r\n\r\n            <LinearLayout\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"match_parent\"\r\n                android:layout_gravity=\"center\"\r\n                android:layout_marginTop=\"10dp\"\r\n                android:orientation=\"horizontal\"\r\n                android:paddingLeft=\"20dp\">\r\n\r\n\r\n                <LinearLayout\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"match_parent\"\r\n                    android:layout_marginLeft=\"1dp\"\r\n                    android:layout_marginRight=\"20dp\"\r\n                    android:background=\"@drawable/rectangle\"\r\n                    android:orientation=\"horizontal\">\r\n\r\n                    <LinearLayout\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"match_parent\"\r\n                        android:layout_gravity=\"center\"\r\n                        android:layout_marginLeft=\"10dp\"\r\n                        android:layout_marginRight=\"15dp\"\r\n                        android:orientation=\"vertical\">\r\n\r\n                        <LinearLayout\r\n                            android:layout_width=\"wrap_content\"\r\n                            android:layout_height=\"40dp\"\r\n\r\n                            android:orientation=\"horizontal\">\r\n\r\n                            <TextView\r\n                                android:id=\"@+id/textViewinfo\"\r\n                                android:layout_width=\"wrap_content\"\r\n                                android:layout_height=\"wrap_content\"\r\n                                android:layout_gravity=\"center\"\r\n                                android:text=\"Pulsa el botón para editar:\"\r\n                                android:textColor=\"#000000\"\r\n                                android:textSize=\"16.7sp\"\r\n                                android:textStyle=\"normal\" />\r\n\r\n                            <Button\r\n                                android:id=\"@+id/btnedit\"\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_marginTop=\"2dp\"\r\n                                android:layout_height=\"30dp\"\r\n                                android:background=\"@drawable/btn_scan\"\r\n                                android:layout_marginLeft=\"10dp\"\r\n                                android:text=\"Editar\"\r\n                                android:textColor=\"#FFFFFF\" />\r\n\r\n                        </LinearLayout>\r\n\r\n\r\n                        <TextView\r\n                            android:id=\"@+id/textView23\"\r\n                            android:layout_width=\"wrap_content\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:layout_marginTop=\"12dp\"\r\n                            android:text=\"Sección ocupada:\"\r\n                            android:textColor=\"#9E9D9D\" />\r\n\r\n                        <LinearLayout\r\n                            android:layout_width=\"match_parent\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:orientation=\"horizontal\">\r\n\r\n                            <CheckBox\r\n                                android:id=\"@+id/checkBoxSi\"\r\n                                android:layout_width=\"wrap_content\"\r\n                                android:layout_height=\"wrap_content\"\r\n                                android:layout_weight=\"1\"\r\n                                android:text=\"Si\" />\r\n\r\n                            <CheckBox\r\n                                android:id=\"@+id/checkBoxNo\"\r\n                                android:layout_width=\"wrap_content\"\r\n                                android:layout_height=\"wrap_content\"\r\n                                android:layout_weight=\"1\"\r\n                                android:checked=\"true\"\r\n                                android:clickable=\"false\"\r\n                                android:text=\"No\" />\r\n                        </LinearLayout>\r\n\r\n\r\n\r\n                        <View\r\n                            android:layout_width=\"match_parent\"\r\n                            android:layout_height=\"1dp\"\r\n                            android:layout_marginTop=\"2dp\"\r\n                            android:background=\"#9e9e9e\" />\r\n\r\n                        <TextView\r\n                            android:id=\"@+id/textView7\"\r\n                            android:layout_width=\"wrap_content\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:layout_marginTop=\"12dp\"\r\n                            android:text=\"Nombre de la especie:\"\r\n                            android:textColor=\"#9E9D9D\" />\r\n\r\n                        <EditText\r\n                            android:id=\"@+id/editTextNobrep\"\r\n                            android:layout_width=\"match_parent\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:background=\"@android:color/transparent\"\r\n                            android:maxLines=\"1\"\r\n                            android:paddingTop=\"5dp\"\r\n                            android:textColorHint=\"#9E9D9D\"\r\n                            android:textCursorDrawable=\"@drawable/cursor_color\"\r\n                            android:textSize=\"15sp\"\r\n                            android:hint=\"Toca para añadir\"\r\n\r\n                            />\r\n\r\n                        <View\r\n                            android:layout_width=\"match_parent\"\r\n                            android:layout_height=\"1dp\"\r\n                            android:layout_marginTop=\"2dp\"\r\n                            android:background=\"#9e9e9e\" />\r\n\r\n                        <TextView\r\n                            android:id=\"@+id/textedit\"\r\n                            android:layout_width=\"wrap_content\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:layout_marginTop=\"22.3dp\"\r\n                            android:text=\"Hora de fin\"\r\n                            android:textColor=\"#9E9D9D\" />\r\n\r\n                        <TextView\r\n                            android:id=\"@+id/editHour\"\r\n                            android:layout_width=\"match_parent\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:background=\"@android:color/transparent\"\r\n                            android:ems=\"10\"\r\n                            android:text=\"Toca para añdir\"\r\n                            android:inputType=\"time\"\r\n                            android:maxLines=\"1\"\r\n                            android:paddingTop=\"5dp\"\r\n                            android:textColorHint=\"#333232\"\r\n                            android:textCursorDrawable=\"@drawable/cursor_color\"\r\n                            android:textSize=\"15sp\" />\r\n\r\n                        <View\r\n                            android:layout_width=\"match_parent\"\r\n                            android:layout_height=\"1dp\"\r\n                            android:layout_marginTop=\"2dp\"\r\n                            android:background=\"#9e9e9e\" />\r\n\r\n                        <TextView\r\n                            android:id=\"@+id/textView11\"\r\n                            android:layout_width=\"wrap_content\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:layout_marginTop=\"22.3dp\"\r\n                            android:text=\"Fecha de fin\"\r\n                            android:textColor=\"#9E9D9D\" />\r\n                        <TextView\r\n                            android:id=\"@+id/tvDate\"\r\n                            android:layout_width=\"match_parent\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:background=\"@android:color/transparent\"\r\n                            android:ems=\"10\"\r\n                            android:text=\"Toca para añdir\"\r\n                            android:inputType=\"time\"\r\n                            android:editable=\"false\"\r\n                            android:maxLines=\"1\"\r\n                            android:paddingTop=\"5dp\"\r\n                            android:textColorHint=\"#333232\"\r\n                            android:textCursorDrawable=\"@drawable/cursor_color\"\r\n                            android:textSize=\"15sp\" />\r\n\r\n                        <View\r\n                            android:layout_width=\"match_parent\"\r\n                            android:layout_height=\"1dp\"\r\n                            android:layout_marginTop=\"2dp\"\r\n                            android:layout_marginBottom=\"20dp\"\r\n                            android:background=\"#9e9e9e\" />\r\n\r\n                        <Button\r\n\r\n                            android:id=\"@+id/btn_save\"\r\n                            android:layout_width=\"151dp\"\r\n                            android:layout_height=\"49dp\"\r\n                            android:layout_gravity=\"center\"\r\n                            android:background=\"@drawable/btn_scan\"\r\n                            android:visibility=\"gone\"\r\n                            android:text=\"Guardar cambios\"\r\n                            android:textColor=\"#FFFFFF\">\r\n\r\n                        </Button>\r\n\r\n                        <RelativeLayout\r\n                            android:layout_width=\"match_parent\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:paddingTop=\"5dp\">\r\n\r\n                        </RelativeLayout>\r\n\r\n\r\n                    </LinearLayout>\r\n                </LinearLayout>\r\n            </LinearLayout>\r\n\r\n            <LinearLayout\r\n                android:id=\"@+id/btn_registMachine\"\r\n                android:layout_width=\"90dp\"\r\n                android:layout_height=\"41dp\"\r\n                android:layout_gravity=\"right\"\r\n                android:layout_marginTop=\"40.3dp\"\r\n                android:layout_marginBottom=\"16.7dp\"\r\n                android:background=\"@drawable/btn_login\"\r\n                android:foregroundGravity=\"right\"\r\n                android:gravity=\"center\"\r\n                android:orientation=\"vertical\"\r\n\r\n                android:visibility=\"gone\">\r\n\r\n\r\n            </LinearLayout>\r\n\r\n\r\n        </LinearLayout>\r\n\r\n\r\n    </RelativeLayout>\r\n\r\n\r\n</ScrollView>\r\n\r\n\r\n\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/activity_planta1.xml	(revision 97b60040cb9ddffbf7eb424364e4fc4451452801)
+++ app/src/main/res/layout/activity_planta1.xml	(date 1611078145131)
@@ -20,7 +20,7 @@
             android:orientation="vertical">
 
             <ImageView
-                android:id="@+id/backTomachinelist"
+                android:id="@+id/backDashboard"
                 android:layout_width="40dp"
                 android:layout_height="40dp"
                 android:layout_marginLeft="10dp"
@@ -263,9 +263,10 @@
                             android:layout_height="49dp"
                             android:layout_gravity="center"
                             android:background="@drawable/btn_scan"
-                            android:visibility="gone"
+                            android:onClick="saveNote"
                             android:text="Guardar cambios"
-                            android:textColor="#FFFFFF">
+                            android:textColor="#FFFFFF"
+                            android:visibility="gone">
 
                         </Button>
 
@@ -301,6 +302,41 @@
 
         </LinearLayout>
 
+        <androidx.constraintlayout.widget.ConstraintLayout
+            android:id="@+id/constraitR"
+            android:layout_width="match_parent"
+            android:layout_height="match_parent"
+            tools:visibility="gone">
+
+            <ImageView
+                android:id="@+id/imageprevius"
+                android:layout_width="400dp"
+                android:layout_height="731dp"
+                android:alpha="0.4"
+                app:layout_constraintBottom_toBottomOf="parent"
+                app:layout_constraintEnd_toEndOf="parent"
+                app:layout_constraintStart_toStartOf="parent"
+                app:layout_constraintTop_toTopOf="parent"
+                app:srcCompat="@color/black"
+                tools:visibility="gone" />
+
+            <TextView
+                android:id="@+id/txtInfoD"
+                android:layout_width="264dp"
+                android:layout_height="81dp"
+                android:background="@color/white"
+                android:paddingTop="10dp"
+                android:text="Toca una casilla para visualizar los datos"
+                android:textAlignment="center"
+                android:textColor="@color/black"
+                android:textSize="20sp"
+                app:layout_constraintBottom_toBottomOf="parent"
+                app:layout_constraintEnd_toEndOf="parent"
+                app:layout_constraintStart_toStartOf="parent"
+                app:layout_constraintTop_toTopOf="@+id/imageprevius"
+                tools:visibility="gone" />
+        </androidx.constraintlayout.widget.ConstraintLayout>
+
 
     </RelativeLayout>
 
Index: app/build.gradle
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>apply plugin: 'com.android.application'\r\n\r\n\r\nandroid {\r\n    compileSdkVersion 30\r\n    buildToolsVersion \"30.0.2\"\r\n\r\n    defaultConfig {\r\n        applicationId \"com.example.infinitycrop\"\r\n        minSdkVersion 23\r\n        targetSdkVersion 30\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n        multiDexEnabled true\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    buildTypes {\r\n        release {\r\n            minifyEnabled false\r\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\r\n        }\r\n    }\r\n}\r\n\r\ndependencies {\r\n    implementation fileTree(dir: \"libs\", include: [\"*.jar\"])\r\n    implementation 'androidx.appcompat:appcompat:1.2.0'\r\n    implementation 'com.google.android.material:material:1.2.1'\r\n    implementation 'androidx.constraintlayout:constraintlayout:2.0.2'\r\n    implementation 'androidx.navigation:navigation-fragment:2.1.0'\r\n    implementation 'androidx.navigation:navigation-ui:2.1.0'\r\n    implementation 'androidx.lifecycle:lifecycle-extensions:2.2.0'\r\n    implementation 'androidx.legacy:legacy-support-v4:1.0.0'\r\n    implementation 'com.google.firebase:firebase-auth:16.0.5'\r\n    implementation 'com.firebaseui:firebase-ui-auth:6.2.0'\r\n    implementation project(path: ':comun')\r\n    implementation 'com.google.firebase:firebase-database:19.5.1'\r\n    implementation 'com.google.firebase:firebase-storage:19.2.0'\r\n    testImplementation 'junit:junit:4.12'\r\n    androidTestImplementation 'androidx.test.ext:junit:1.1.2'\r\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.3.0'\r\n    implementation 'com.google.firebase:firebase-analytics'\r\n    implementation 'com.ismaeldivita.chipnavigation:chip-navigation-bar:1.3.4'\r\n    implementation 'org.jetbrains.kotlin:kotlin-stdlib:1.4.10'\r\n    implementation 'androidx.recyclerview:recyclerview:1.1.0'\r\n    implementation 'com.android.volley:volley:1.1.0'\r\n    // Also declare the dependency for the Google Play services library and specify its version\r\n    implementation 'com.google.android.gms:play-services-auth:18.1.0'\r\n    // Import the BoM for the Firebase platform\r\n    implementation platform('com.google.firebase:firebase-bom:26.0.0')\r\n    implementation 'com.google.firebase:firebase-firestore:17.1.2'\r\n    implementation 'com.android.support:multidex:1.0.3'\r\n    implementation 'com.firebaseui:firebase-ui-firestore:6.3.0'\r\n    //biblioteca para mostrar images a través de URL\r\n    implementation 'com.github.bumptech.glide:glide:4.11.0'\r\n    //import del mqtt\r\n    implementation 'org.eclipse.paho:org.eclipse.paho.client.mqttv3:1.1.1'\r\n    implementation 'com.google.android.gms:play-services-maps:17.0.0'\r\n    compile 'com.google.android.gms:play-services-location:16.0.0'\r\n    implementation 'com.journeyapps:zxing-android-embedded:3.4.0'//añadimos esta libreria para qr\r\n    implementation 'com.facebook.android:facebook-android-sdk:[4,5)'\r\n\r\n    implementation \"androidx.viewpager2:viewpager2:1.0.0\" //libreria viewpager\r\n    implementation  'com.airbnb.android:lottie:3.4.1'//libreria para la animacion\r\n    implementation 'com.cuberto:liquid-swipe:1.0.0' //libreria para el tutorial\r\n    implementation 'androidx.core:core:1.3.1'\r\n    implementation'androidx.core:core-ktx:1.3.1'\r\n\r\n    implementation'com.squareup.okhttp3:mockwebserver:4.2.0'\r\n    implementation'com.squareup.okhttp3:okhttp:4.2.0'\r\n\r\n    implementation 'androidx.cardview:cardview:1.0.0'\r\n    implementation \"androidx.viewpager2:viewpager2:1.0.0\" //libreria viewpager\r\n\r\n    //plugins de subir imagen user foro\r\n    implementation 'com.theartofdev.edmodo:android-image-cropper:2.4.+'\r\n    implementation 'com.squareup.picasso:picasso:2.71828'\r\n    implementation 'id.zelory:compressor:2.1.0'\r\n    //imageView modo circulo\r\n    implementation 'com.makeramen:roundedimageview:2.3.0'\r\n\r\n    implementation 'com.github.PhilJay:MPAndroidChart:v3.1.0' // libreria graficas\r\n    //libreria wheelview\r\n    implementation'com.github.psuzn:wheelView:1.0.0'\r\n}\r\napply plugin: 'com.google.gms.google-services'
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/build.gradle	(revision 97b60040cb9ddffbf7eb424364e4fc4451452801)
+++ app/build.gradle	(date 1611016765707)
@@ -47,6 +47,8 @@
     implementation 'com.android.volley:volley:1.1.0'
     // Also declare the dependency for the Google Play services library and specify its version
     implementation 'com.google.android.gms:play-services-auth:18.1.0'
+    implementation 'com.google.android.gms:play-services-ads:9.8.0'
+
     // Import the BoM for the Firebase platform
     implementation platform('com.google.firebase:firebase-bom:26.0.0')
     implementation 'com.google.firebase:firebase-firestore:17.1.2'
@@ -83,5 +85,6 @@
     implementation 'com.github.PhilJay:MPAndroidChart:v3.1.0' // libreria graficas
     //libreria wheelview
     implementation'com.github.psuzn:wheelView:1.0.0'
+    implementation'com.loopj.android:android-async-http:1.4.11'//libreria para el tiempo
 }
 apply plugin: 'com.google.gms.google-services'
\ No newline at end of file
Index: app/src/main/java/com/example/infinitycrop/ui/dashboard/GeneralFragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.infinitycrop.ui.dashboard;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.constraintlayout.widget.ConstraintLayout;\r\nimport androidx.fragment.app.Fragment;\r\n\r\nimport android.util.Log;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.Button;\r\nimport android.widget.CompoundButton;\r\nimport android.widget.Switch;\r\nimport android.widget.TextView;\r\n\r\nimport com.example.comun.Mqtt;\r\nimport com.example.infinitycrop.MainActivity;\r\nimport com.example.infinitycrop.R;\r\nimport com.example.infinitycrop.ui.MachineControl.planta1;\r\nimport com.google.android.material.bottomsheet.BottomSheetDialog;\r\nimport com.google.firebase.firestore.DocumentSnapshot;\r\nimport com.google.firebase.firestore.EventListener;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\nimport com.google.firebase.firestore.FirebaseFirestoreException;\r\n\r\nimport org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;\r\nimport org.eclipse.paho.client.mqttv3.MqttCallback;\r\nimport org.eclipse.paho.client.mqttv3.MqttClient;\r\nimport org.eclipse.paho.client.mqttv3.MqttConnectOptions;\r\nimport org.eclipse.paho.client.mqttv3.MqttException;\r\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\r\nimport org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;\r\n\r\nimport static com.example.comun.Mqtt.topicRoot;\r\n\r\n/**\r\n * A simple {@link Fragment} subclass.\r\n * Use the {@link GeneralFragment#newInstance} factory method to\r\n * create an instance of this fragment.\r\n */\r\npublic class GeneralFragment extends Fragment implements MqttCallback{\r\n    public static MqttClient client = null;\r\n    private String uid;\r\n    private FirebaseFirestore db;\r\n    // TODO: Rename parameter arguments, choose names that match\r\n    // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER\r\n    private static final String ARG_PARAM1 = \"param1\";\r\n    private static final String ARG_PARAM2 = \"param2\";\r\n\r\n    // TODO: Rename and change types of parameters\r\n    private String mParam1;\r\n    private String mParam2;\r\n\r\n    public GeneralFragment() {\r\n        // Required empty public constructor\r\n    }\r\n\r\n    /**\r\n     * Use this factory method to create a new instance of\r\n     * this fragment using the provided parameters.\r\n     *\r\n     * @param param1 Parameter 1.\r\n     * @param param2 Parameter 2.\r\n     * @return A new instance of fragment GeneralFragment.\r\n     */\r\n    // TODO: Rename and change types and number of parameters\r\n    public static GeneralFragment newInstance(String param1, String param2) {\r\n        GeneralFragment fragment = new GeneralFragment();\r\n        Bundle args = new Bundle();\r\n        args.putString(ARG_PARAM1, param1);\r\n        args.putString(ARG_PARAM2, param2);\r\n        fragment.setArguments(args);\r\n        return fragment;\r\n    }\r\n\r\n    @Override\r\n    public void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        if (getArguments() != null) {\r\n            mParam1 = getArguments().getString(ARG_PARAM1);\r\n            mParam2 = getArguments().getString(ARG_PARAM2);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\r\n                             Bundle savedInstanceState) {\r\n        // Inflate the layout for this fragment\r\n        View v = inflater.inflate(R.layout.fragment_general, container, false);\r\n        //switch methods\r\n        Switch switchLuz = (Switch) v.findViewById(R.id.switchLuminosidadGeneral);\r\n        switchLuz.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {\r\n            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {\r\n                if (isChecked) {\r\n                    // The toggle is enabled\r\n                    enviarLucesOn();\r\n                } else {\r\n                    // The toggle is disabled\r\n                    enviarLucesOff();\r\n                }\r\n            }\r\n        });\r\n        db = FirebaseFirestore.getInstance();\r\n        MainActivity myActivity = (MainActivity) getActivity();\r\n        final TextView medidaTemp=v.findViewById(R.id.medidaTemperaturaGeneral);\r\n        final TextView medidaHum=v.findViewById(R.id.medidaHumedadGeneral);\r\n        final TextView medidaHumAm=v.findViewById(R.id.medidaSalinidadGeneral);\r\n        final TextView medidaLuz=v.findViewById(R.id.medidasLuminosidadGeneral);\r\n        uid=myActivity.getMachineUID();\r\n        db.collection(\"Mediciones general\")\r\n                .document(uid)\r\n                .addSnapshotListener(new EventListener<DocumentSnapshot>() {\r\n                    @Override\r\n                    public void onEvent(@Nullable DocumentSnapshot snapshot,\r\n                                        @Nullable FirebaseFirestoreException e) {\r\n                        if (e != null) {\r\n                            return;\r\n                        }\r\n\r\n                        if (snapshot != null && snapshot.exists()) {\r\n                            //Temperatura\r\n                            String medidaT=snapshot.getString(\"Temperatura\");\r\n                            medidaTemp.setText(medidaT+\"°C\");\r\n                            //Humedad\r\n                            String medidaH=snapshot.getString(\"Humedad\");\r\n                            medidaHum.setText(medidaH+\"%\");\r\n                            //Humedad Ambiente\r\n                            String medidaHA=snapshot.getString(\"Humedad Ambiente\");\r\n                            medidaHumAm.setText(medidaHA+\"%\");\r\n                            //Luminosidad\r\n                            String medidaL=snapshot.getString(\"Luminosidad\");\r\n                            medidaLuz.setText(medidaL+\"%\");\r\n\r\n\r\n                        } else {\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n        //Boton para acceder a la maquina para sus parcelas\r\n        Button btnmymachine = (Button) v.findViewById(R.id.btnMyMachine);\r\n        btnmymachine.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n\r\n                BottomSheetDialog bottomSheetDialog = new BottomSheetDialog(\r\n                        getContext()\r\n                );\r\n                bottomSheetDialog.setContentView(R.layout.plantamaquina_bottom_sheet);\r\n                Button btnp1=bottomSheetDialog.findViewById(R.id.enterPlant2);\r\n                Button btn2=bottomSheetDialog.findViewById(R.id.enterPlant1);\r\n                bottomSheetDialog.show();\r\n                btnp1.setOnClickListener(new View.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(View v) {\r\n                        Intent intent = new Intent (getContext(), planta1.class);\r\n                        intent.putExtra(\"idMachine\", uid);\r\n                        startActivity(intent);\r\n\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        return v;\r\n    }\r\n        /*btnmymachine.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent (getContext(), MiMaquina.class);\r\n                startActivity(intent);\r\n\r\n            }\r\n        });*/\r\n\r\n\r\n\r\n    public void enviarLucesOff(){\r\n        try {\r\n            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new\r\n                    MemoryPersistence());\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n        MqttConnectOptions connOpts = new MqttConnectOptions();\r\n        connOpts.setCleanSession(true);\r\n        connOpts.setKeepAliveInterval(60);\r\n        connOpts.setWill(topicRoot+\"WillTopic\", \"App desconectada\".getBytes(),Mqtt.qos, false);\r\n\r\n        try {\r\n            client.connect(connOpts);\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        //conexión con el broker Root1 = Lector de datos\r\n        //nos subscribimos a topic lectura\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Subscrito a \" + topicRoot + \"luces\");//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este\r\n            client.subscribe(topicRoot + \"luces\", Mqtt.qos);\r\n            client.setCallback((MqttCallback) this);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al suscribir.\", e);\r\n        }\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Publicando mensaje: \" + \"mensaje\");\r\n            MqttMessage message = new MqttMessage(\"Superior OFF\".getBytes());\r\n            message.setQos(Mqtt.qos);\r\n            message.setRetained(false);\r\n            client.publish(topicRoot+\"luces\", message);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al publicar.\", e);\r\n        }\r\n    }\r\n    public void enviarLucesOn(){\r\n        try {\r\n            client = new MqttClient(Mqtt.broker, Mqtt.clientId, new\r\n                    MemoryPersistence());\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n        MqttConnectOptions connOpts = new MqttConnectOptions();\r\n        connOpts.setCleanSession(true);\r\n        connOpts.setKeepAliveInterval(60);\r\n        connOpts.setWill(topicRoot+\"WillTopic\", \"App desconectada\".getBytes(),Mqtt.qos, false);\r\n\r\n        try {\r\n            client.connect(connOpts);\r\n        } catch (MqttException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        //conexión con el broker Root1 = Lector de datos\r\n        //nos subscribimos a topic lectura\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Subscrito a \" + topicRoot + \"luces\");//aqui está el root al que nos subscribimos si se quiere modificar se tiene que modificar este\r\n            client.subscribe(topicRoot + \"luces\", Mqtt.qos);\r\n            client.setCallback((MqttCallback) this);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al suscribir.\", e);\r\n        }\r\n        try {\r\n            Log.i(Mqtt.TAG, \"Publicando mensaje: \" + \"mensaje\");\r\n            MqttMessage message = new MqttMessage(\"Superior ON\".getBytes());\r\n            message.setQos(Mqtt.qos);\r\n            message.setRetained(false);\r\n            client.publish(topicRoot+\"luces\", message);\r\n        } catch (MqttException e) {\r\n            Log.e(Mqtt.TAG, \"Error al publicar.\", e);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void connectionLost(Throwable cause) {\r\n        Log.d(Mqtt.TAG, \"Conexión perdida\");\r\n    }\r\n\r\n    @Override\r\n    public void messageArrived(String topic, MqttMessage message) throws Exception {\r\n\r\n    }\r\n\r\n    @Override\r\n    public void deliveryComplete(IMqttDeliveryToken token) {\r\n        Log.d(Mqtt.TAG, \"Entrega completa\");\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/infinitycrop/ui/dashboard/GeneralFragment.java	(revision 97b60040cb9ddffbf7eb424364e4fc4451452801)
+++ app/src/main/java/com/example/infinitycrop/ui/dashboard/GeneralFragment.java	(date 1611079933076)
@@ -161,7 +161,10 @@
                         intent.putExtra("idMachine", uid);
                         startActivity(intent);
 
+
+
                     }
+
                 });
             }
         });
Index: app/src/main/AndroidManifest.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    package=\"com.example.infinitycrop\">\r\n\r\n    <uses-permission android:name=\"android.permission.READ_EXTERNAL_STORAGE\" />\r\n    <uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\" />\r\n    <uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />\r\n    <uses-permission android:name=\"android.permission.ACCESS_COARSE_LOCATION\" />\r\n    <uses-permission android:name=\"android.permission.INTERNET\" />\r\n    <uses-permission android:name=\"com.google.android.things.permission.MANAGE_INPUT_DRIVERS\" />\r\n    <uses-permission android:name=\"com.google.android.things.permission.USE_PERIPHERAL_IO\" /> <!-- Permisos Qr -->\r\n    <uses-permission android:name=\"android.permission.CAMERA\" />\r\n\r\n    <uses-feature android:name=\"android.hardware.camera\" />\r\n    <uses-feature android:name=\"android.hardware.camera.autofocus\" />\r\n\r\n    <application\r\n        android:allowBackup=\"true\"\r\n        android:icon=\"@mipmap/ic_launcher\"\r\n        android:label=\"@string/app_name\"\r\n        android:roundIcon=\"@mipmap/ic_launcher\"\r\n        android:theme=\"@style/AppThemeHome\">\r\n        <activity android:name=\".ui.Foro.main.Community.NewPost.CreatePost.CreatePost\"></activity>\r\n        <activity android:name=\".ui.Foro.main.Community.CommunityMain\" />\r\n        <activity android:name=\".ui.Foro.lets_start.EditCommunity\" />\r\n        <activity android:name=\".ui.list_machine.ModifyMachine\" />\r\n        <activity android:name=\".ui.Foro.main.ForoMain\" />\r\n        <activity android:name=\".ui.Foro.lets_start.AddCommunity\" />\r\n        <activity android:name=\".ui.Foro.lets_start.choose_community\" />\r\n        <activity android:name=\".ui.Foro.lets_start.welcome_forum\" />\r\n        <activity android:name=\".MainActivity\" />\r\n\r\n        <service android:name=\".ui.service.ServicioMqtt\" />\r\n        <service android:name=\".ui.service.ServicioNotificaciones\" />\r\n\r\n        <activity android:name=\".ui.LoadAnimations.IntroductoryActivity\">\r\n            <intent-filter>\r\n                <action android:name=\"android.intent.action.MAIN\" />\r\n\r\n                <category android:name=\"android.intent.category.LAUNCHER\" />\r\n            </intent-filter>\r\n        </activity>\r\n        <activity android:name=\".ui.profile.settings.AboutInfinityCrap\" />\r\n        <activity android:name=\".ui.profile.settings.HelpProfile\" />\r\n        <activity android:name=\".ui.list_machine.MainActivityMachineList\" />\r\n        <activity android:name=\".ui.list_machine.AddMachine\" />\r\n        <activity android:name=\".ui.profile.settings.ModifyProfile\" />\r\n        <activity android:name=\".ui.logmail.RegisterActivity\" />\r\n        <activity android:name=\".ui.logmail.LoginActivity\" />\r\n        <activity android:name=\".ui.list_machine.CaptureAct\" />\r\n        <activity android:name=\".ui.login.LogActivity\" />\r\n        <activity android:name=\".ui.LoadAnimations.IntroductoryActivity2\" />\r\n        <activity android:name=\".ui.LoadAnimations.LogprimeraActivity\" />\r\n        <activity android:name=\".ui.graphics.GraphicsActivity\" />\r\n        <activity android:name=\".ui.MachineControl.planta1\" />\r\n        <activity android:name=\".ui.notifications.NotificacionesActivity\" />\r\n\r\n        <meta-data\r\n            android:name=\"com.google.android.geo.API_KEY\"\r\n            android:value=\"@string/google_maps_key\" />\r\n        <meta-data\r\n            android:name=\"com.facebook.sdk.ApplicationId\"\r\n            android:value=\"@string/facebook_app_id\"\r\n            tools:replace=\"android:value\" />\r\n        <meta-data\r\n            android:name=\"preloaded_fonts\"\r\n            android:resource=\"@array/preloaded_fonts\" />\r\n\r\n        <activity\r\n            android:name=\"com.theartofdev.edmodo.cropper.CropImageActivity\"\r\n            android:theme=\"@style/Base.Theme.AppCompat\" />\r\n    </application>\r\n\r\n</manifest>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/AndroidManifest.xml	(revision 97b60040cb9ddffbf7eb424364e4fc4451452801)
+++ app/src/main/AndroidManifest.xml	(date 1611022652045)
@@ -31,6 +31,7 @@
         <activity android:name=".ui.Foro.lets_start.welcome_forum" />
         <activity android:name=".MainActivity" />
 
+
         <service android:name=".ui.service.ServicioMqtt" />
         <service android:name=".ui.service.ServicioNotificaciones" />
 
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_17_01_2021_15_05__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_17_01_2021_15_05__Default_Changelist_.xml
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_16_01_2021_19_07__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_16_01_2021_19_07__Default_Changelist_.xml
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_15_01_2021_13_24__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_15_01_2021_13_24__Default_Changelist_.xml
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_16_01_2021_21_29__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_16_01_2021_21_29__Default_Changelist_.xml
